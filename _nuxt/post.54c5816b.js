import{H as f,M}from"./components.356fe1b9.js";import{a as b,ar as I,ae as x,b as m,f as T,e as r,w as d,c as l,l as p,F as _,r as g,as as N,o,i as k}from"./entry.4c969726.js";import{C as w,a as v}from"./ChatFeed.859d41e9.js";import{I as R,C as F}from"./ethers.8328e202.js";import"./composables.e96dca6d.js";import"./textUtils.7a2f6a9b.js";import"./Image.4021538c.js";import"./site.a2f021af.js";import"./balanceUtils.12f63e93.js";import"./user.d03486f1.js";import"./SwitchChainButton.868a1ec4.js";import"./WaitingToast.460d017b.js";import"./domainUtils.4de153c7.js";import"./storageUtils.15eadf2e.js";import"./FileUploadModal.c3587768.js";import"./FileUploadInput.f875667a.js";const V={data(){return{message:null,reply:null}},components:{ChatFeed:w,ChatMessage:v},created(){this.getMessage()},computed:{getChatContext(){return this.route.query.context},getMessageId(){return this.route.query.id},getReplyId(){return this.route.query.reply},isReply(){return!!this.route.query.reply},mainMessagePage(){return`/post/?id=${this.getMessageId}&context=${this.getChatContext}`}},methods:{async getMessage(){this.message=null,this.reply=null;try{const e=this.$getFallbackProvider(this.$config.public.supportedChainId),s=new R([{inputs:[{internalType:"uint256",name:"mainMsgIndex_",type:"uint256"}],name:"getMainMessage",outputs:[{components:[{internalType:"address",name:"author",type:"address"},{internalType:"uint256",name:"createdAt",type:"uint256"},{internalType:"bool",name:"deleted",type:"bool"},{internalType:"uint256",name:"index",type:"uint256"},{internalType:"uint256",name:"repliesCount",type:"uint256"},{internalType:"string",name:"url",type:"string"}],internalType:"struct ChatFeed.Message",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"mainMsgIndex_",type:"uint256"},{internalType:"uint256",name:"replyMsgIndex_",type:"uint256"}],name:"getReply",outputs:[{components:[{internalType:"address",name:"author",type:"address"},{internalType:"uint256",name:"createdAt",type:"uint256"},{internalType:"bool",name:"deleted",type:"bool"},{internalType:"uint256",name:"index",type:"uint256"},{internalType:"uint256",name:"repliesCount",type:"uint256"},{internalType:"string",name:"url",type:"string"}],internalType:"struct ChatFeed.Message",name:"",type:"tuple"}],stateMutability:"view",type:"function"}]),u=new F(this.getChatContext,s,e);let n,t;n=await u.getMainMessage(this.getMessageId),this.isReply&&(t=await u.getReply(this.getMessageId,this.getReplyId)),n.deleted?this.toast("This message has been deleted.",{type:"info"}):this.message={author:n.author,url:n.url,createdAt:n.createdAt.toNumber(),deleted:n.deleted,repliesCount:n.repliesCount.toNumber(),index:n.index.toNumber()},t&&(t.deleted?this.toast("This reply has been deleted.",{type:"info"}):this.reply={author:t.author,url:t.url,createdAt:t.createdAt.toNumber(),deleted:t.deleted,repliesCount:t.repliesCount.toNumber(),index:t.index.toNumber()})}catch(e){console.error(e),this.toast("Failed to load the message",{type:"error"})}}},setup(){const e=I(),s=x();return{route:e,toast:s}},watch:{getChatContext(e,s){this.getMessage()},getMessageId(e,s){this.getMessage()},getReplyId(e,s){this.getMessage()}}};function j(e,s,u,n,t,a){const i=M,y=f,c=g("ChatMessage"),h=g("ChatFeed"),C=N;return o(),m(_,null,[T("div",null,[r(y,null,{default:d(()=>[r(i,{name:"description",content:"Check out this chat post on "+e.$config.public.projectName+"!"},null,8,["content"]),r(i,{property:"og:image",content:e.$config.public.projectUrl+e.$config.public.previewImagePost},null,8,["content"]),r(i,{property:"og:description",content:"Check out this chat post on "+e.$config.public.projectName+"!"},null,8,["content"]),r(i,{name:"twitter:image",content:e.$config.public.projectUrl+e.$config.public.previewImagePost},null,8,["content"]),r(i,{name:"twitter:description",content:"Check out this chat post on "+e.$config.public.projectName+"!"},null,8,["content"])]),_:1})]),(o(),m("div",{key:t.message?.url},[t.message?(o(),l(c,{key:0,message:t.message,chatContext:a.getChatContext},null,8,["message","chatContext"])):p("",!0),t.reply?(o(),l(c,{key:1,message:t.reply,mainItemId:a.getMessageId,chatContext:a.getChatContext},null,8,["message","mainItemId","chatContext"])):p("",!0),a.isReply?p("",!0):(o(),l(h,{key:2,chatContext:a.getChatContext,mainItemId:a.getMessageId},null,8,["chatContext","mainItemId"])),a.isReply?(o(),l(C,{key:3,to:a.mainMessagePage,class:"btn btn-primary"},{default:d(()=>[k("See other replies")]),_:1},8,["to"])):p("",!0)]))],64)}const Q=b(V,[["render",j]]);export{Q as default};
