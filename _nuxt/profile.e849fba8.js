import{H as $,T as B,M as F}from"./components.356fe1b9.js";import{a as y,ae as S,r as b,o as r,b as c,f as i,ah as C,t as d,e as m,l,af as L,ag as D,i as h,c as g,ad as x,u as v,w,as as E,F as M}from"./entry.4c969726.js";import{g as T}from"./textUtils.7a2f6a9b.js";import{I as U,C as P,u as N,f as A,v as W}from"./ethers.8328e202.js";import{u as j}from"./user.d03486f1.js";import{C as V,S as z}from"./SwitchChainButton.868a1ec4.js";import{I as H}from"./Image.4021538c.js";import{W as q}from"./WaitingToast.460d017b.js";import{F as O}from"./FileUploadInput.f875667a.js";import{u as J}from"./site.a2f021af.js";import{P as Y,g as Z,a as G}from"./domainUtils.4de153c7.js";import{g as K}from"./balanceUtils.12f63e93.js";import{a as Q,b as I,s as R}from"./storageUtils.15eadf2e.js";import"./composables.e96dca6d.js";const X={name:"ChangePfpModal",props:["componentId","domainName","storageType"],emits:["processFileUrl"],components:{ConnectWalletButton:V,FileUploadInput:O,Image:H,SwitchChainButton:z},data(){return{currentTab:"upload",imageLink:null,waitingSubmit:!1}},mounted(){this.fileUploadEnabled||(this.currentTab="paste")},computed:{domainNameWithoutTld(){return this.domainName.replace(this.$config.public.tldName,"")},fileUploadEnabled(){return this.siteStore.getFileUploadEnabled},isSupportedChain(){return this.chainId===this.$config.public.supportedChainId}},methods:{processUploadedFileUrl(e){this.imageLink=e,this.currentTab="paste"},async submitToBlockchain(){this.waitingSubmit=!0;const e=new U(["function getDomainData(string calldata _domainName) public view returns(string memory)","function editData(string calldata _domainName, string calldata _data) external"]),s=new P(this.$config.public.punkTldAddress,e,this.signer);let o=await s.getDomainData(String(this.domainNameWithoutTld).toLowerCase());try{o=JSON.parse(o)}catch{o={}}o.image=this.imageLink;try{const n=await s.editData(String(this.domainNameWithoutTld).toLowerCase(),JSON.stringify(o)),t=this.toast({component:q,props:{text:"Please wait for your transaction to confirm. Click on this notification to see transaction in the block explorer."}},{type:"info",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+n.hash,"_blank").focus()}),a=await n.wait();a.status===1?(this.waitingSubmit=!1,this.toast.dismiss(t),this.toast("You have successfully changed your profile image!",{type:"success",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+n.hash,"_blank").focus()}),this.$emit("processFileUrl",this.imageLink),document.getElementById("closeChangeImageModal"+this.componentId).click()):(this.waitingSubmit=!1,this.toast.dismiss(t),this.toast("Transaction has failed.",{type:"error",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+n.hash,"_blank").focus()}),console.log(a))}catch(n){console.error(n);try{let t=n.message.split("reason=")[1];t=t.split(", method=")[0],t=t.replace(/"/g,""),t=t.replace("execution reverted:","Error:"),console.log(t),this.toast(t,{type:"error"})}catch{this.toast("Transaction has failed.",{type:"error"})}this.waitingSubmit=!1}this.waitingSubmit=!1}},setup(){const{signer:e,chainId:s,isActivated:o}=N(),n=J(),t=S();return{signer:e,chainId:s,isActivated:o,siteStore:n,toast:t}},watch:{fileUploadEnabled(){this.fileUploadEnabled?this.currentTab="upload":this.currentTab="paste"},imageLink(e,s){s&&(this.currentTab="paste")}}},ee=["id","aria-labelledby"],te={class:"modal-dialog"},ie={class:"modal-content"},se={class:"modal-header"},oe=["id"],ne=["id"],ae={class:"modal-body mb-4"},re={class:"nav nav-tabs nav-fill"},le={class:"nav-item"},ce=["disabled"],de={class:"nav-item"},ue={class:"tab-content mt-3"},me={key:0},he={key:1},pe=i("p",null,"Submit the image link to blockchain",-1),be={key:0,class:"mb-3"},ge=i("small",null,"If image didn't appear above, then something is wrong with the link you added (wait until the loading indicator completes).",-1),fe=["disabled"],_e={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function ke(e,s,o,n,t,a){const p=b("FileUploadInput"),u=b("Image"),f=b("ConnectWalletButton"),k=b("SwitchChainButton");return r(),c("div",{class:"modal fade",id:"changeImageModal"+o.componentId,tabindex:"-1","aria-labelledby":"changeImageModalLabel"+o.componentId,"aria-hidden":"true"},[i("div",te,[i("div",ie,[i("div",se,[i("h1",{class:"modal-title fs-5",id:"changeImageModalLabel"+o.componentId},"Change your profile picture",8,oe),i("button",{id:"closeChangeImageModal"+o.componentId,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,8,ne)]),i("div",ae,[i("ul",re,[i("li",le,[i("button",{disabled:!this.fileUploadEnabled,class:C(["nav-link",t.currentTab==="upload"?"active":""]),onClick:s[0]||(s[0]=_=>t.currentTab="upload")}," Upload ",10,ce)]),i("li",de,[i("button",{class:C(["nav-link",t.currentTab==="paste"?"active":""]),onClick:s[1]||(s[1]=_=>t.currentTab="paste")}," Paste Link ",2)])]),i("div",ue,[t.currentTab==="upload"?(r(),c("div",me,[i("p",null,"Upload your new profile image "+d(o.domainName)+".",1),m(p,{btnCls:"btn btn-primary",maxFileSize:e.$config.public.fileUploadSizeLimit,storageType:o.storageType,onProcessUploadedFileUrl:a.processUploadedFileUrl},null,8,["maxFileSize","storageType","onProcessUploadedFileUrl"])])):l("",!0),t.currentTab==="paste"?(r(),c("div",he,[pe,L(i("input",{"onUpdate:modelValue":s[2]||(s[2]=_=>t.imageLink=_),type:"text",class:"form-control mb-3",placeholder:"Enter http link to file"},null,512),[[D,t.imageLink]]),t.imageLink?(r(),c("div",be,[m(u,{url:t.imageLink,cls:"img-thumbnail img-fluid",style:{"max-width":"100px"}},null,8,["url"]),ge])):l("",!0),n.isActivated&&a.isSupportedChain?(r(),c("button",{key:1,class:"btn btn-primary",onClick:s[3]||(s[3]=(..._)=>a.submitToBlockchain&&a.submitToBlockchain(..._)),disabled:!t.imageLink||t.waitingSubmit},[t.waitingSubmit?(r(),c("span",_e)):l("",!0),h(" Submit to blockchain ")],8,fe)):l("",!0),n.isActivated?l("",!0):(r(),g(f,{key:2,class:"btn btn-outline-primary mt-2 mb-2",btnText:"Connect Wallet"})),n.isActivated&&!a.isSupportedChain?(r(),g(k,{key:3})):l("",!0)])):l("",!0)])])])])],8,ee)}const we=y(X,[["render",ke]]),ye={name:"PunkProfile",props:["pAddress","pDomain"],data(){return{balanceAp:0,balanceChatTokenWei:0,domain:this.pDomain,newEmail:null,newImageLink:null,uAddress:this.pAddress,uBalance:0,waitingDataLoad:!1,waitingImageUpdate:!1}},components:{ChangePfpModal:we,ProfileImage:Y},mounted(){(!this.pAddress||!this.pDomain)&&this.fetchAddressAndDomain()},computed:{balanceChatToken(){const e=A(this.balanceChatTokenWei);return e>=0?Math.floor(Number(e)):Number(e).toFixed(4)},balanceEth(){const e=A(this.uBalance);return e>0?Number(e).toFixed(2):Number(e).toFixed(4)},isCurrentUser(){return String(this.uAddress).toLowerCase()===String(this.address).toLowerCase()},domainWithoutExtension(){return this.domain?String(this.domain).replace(this.$config.public.tldName,""):null}},methods:{changeCurrentTab(e){this.currentTab=e,localStorage.setItem("profileCurrentTab",e)},async fetchAddressAndDomain(){if(this.waitingDataLoad=!0,this.$route.query.id){const s=this.$route.query.id;s.includes(".")?this.domain=s:this.uAddress=s}else this.uAddress=this.address;!this.domain&&this.uAddress&&(this.domain=Q(window,this.uAddress));let e=this.$getFallbackProvider(this.$config.public.supportedChainId);if(this.isActivated&&this.chainId===this.$config.public.supportedChainId&&(e=this.signer),!this.domain&&this.uAddress){const s=await Z(this.uAddress,e);s&&(this.domain=String(s).replace(this.$config.public.tldName,"")+this.$config.public.tldName,I(window,this.uAddress,this.domain))}if(this.domain&&!this.uAddress){const s=await G(String(this.domain).toLowerCase().split(".")[0],e);s!==x&&(this.uAddress=s),this.domain=String(this.domain).replace(this.$config.public.tldName,"")+this.$config.public.tldName,I(window,this.uAddress,this.domain)}await this.fetchBalance()},async fetchBalance(){if(this.uAddress){let e=this.$getFallbackProvider(this.$config.public.supportedChainId);if(this.uBalance=await e.getBalance(this.uAddress),this.$config.public.chatTokenAddress){const s=new U(["function balanceOf(address owner) view returns (uint256)"]),o=new P(this.$config.public.chatTokenAddress,s,e);this.balanceChatTokenWei=await o.balanceOf(this.uAddress)}this.$config.public.activityPointsAddress&&this.$config.public.showFeatures.activityPoints&&(this.balanceAp=await K(this.uAddress,e))}},async insertImage(e){this.newImageLink=e,e&&R(window,this.domainWithoutExtension,{image:e},"img")}},setup(){const{address:e,balance:s,chainId:o,isActivated:n,signer:t}=N(),a=j(),p=S();return{address:e,balance:s,chainId:o,isActivated:n,userStore:a,shortenAddress:W,signer:t,toast:p}},watch:{address(){this.fetchAddressAndDomain()}}},Ce={class:"card border"},ve={class:"card-body"},Te={class:"fs-3"},Ae={class:"row"},Ie={class:"col-md-3 mt-3"},Se={class:"col-md-9 mt-3"},Ue={key:0,class:"mb-3"},Pe={key:1,class:"mb-3"},Ne={class:"mt-4 muted-text",style:{"font-size":"14px"}},$e={class:"me-4"},Be=i("i",{class:"bi bi-wallet me-1"},null,-1),Fe={key:0,class:"me-4"},Le=i("i",{class:"bi bi-wallet me-1"},null,-1),De={key:1,class:"me-4"},xe=i("i",{class:"bi bi-wallet me-1"},null,-1),Ee={class:"me-4"},Me=i("i",{class:"bi bi-box-arrow-up-right me-2"},null,-1),We=["href"],je={key:2,class:"mt-2"},Ve={class:"dropdown mt-2"},ze=i("button",{class:"btn btn-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[i("i",{class:"bi bi-sliders"}),h(" Profile settings ")],-1),He={class:"dropdown-menu"},qe=["data-bs-target"],Oe=i("i",{class:"bi bi-person-circle"},null,-1),Je=i("span",{class:"dropdown-item cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#changeUsernameModal"},[i("i",{class:"bi bi-pencil-square"}),h(" Change your username ")],-1),Ye=i("i",{class:"bi bi-send"},null,-1);function Ze(e,s,o,n,t,a){const p=b("ProfileImage"),u=E,f=b("ChangePfpModal");return r(),c("div",null,[i("div",Ce,[i("div",ve,[i("p",Te,[i("i",{class:"bi bi-arrow-left-circle cursor-pointer",onClick:s[0]||(s[0]=k=>e.$router.back())})]),i("div",Ae,[i("div",Ie,[(r(),g(p,{key:t.domain,class:"img-fluid img-thumbnail rounded-circle force-circle col-6 col-md-12",domain:t.domain,image:t.newImageLink},null,8,["domain","image"]))]),i("div",Se,[t.domain&&!a.isCurrentUser?(r(),c("h3",Ue,d(v(T)(t.domain)),1)):l("",!0),t.domain&&a.isCurrentUser?(r(),c("h3",Pe,d(v(T)(n.userStore.getDefaultDomain)),1)):l("",!0),i("div",Ne,[i("p",$e,[Be,h(" "+d(a.balanceEth)+" "+d(e.$config.public.tokenSymbol),1)]),e.$config.public.chatTokenAddress?(r(),c("p",Fe,[Le,h(" "+d(a.balanceChatToken)+" "+d(e.$config.public.chatTokenSymbol),1)])):l("",!0),e.$config.public.activityPointsAddress&&e.$config.public.showFeatures.activityPoints?(r(),c("p",De,[xe,h(" "+d(t.balanceAp)+" AP ",1)])):l("",!0),i("p",Ee,[Me,i("a",{href:e.$config.public.blockExplorerBaseUrl+"/address/"+t.uAddress,target:"_blank",class:"body-color hover-color",style:{"text-decoration":"none"}},d(n.shortenAddress(t.uAddress)),9,We)])]),a.isCurrentUser?(r(),c("div",je,[i("div",Ve,[ze,i("div",He,[i("span",{class:"dropdown-item cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#changeImageModal"+e.$.uid},[Oe,h(" Change your profile picture ")],8,qe),Je])])])):l("",!0),t.domain&&!a.isCurrentUser&&e.$config.public.showFeatures.sendTokens?(r(),g(u,{key:3,class:"btn btn-primary mt-2",to:"/send-tokens/?to="+t.domain},{default:w(()=>[Ye,h(" Send a tip ")]),_:1},8,["to"])):l("",!0)])])]),a.isCurrentUser?(r(),g(f,{key:t.domain,domainName:t.domain,componentId:e.$.uid,storageType:"arweave",onProcessFileUrl:a.insertImage},null,8,["domainName","componentId","onProcessFileUrl"])):l("",!0)])])}const Ge=y(ye,[["render",Ze]]),Ke={name:"Profile",components:{PunkProfile:Ge},setup(){}};function Qe(e,s,o,n,t,a){const p=B,u=F,f=$,k=b("PunkProfile");return r(),c(M,null,[m(f,null,{default:w(()=>[m(p,null,{default:w(()=>[h("Profile | "+d(e.$config.public.projectMetadataTitle),1)]),_:1}),m(u,{name:"description",content:"Check out this profile on "+e.$config.public.projectName+"!"},null,8,["content"]),m(u,{property:"og:image",content:e.$config.public.projectUrl+e.$config.public.previewImageProfile},null,8,["content"]),m(u,{property:"og:description",content:"Check out this profile on "+e.$config.public.projectName+"!"},null,8,["content"]),m(u,{name:"twitter:image",content:e.$config.public.projectUrl+e.$config.public.previewImageProfile},null,8,["content"]),m(u,{name:"twitter:description",content:"Check out this profile on "+e.$config.public.projectName+"!"},null,8,["content"])]),_:1}),(r(),g(k,{key:e.$route.query.id,class:"mt-1"}))],64)}const mt=y(Ke,[["render",Qe]]);export{mt as default};
