import{H as C,M}from"./components.4780fbf2.js";import{a as f,al as T,ae as x,b as _,f as b,e as s,w as m,c as l,l as p,F as I,r as d,am as N,o as i,i as w}from"./entry.e9f54a4e.js";import{C as k,a as v}from"./ChatFeed.d61d868c.js";import{I as R,C as F}from"./ethers.6b4bcd4d.js";import"./composables.086ed08f.js";import"./textUtils.04f7408a.js";import"./Image.bbfab45e.js";import"./site.a477a34c.js";import"./balanceUtils.2234cc62.js";import"./user.57d29c05.js";import"./SwitchChainButton.097b53cb.js";import"./WaitingToast.0869afeb.js";import"./domainUtils.6b686200.js";import"./storageUtils.91141f3a.js";import"./FileUploadModal.0b25522b.js";import"./FileUploadInput.ec3be7ee.js";const V={data(){return{message:null,reply:null}},components:{ChatFeed:k,ChatMessage:v},created(){this.getMessage()},computed:{getChatContext(){return this.route.query.context},getMessageId(){return this.route.query.id},getReplyId(){return this.route.query.reply},isReply(){return!!this.route.query.reply},mainMessagePage(){return`/post/?id=${this.getMessageId}&context=${this.getChatContext}`}},methods:{async getMessage(){try{const e=this.$getFallbackProvider(this.$config.supportedChainId),a=new R([{inputs:[{internalType:"uint256",name:"mainMsgIndex_",type:"uint256"}],name:"getMainMessage",outputs:[{components:[{internalType:"address",name:"author",type:"address"},{internalType:"uint256",name:"createdAt",type:"uint256"},{internalType:"bool",name:"deleted",type:"bool"},{internalType:"uint256",name:"index",type:"uint256"},{internalType:"uint256",name:"repliesCount",type:"uint256"},{internalType:"string",name:"url",type:"string"}],internalType:"struct ChatFeed.Message",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"mainMsgIndex_",type:"uint256"},{internalType:"uint256",name:"replyMsgIndex_",type:"uint256"}],name:"getReply",outputs:[{components:[{internalType:"address",name:"author",type:"address"},{internalType:"uint256",name:"createdAt",type:"uint256"},{internalType:"bool",name:"deleted",type:"bool"},{internalType:"uint256",name:"index",type:"uint256"},{internalType:"uint256",name:"repliesCount",type:"uint256"},{internalType:"string",name:"url",type:"string"}],internalType:"struct ChatFeed.Message",name:"",type:"tuple"}],stateMutability:"view",type:"function"}]),u=new F(this.getChatContext,a,e);let n,t;n=await u.getMainMessage(this.getMessageId),this.isReply&&(t=await u.getReply(this.getMessageId,this.getReplyId)),n.deleted?this.toast("This message has been deleted.",{type:"info"}):this.message={author:n.author,url:n.url,createdAt:n.createdAt.toNumber(),deleted:n.deleted,repliesCount:n.repliesCount.toNumber(),index:n.index.toNumber()},t&&(t.deleted?this.toast("This reply has been deleted.",{type:"info"}):this.reply={author:t.author,url:t.url,createdAt:t.createdAt.toNumber(),deleted:t.deleted,repliesCount:t.repliesCount.toNumber(),index:t.index.toNumber()})}catch(e){console.error(e),this.toast("Failed to load the message",{type:"error"})}}},setup(){const e=T(),a=x();return{route:e,toast:a}},watch:{getChatContext(e,a){this.getMessage()},getMessageId(e,a){this.getMessage()},getReplyId(e,a){this.getMessage()}}};function j(e,a,u,n,t,r){const o=M,g=C,c=d("ChatMessage"),y=d("ChatFeed"),h=N;return i(),_(I,null,[b("div",null,[s(g,null,{default:m(()=>[s(o,{name:"description",content:"Check out this chat post on "+e.$config.projectName+"!"},null,8,["content"]),s(o,{property:"og:image",content:e.$config.projectUrl+e.$config.previewImagePost},null,8,["content"]),s(o,{property:"og:description",content:"Check out this chat post on "+e.$config.projectName+"!"},null,8,["content"]),s(o,{name:"twitter:image",content:e.$config.projectUrl+e.$config.previewImagePost},null,8,["content"]),s(o,{name:"twitter:description",content:"Check out this chat post on "+e.$config.projectName+"!"},null,8,["content"])]),_:1})]),t.message?(i(),l(c,{key:0,message:t.message,isMainMessage:!0},null,8,["message"])):p("",!0),t.reply?(i(),l(c,{key:1,message:t.reply,isMainMessage:!1},null,8,["message"])):p("",!0),r.isReply?p("",!0):(i(),l(y,{key:2,chatContext:r.getChatContext,mainMessageIndex:r.getMessageId},null,8,["chatContext","mainMessageIndex"])),r.isReply?(i(),l(h,{key:3,to:r.mainMessagePage,class:"btn btn-primary"},{default:m(()=>[w("See other replies")]),_:1},8,["to"])):p("",!0)],64)}const Q=f(V,[["render",j]]);export{Q as default};
