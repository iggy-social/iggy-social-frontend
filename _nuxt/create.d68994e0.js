import{H as D,T as q,M as x}from"./components.89401fa0.js";import{e as A}from"./storageUtils.6b1d1d0c.js";import{g}from"./numberUtils.7a694007.js";import{a as B,ae as M,b as m,e as u,w as C,f as t,l as d,t as l,af as h,ag as f,i as _,u as b,c as w,F as H,r as y,o as c}from"./entry.5680e7ab.js";import{f as E,I,C as v,k as V,u as j}from"./ethers.391428e7.js";import{C as W,S as L}from"./SwitchChainButton.dce7a788.js";import{I as R}from"./Image.53750f45.js";import{W as k}from"./WaitingToast.327ff00b.js";import{F as z}from"./FileUploadModal.a0054a7d.js";import{u as K}from"./user.da52f26c.js";import"./composables.e3f6b801.js";import"./site.cb3cd003.js";import"./balanceUtils.5f489592.js";import"./FileUploadInput.b97760b9.js";const O={name:"NftCreate",data(){return{cDescription:null,cImage:null,cName:null,cSymbol:null,isMounted:!1,launchpadPaused:null,nftName:null,createPriceWei:null,ratio:null,uniqueId:null,waitingCreate:!1,waitingData:!1}},components:{ConnectWalletButton:W,FileUploadModal:z,Image:R,SwitchChainButton:L,WaitingToast:k},mounted(){this.isMounted=!0,this.ratio=this.$config.nftDefaultRatio,this.fetchData()},computed:{cleanDescription(){return this.cDescription?this.cDescription.replace(/"/g,"'"):null},createPrice(){if(!this.createPriceWei)return null;const e=Number(E(this.createPriceWei));return e>.01?Number.parseFloat(e.toFixed(5)):e>1e-4?Number.parseFloat(e.toFixed(7)):Number.parseFloat(e)},fieldsValid(){return this.cName&&this.cSymbol&&this.cImage&&this.cDescription&&this.ratio},isSupportedChain(){return this.chainId===this.$config.supportedChainId}},methods:{calculatePrice(e,o){const n=Number(e)-1;return(n*(n+1)*(2*n+1)-(n-1)*n*(2*(n-1)+1))*1e4/42069*Number(o)/31337},async createCollection(){if(this.waitingCreate=!0,this.signer){const e=new I([`function launch(
              address contractOwner_,
              address referrer_,
              string memory mdDescription_,
              string memory mdImage_,
              string memory mdName_,
              string memory name_,
              string memory symbol_,
              string calldata uniqueId_, 
              uint256 ratio_
            ) external payable`,"function getNftContractAddress(string calldata _uniqueId) external view returns(address)"]),o=new v(this.$config.nftLaunchpadBondingAddress,e,this.signer);try{const n=await o.launch(this.address,A(window),this.cleanDescription,this.cImage,this.cName,this.cName,this.cSymbol,this.uniqueId,V(String(this.ratio)),{value:this.createPriceWei}),a=this.toast({component:k,props:{text:"Please wait for your transaction to confirm. Click on this notification to see transaction in the block explorer."}},{type:"info",onClick:()=>window.open(this.$config.blockExplorerBaseUrl+"/tx/"+n.hash,"_blank").focus()}),i=await n.wait();if(i.status===1){this.toast.dismiss(a),this.toast("You have successfully created an NFT collection!",{type:"success",onClick:()=>window.open(this.$config.blockExplorerBaseUrl+"/tx/"+n.hash,"_blank").focus()});const s=await o.getNftContractAddress(this.uniqueId);this.$router.push({path:"/nft/collection",query:{id:s}}),this.waitingCreate=!1}else this.toast.dismiss(a),this.waitingCreate=!1,this.toast("Transaction has failed.",{type:"error",onClick:()=>window.open(this.$config.blockExplorerBaseUrl+"/tx/"+n.hash,"_blank").focus()}),console.log(i)}catch(n){console.error(n);try{let a=n.message.split("reason=")[1];a=a.split(", method=")[0],a=a.replace(/"/g,""),a=a.replace("execution reverted:","Error:"),console.log(a),this.toast(a,{type:"error"})}catch{this.toast("Transaction has failed.",{type:"error"})}this.waitingCreate=!1}}this.waitingCreate=!1},async fetchData(){this.waitingData=!0;let e=this.$getFallbackProvider(this.$config.supportedChainId);this.isActivated&&this.chainId===this.$config.supportedChainId&&(e=this.signer);const o=new I(["function paused() public view returns(bool)","function isUniqueIdAvailable(string calldata _uniqueId) public view returns(bool)","function price() public view returns(uint256)"]),n=new v(this.$config.nftLaunchpadBondingAddress,o,e);this.launchpadPaused=await n.paused(),this.uniqueId=Math.random().toString(36).slice(2),await n.isUniqueIdAvailable(this.uniqueId)||(this.uniqueId=Math.random().toString(36).slice(10)),this.createPriceWei=await n.price(),this.waitingData=!1},insertImage(e){this.cImage=e.replace("?.img","")}},setup(){const{address:e,chainId:o,isActivated:n,signer:a}=j(),i=K(),s=M();return{address:e,chainId:o,isActivated:n,signer:a,toast:s,userStore:i}}},Y={class:"card border scroll-500"},G={class:"card-body"},J={class:"fs-3"},Q=t("h3",{class:"mb-4 mt-3"},"Create NFT Collection",-1),X={key:0,class:"d-flex justify-content-center mb-3"},Z=t("span",{class:"spinner-border spinner-border-lg",role:"status","aria-hidden":"true"},null,-1),$=[Z],ee={key:1,class:"mb-4"},te={class:"mb-4"},ie=t("label",{for:"cName",class:"form-label"},"Collection Name",-1),oe=t("div",{id:"cNameHelp",class:"form-text"},"This is not a token name, but the whole collection name.",-1),ne={class:"mb-4"},ae=t("label",{for:"cSymbol",class:"form-label"},"Collection Symbol",-1),se=t("div",{id:"cSymbolHelp",class:"form-text"}," Collection symbol (required by the ERC-721 smart contract, but not really important). ",-1),re={class:"mb-2"},le=t("label",{for:"cImage",class:"form-label"},"Collection Image (can be changed later)",-1),ce={class:"input-group","aria-describedby":"cImageHelp",id:"cImage"},de=["data-bs-target"],ue=t("i",{class:"bi bi-file-earmark-image-fill"},null,-1),me=t("div",{id:"cImageHelp",class:"form-text"}," Even if you want a generative PFP collection, put a single preview image for now and you will change it to a metadata link later. ",-1),pe={key:2,class:"mb-4"},he=t("br",null,null,-1),fe=t("small",null,"If image didn't appear above, then something is wrong with the link you added (wait until the loading indicator completes). If you have an IPFS link, it also helps to cut/paste the same link a couple of times.",-1),ge={class:"mb-4"},be=t("label",{for:"cDescription",class:"form-label"},"Collection Description (can be changed later)",-1),ye=t("div",{id:"cDescriptionHelp",class:"form-text"},"Too long description means higher gas cost for storing it.",-1),_e={class:"mb-4"},we=t("label",{for:"uniqueId",class:"form-label"},"Unique ID (store it - just in case)",-1),Ce=t("div",{id:"uniqueIdHelp",class:"form-text"}," This is just in case the frontend will not show you the NFT collection address and you'll need to find it manually. ",-1),Ie={class:"mb-4"},ve=t("label",{for:"ratio",class:"form-label"},"Bonding Curve Ratio",-1),ke={id:"ratioHelp",class:"form-text"},Ne={class:"d-flex justify-content-center mt-5 mb-5"},Se=["disabled"],Ue={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Pe={key:1,disabled:!0,class:"btn btn-primary"};function Te(e,o,n,a,i,s){const N=q,p=x,S=D,U=y("Image"),P=y("ConnectWalletButton"),T=y("SwitchChainButton"),F=y("FileUploadModal");return c(),m(H,null,[u(S,null,{default:C(()=>[u(N,null,{default:C(()=>[_("Create NFT Collection | "+l(e.$config.projectMetadataTitle),1)]),_:1}),u(p,{property:"og:title",content:"Create NFT Collection | "+e.$config.projectMetadataTitle},null,8,["content"]),u(p,{name:"description",content:"Create your very own NFT collection on "+e.$config.projectName+"!"},null,8,["content"]),u(p,{property:"og:image",content:e.$config.projectUrl+e.$config.previewImageNftCreate},null,8,["content"]),u(p,{property:"og:description",content:"Create your very own NFT collection on "+e.$config.projectName+"!"},null,8,["content"]),u(p,{name:"twitter:image",content:e.$config.projectUrl+e.$config.previewImageNftCreate},null,8,["content"]),u(p,{name:"twitter:description",content:"Create your very own NFT collection on "+e.$config.projectName+"!"},null,8,["content"])]),_:1}),t("div",Y,[t("div",G,[t("p",J,[t("i",{class:"bi bi-arrow-left-circle cursor-pointer",onClick:o[0]||(o[0]=r=>e.$router.back())})]),Q,i.waitingData?(c(),m("div",X,$)):d("",!0),s.createPrice?(c(),m("p",ee," Price for creating a collection is "+l(s.createPrice)+" "+l(e.$config.tokenSymbol)+". ",1)):d("",!0),t("div",te,[ie,h(t("input",{type:"text",class:"form-control",id:"cName","aria-describedby":"cNameHelp",placeholder:"e.g. Crypto Punks","onUpdate:modelValue":o[1]||(o[1]=r=>i.cName=r)},null,512),[[f,i.cName]]),oe]),t("div",ne,[ae,h(t("input",{type:"text",class:"form-control",id:"cSymbol","aria-describedby":"cSymbolHelp",placeholder:"e.g. PUNKS","onUpdate:modelValue":o[2]||(o[2]=r=>i.cSymbol=r)},null,512),[[f,i.cSymbol]]),se]),t("div",re,[le,t("div",ce,[h(t("input",{"onUpdate:modelValue":o[3]||(o[3]=r=>i.cImage=r),type:"text",class:"form-control",placeholder:"Enter image URL or click the upload button"},null,512),[[f,i.cImage]]),a.isActivated&&e.$config.fileUploadEnabled!==""?(c(),m("button",{key:0,class:"btn btn-outline-secondary rounded-end-2","data-bs-toggle":"modal","data-bs-target":"#fileUploadModal"+e.$.uid},[ue,_(" Upload ")],8,de)):d("",!0)]),me]),i.cImage?(c(),m("div",pe,[u(U,{url:i.cImage,alt:"Image",cls:"img-thumbnail img-fluid",style:{"max-width":"100px"}},null,8,["url"]),he,fe])):d("",!0),t("div",ge,[be,h(t("input",{type:"text",class:"form-control",id:"cDescription","aria-describedby":"cDescriptionHelp",placeholder:"Keep it short and sweet.","onUpdate:modelValue":o[4]||(o[4]=r=>i.cDescription=r)},null,512),[[f,i.cDescription]]),ye]),t("div",_e,[we,h(t("input",{type:"text",class:"form-control",id:"uniqueId","aria-describedby":"uniqueIdHelp",disabled:"",readonly:"","onUpdate:modelValue":o[5]||(o[5]=r=>i.uniqueId=r)},null,512),[[f,i.uniqueId]]),Ce]),t("div",Ie,[ve,h(t("input",{type:"text",class:"form-control",id:"ratio","aria-describedby":"ratioHelp","onUpdate:modelValue":o[6]||(o[6]=r=>i.ratio=r)},null,512),[[f,i.ratio]]),t("div",ke," Price for mint #1 will be "+l(b(g)(s.calculatePrice(2,i.ratio)))+" "+l(e.$config.tokenSymbol)+", for mint #5 will be "+l(b(g)(s.calculatePrice(5,i.ratio)))+" "+l(e.$config.tokenSymbol)+", for mint #15 will be "+l(b(g)(s.calculatePrice(15,i.ratio)))+" "+l(e.$config.tokenSymbol)+", for mint #30 will be "+l(b(g)(s.calculatePrice(30,i.ratio)))+" "+l(e.$config.tokenSymbol)+", etc. ",1)]),t("div",Ne,[a.isActivated&&s.isSupportedChain&&!i.launchpadPaused?(c(),m("button",{key:0,disabled:i.waitingCreate||!s.fieldsValid,class:"btn btn-primary",type:"button",onClick:o[7]||(o[7]=(...r)=>s.createCollection&&s.createCollection(...r))},[i.waitingData||i.waitingCreate?(c(),m("span",Ue)):d("",!0),_(" Create NFT Collection for "+l(s.createPrice)+" "+l(e.$config.tokenSymbol),1)],8,Se)):d("",!0),a.isActivated&&s.isSupportedChain&&i.launchpadPaused?(c(),m("button",Pe," Paused ")):d("",!0),!a.isActivated&&!s.isSupportedChain?(c(),w(P,{key:2,class:"btn btn-primary",btnText:"Connect wallet"})):d("",!0),a.isActivated&&!s.isSupportedChain?(c(),w(T,{key:3})):d("",!0)]),i.isMounted?(c(),w(F,{key:3,onProcessFileUrl:s.insertImage,title:"Upload your NFT image",infoText:"Upload the NFT image.",storageType:e.$config.fileUploadStorageType,componentId:e.$.uid,maxFileSize:e.$config.fileUploadSizeLimit},null,8,["onProcessFileUrl","storageType","componentId","maxFileSize"])):d("",!0)])])],64)}const ze=B(O,[["render",Te]]);export{ze as default};
