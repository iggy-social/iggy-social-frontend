import{H as w,T as S,M as C}from"./components.fa4f4b6a.js";import{u as U}from"./notifications.6db406fa.js";import{a as y,r as k,o as e,b as n,f as o,e as l,w as u,c as v,i as f,t as p,l as a,a1 as I,K as x,F as g,P as L}from"./entry.f8784ff1.js";import{E as N}from"./ethers.1b35c37b.js";import{P,g as O}from"./domainUtils.fc07d33f.js";import{a as b,s as T}from"./storageUtils.6338e1d4.js";import{g as M}from"./textUtils.a412895c.js";import"./composables.d8cc695a.js";const B={name:"OrbisNotification",props:["notification"],components:{ProfileImage:P},data(){return{authorAddress:null,authorDomain:null,authorImage:null,lengthLimit:150}},mounted(){this.notification&&(this.authorAddress=this.notification.user_notifiying_details.did.split(":")[4],this.authorDomain=b(window,this.authorAddress),!this.authorDomain&&this.notification.user_notifiying_details?.profile?.username&&(this.authorDomain=this.notification.user_notifiying_details.profile.username),this.authorImage=sessionStorage.getItem(String(this.authorAddress).toLowerCase()+"-img"),!this.authorImage&&this.notification.user_notifiying_details?.profile?.pfp&&(this.authorImage=this.notification.user_notifiying_details.profile.pfp),this.fetchUserDomain())},computed:{getNotificationAction(){return this.notification.family==="reply_to"?"reply":this.notification.family==="reaction"&&this.notification.content.type==="like"?"like":""},getNotificationContent(){if(this.notification?.content?.body){const t=this.notification.content.body;return t.length>this.lengthLimit?t.substring(0,this.lengthLimit)+"...":t}else if(this.notification?.post_details?.content?.body){const t=this.notification.post_details.content.body;return t.length>this.lengthLimit?t.substring(0,this.lengthLimit)+"...":t}return""},getPostStreamId(){return this.notification?.post_details?.stream_id?this.notification.post_details.stream_id:null},getUsernameOrAddress(){return this.authorDomain?this.authorDomain:this.authorAddress},getUsernameOrShortAddress(){if(this.notification)return this.authorAddress=this.notification.user_notifiying_details.did.split(":")[4],this.authorDomain=b(window,this.authorAddress),this.authorDomain?M(this.authorDomain):N(this.authorAddress)}},methods:{getDomainName:O,async fetchUserDomain(){const t=await this.getDomainName(this.authorAddress);t&&(this.authorDomain=t,T(window,this.authorAddress,t+this.$config.tldName))},openPostDetails(){this.$router.push({name:"post",query:{id:this.getPostStreamId}})}},setup(){return{shortenAddress:N}}},$={class:"card mb-3 border"},V={class:"card-body row"},E={class:"col-2 col-md-1 pfp-sizing"},H={class:"col-10 col-md-11 post-sizing"},j={class:"mt-0 link-without-color"},z={key:0},F=o("i",{class:"bi bi-chat-dots-fill ms-1 text-primary"},null,-1),q={key:1},K=o("i",{class:"bi bi-heart-fill ms-1 text-primary"},null,-1);function R(t,i,A,c,r,s){const m=k("ProfileImage"),h=I;return e(),n("div",$,[o("div",V,[o("div",E,[l(h,{to:"/profile/?id="+s.getUsernameOrAddress},{default:u(()=>[(e(),v(m,{class:"img-fluid rounded-circle pfp-img force-circle",address:r.authorAddress,domain:r.authorDomain,image:r.authorImage,key:r.authorAddress},null,8,["address","domain","image"]))]),_:1},8,["to"])]),o("div",H,[o("p",j,[l(h,{class:"link-without-color hover-color",to:"/profile/?id="+s.getUsernameOrAddress},{default:u(()=>[f(p(s.getUsernameOrShortAddress),1)]),_:1},8,["to"]),s.getNotificationAction==="reply"?(e(),n("span",z,[F,f(" replied to your post ")])):a("",!0),s.getNotificationAction==="like"?(e(),n("span",q,[K,f(" liked your post ")])):a("",!0)]),o("p",{class:"mb-0 cursor-pointer text-break",onClick:i[0]||(i[0]=(..._)=>s.openPostDetails&&s.openPostDetails(..._))},p(s.getNotificationContent),1)])])])}const W=y(B,[["render",R]]),G={name:"Notifications",components:{OrbisNotification:W},data(){return{clearingNotifications:!1}},methods:{async clearNotifications(){this.clearingNotifications=!0;let t=Math.floor(Date.now()/1e3),i=await this.$orbis.setNotificationsReadTime({type:"social",timestamp:Number(t),context:this.$config.chatChannels.general});i.status===200?(this.notificationsStore.setNotifications([]),this.notificationsStore.setUnreadNotificationsCount(0),this.clearingNotifications=!1):(console.log(i),this.toast(i.result,{type:"error"}),this.clearingNotifications=!1)}},setup(){const t=U(),i=x();return{notificationsStore:t,toast:i}}},J={class:"card border"},Q={class:"card-body"},X=o("i",{class:"bi bi-arrow-left-circle cursor-pointer"},null,-1),Y=[X],Z={class:"mb-3 mt-3"},tt={key:0,class:"spinner-border spinner-border-md",role:"status","aria-hidden":"true"},it=["disabled"],ot={key:0,class:"bi bi-trash3-fill"},et={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},st={key:0,class:"mt-5 mb-5"},nt=o("p",null,"No unread notifications.",-1),rt=[nt];function at(t,i,A,c,r,s){const m=S,h=C,_=w,D=k("OrbisNotification");return e(),n(g,null,[l(_,null,{default:u(()=>[l(m,null,{default:u(()=>[f("Notifications | "+p(t.$config.projectMetadataTitle),1)]),_:1}),l(h,{property:"og:title",content:"Notifications | "+t.$config.projectMetadataTitle},null,8,["content"])]),_:1}),o("div",J,[o("div",Q,[o("p",{class:"fs-3",onClick:i[0]||(i[0]=d=>t.$router.back())},Y),o("h3",Z,[f(" Notifications "),c.notificationsStore.getLoadingNotifications?(e(),n("span",tt)):a("",!0),c.notificationsStore.getUnreadNotificationsCount>0&&!c.notificationsStore.getLoadingNotifications?(e(),n("button",{key:1,class:"btn btn-primary btn-sm",onClick:i[1]||(i[1]=(...d)=>s.clearNotifications&&s.clearNotifications(...d)),disabled:r.clearingNotifications},[r.clearingNotifications?a("",!0):(e(),n("i",ot)),r.clearingNotifications?(e(),n("span",et)):a("",!0)],8,it)):a("",!0)]),(e(!0),n(g,null,L(c.notificationsStore.getNotifications,d=>(e(),n("div",{key:d},[l(D,{notification:d},null,8,["notification"])]))),128)),c.notificationsStore.getUnreadNotificationsCount===0?(e(),n("div",st,rt)):a("",!0)])])],64)}const pt=y(G,[["render",at]]);export{pt as default};
