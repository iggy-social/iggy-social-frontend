import{_ as Y,a8 as H,c as v,o as _,a as x,g as L,d as J,A as W,t as Q,F as Z}from"#entry";function g(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?g=function(e){return typeof e}:g=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(r)}function X(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function ee(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function te(r,e,t){return e&&ee(r.prototype,e),r}function K(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function C(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function h(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?C(Object(t),!0).forEach(function(n){K(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):C(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function re(r,e){if(r){if(typeof r=="string")return k(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return k(r,e)}}function k(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function ne(r,e){var t;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(t=re(r))||e){t&&(r=t);var n=0,i=function(){};return{s:i,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(s){throw s},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,l;return{s:function(){t=r[Symbol.iterator]()},n:function(){var s=t.next();return o=s.done,s},e:function(s){a=!0,l=s},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw l}}}}var u={MANDATORY_INITIALIZATION_MISSING:{message:"Missing urlEndpoint during SDK initialization",help:""},INVALID_TRANSFORMATION_POSITION:{message:"Invalid transformationPosition parameter",help:""},PRIVATE_KEY_CLIENT_SIDE:{message:"privateKey should not be passed on the client side",help:""},MISSING_UPLOAD_DATA:{message:"Missing data for upload",help:""},MISSING_UPLOAD_FILE_PARAMETER:{message:"Missing file parameter for upload",help:""},MISSING_UPLOAD_FILENAME_PARAMETER:{message:"Missing fileName parameter for upload",help:""},MISSING_AUTHENTICATION_ENDPOINT:{message:"Missing authentication endpoint for upload",help:""},MISSING_PUBLIC_KEY:{message:"Missing public key for upload",help:""},AUTH_ENDPOINT_TIMEOUT:{message:"The authenticationEndpoint you provided timed out in 60 seconds",help:""},AUTH_ENDPOINT_NETWORK_ERROR:{message:"Request to authenticationEndpoint failed due to network error",help:""},AUTH_INVALID_RESPONSE:{message:"Invalid response from authenticationEndpoint. The SDK expects a JSON response with three fields i.e. signature, token and expire.",help:""},UPLOAD_ENDPOINT_NETWORK_ERROR:{message:"Request to ImageKit upload endpoint failed due to network error",help:""},INVALID_UPLOAD_OPTIONS:{message:"Invalid uploadOptions parameter",help:""},MISSING_SIGNATURE:{message:"Missing signature for upload. The SDK expects token, signature and expire for authentication.",help:""},MISSING_TOKEN:{message:"Missing token for upload. The SDK expects token, signature and expire for authentication.",help:""},MISSING_EXPIRE:{message:"Missing expire for upload. The SDK expects token, signature and expire for authentication.",help:""},INVALID_TRANSFORMATION:{message:"Invalid transformation parameter. Please include at least pre, post, or both.",help:""},INVALID_PRE_TRANSFORMATION:{message:"Invalid pre transformation parameter.",help:""},INVALID_POST_TRANSFORMATION:{message:"Invalid post transformation parameter.",help:""}};function c(r,e,t){typeof t=="function"&&(r?t(e,null):t(null,e))}function ie(r){var e={},t=r.getAllResponseHeaders();return Object.keys(t).length&&t.trim().split(/[\r\n]+/).map(function(n){return n.split(/: /)}).forEach(function(n){e[n[0].trim()]=n[1].trim()}),e}var j=function(e,t){var n=h({},e),i={statusCode:t.status,headers:ie(t)};return Object.defineProperty(n,"$ResponseMetadata",{value:i,enumerable:!1,writable:!1}),n},ae=function(e,t,n){oe(e,t).then(function(i){return c(!1,i,n)},function(i){return c(!0,i,n)})},oe=function(e,t){return new Promise(function(n,i){e.open("POST","https://upload.imagekit.io/api/v1/files/upload"),e.onerror=function(o){return i(u.UPLOAD_ENDPOINT_NETWORK_ERROR)},e.onload=function(){if(e.status===200)try{var o=JSON.parse(e.responseText),a=j(o,e);return n(a)}catch(s){return i(s)}else try{var o=JSON.parse(e.responseText),l=j(o,e);return i(l)}catch(s){return i(s)}},e.send(t)})},se=function(e,t,n,i){if(!t.file){c(!0,u.MISSING_UPLOAD_FILE_PARAMETER,i);return}if(!t.fileName){c(!0,u.MISSING_UPLOAD_FILENAME_PARAMETER,i);return}if(!n.publicKey){c(!0,u.MISSING_PUBLIC_KEY,i);return}if(!t.token){c(!0,u.MISSING_TOKEN,i);return}if(!t.signature){c(!0,u.MISSING_SIGNATURE,i);return}if(!t.expire){c(!0,u.MISSING_EXPIRE,i);return}if(t.transformation){if(!(Object.keys(t.transformation).includes("pre")||Object.keys(t.transformation).includes("post"))){c(!0,u.INVALID_TRANSFORMATION,i);return}if(Object.keys(t.transformation).includes("pre")&&!t.transformation.pre){c(!0,u.INVALID_PRE_TRANSFORMATION,i);return}if(Object.keys(t.transformation).includes("post"))if(Array.isArray(t.transformation.post)){var o=ne(t.transformation.post),a;try{for(o.s();!(a=o.n()).done;){var l=a.value;if(l.type==="abs"&&!(l.protocol||l.value)){c(!0,u.INVALID_POST_TRANSFORMATION,i);return}else if(l.type==="transformation"&&!l.value){c(!0,u.INVALID_POST_TRANSFORMATION,i);return}}}catch(I){o.e(I)}finally{o.f()}}else{c(!0,u.INVALID_POST_TRANSFORMATION,i);return}}var s=new FormData,f;for(f in t)f&&(f==="file"&&typeof t.file!="string"?s.append("file",t.file,String(t.fileName)):f==="tags"&&Array.isArray(t.tags)?s.append("tags",t.tags.join(",")):f==="signature"?s.append("signature",t.signature):f==="expire"?s.append("expire",String(t.expire)):f==="token"?s.append("token",t.token):f==="responseFields"&&Array.isArray(t.responseFields)?s.append("responseFields",t.responseFields.join(",")):f==="extensions"&&Array.isArray(t.extensions)?s.append("extensions",JSON.stringify(t.extensions)):f==="customMetadata"&&g(t.customMetadata)==="object"&&!Array.isArray(t.customMetadata)&&t.customMetadata!==null?s.append("customMetadata",JSON.stringify(t.customMetadata)):f==="transformation"&&g(t.transformation)==="object"&&t.transformation!==null?s.append(f,JSON.stringify(t.transformation)):f==="checks"&&t.checks?s.append("checks",t.checks):t[f]!==void 0&&s.append(f,String(t[f])));s.append("publicKey",n.publicKey),ae(e,s,i)},z={width:"w",height:"h",aspectRatio:"ar",background:"bg",border:"b",crop:"c",cropMode:"cm",dpr:"dpr",focus:"fo",quality:"q",x:"x",xCenter:"xc",y:"y",yCenter:"yc",format:"f",videoCodec:"vc",audioCodec:"ac",radius:"r",rotation:"rt",blur:"bl",named:"n",defaultImage:"di",flip:"fl",original:"orig",startOffset:"so",endOffset:"eo",duration:"du",streamingResolutions:"sr",grayscale:"e-grayscale",aiUpscale:"e-upscale",aiRetouch:"e-retouch",aiVariation:"e-genvar",aiDropShadow:"e-dropshadow",aiChangeBackground:"e-changebg",aiRemoveBackground:"e-bgremove",aiRemoveBackgroundExternal:"e-removedotbg",contrastStretch:"e-contrast",shadow:"e-shadow",sharpen:"e-sharpen",unsharpMask:"e-usm",gradient:"e-gradient",progressive:"pr",lossless:"lo",colorProfile:"cp",metadata:"md",opacity:"o",trim:"t",zoom:"z",page:"pg",fontSize:"fs",fontFamily:"ff",fontColor:"co",innerAlignment:"ia",padding:"pa",alpha:"al",typography:"tg",lineHeight:"lh",fontOutline:"fol",fontShadow:"fsh",raw:"raw"},E="query",le="path",fe=E,ue=[le,E],ce=":",pe=",",de="-",p={getDefault:function(){return fe},addAsQueryParameter:function(e){return e.transformationPosition===E},validParameters:function(e){return typeof e.transformationPosition>"u"?!1:ue.indexOf(e.transformationPosition)!=-1},getTransformKey:function(e){return e&&(z[e]||z[e.toLowerCase()])||""},getChainTransformDelimiter:function(){return ce},getTransformDelimiter:function(){return pe},getTransformKeyValueDelimiter:function(){return de}},S=function(e){return typeof window<"u"?btoa(e):Buffer.from(e,"utf8").toString("base64")},b="tr",me=new RegExp("^[a-zA-Z0-9-._/ ]*$"),he=new RegExp("^[a-zA-Z0-9-._ ]*$");function V(r){return typeof r=="string"&&r[r.length-1]=="/"&&(r=r.substring(0,r.length-1)),r}function B(r){return typeof r=="string"&&r[0]=="/"&&(r=r.slice(1)),r}function y(r,e){var t="/",n=new RegExp(t+"{1,}","g");return r.join(t).replace(n,t)}var ge=function(e){if(!e.path&&!e.src)return"";var t,n,i;try{e.path?(i=new URL(e.urlEndpoint).pathname,t=new URL(y([e.urlEndpoint.replace(i,""),e.path]))):(t=new URL(e.src),n=!0)}catch(l){return console.error(l),""}for(var o in e.queryParameters)t.searchParams.append(o,String(e.queryParameters[o]));var a=G(e.transformation);return a&&a.length&&!p.addAsQueryParameter(e)&&!n&&(t.pathname=y([b+p.getChainTransformDelimiter()+a,t.pathname])),i?t.pathname=y([i,t.pathname]):t.pathname=y([t.pathname]),a&&a.length&&(p.addAsQueryParameter(e)||n)?t.searchParams.toString()!==""?"".concat(t.href,"&").concat(b,"=").concat(a):"".concat(t.href,"?").concat(b,"=").concat(a):t.href};function R(r,e){return r=V(B(r)),e==="plain"?"i-".concat(r.replace(/\//g,"@@")):e==="base64"?"ie-".concat(encodeURIComponent(S(r))):me.test(r)?"i-".concat(r.replace(/\//g,"@@")):"ie-".concat(encodeURIComponent(S(r)))}function Ie(r,e){return e==="plain"?"i-".concat(encodeURIComponent(r)):e==="base64"?"ie-".concat(encodeURIComponent(S(r))):he.test(r)?"i-".concat(encodeURIComponent(r)):"ie-".concat(encodeURIComponent(S(r)))}function Ae(r){var e=[];if(r){var t=r.type,n=r.position,i=n===void 0?{}:n,o=r.timing,a=o===void 0?{}:o,l=r.transformation,s=l===void 0?[]:l;if(!t)throw new Error("Overlay type is required");switch(t){case"text":{var f=r;if(!f.text)return;var I=f.encoding||"auto";e.push("l-text"),e.push(Ie(f.text,I))}break;case"image":e.push("l-image");{var m=r,A=m.encoding||"auto";if(m.input)e.push(R(m.input,A));else return}break;case"video":e.push("l-video");{var d=r,$=d.encoding||"auto";if(d.input)e.push(R(d.input,$));else return}break;case"subtitle":e.push("l-subtitle");{var T=r,q=T.encoding||"auto";if(T.input)e.push(R(T.input,q));else return}break;case"solidColor":e.push("l-image"),e.push("i-ik_canvas");{var w=r;if(w.color)e.push("bg-".concat(w.color));else return}break}var P=i.x,M=i.y,O=i.focus;P&&e.push("lx-".concat(P)),M&&e.push("ly-".concat(M)),O&&e.push("lfo-".concat(O));var U=a.start,D=a.end,F=a.duration;U&&e.push("lso-".concat(U)),D&&e.push("leo-".concat(D)),F&&e.push("ldu-".concat(F));var N=G(s);return N&&N.trim()!==""&&e.push(N),e.push("l-end"),e.join(p.getTransformDelimiter())}}function G(r){if(!Array.isArray(r))return"";for(var e=[],t=0,n=r.length;t<n;t++){var i=[];for(var o in r[t]){var a=r[t][o];if(a!=null){if(o==="overlay"&&g(a)==="object"){var l=Ae(a);l&&l.trim()!==""&&i.push(l);continue}var s=p.getTransformKey(o);if(s||(s=o),s!=="")if(["e-grayscale","e-contrast","e-removedotbg","e-bgremove","e-upscale","e-retouch","e-genvar"].includes(s))if(a===!0||a==="-"||a==="true")i.push(s);else continue;else["e-sharpen","e-shadow","e-gradient","e-usm","e-dropshadow"].includes(s)&&(a.toString().trim()===""||a===!0||a==="true")?i.push(s):o==="raw"?i.push(r[t][o]):(s==="di"&&(a=V(B(a||"")),a=a.replace(/\//g,"@@")),s==="sr"&&Array.isArray(a)&&(a=a.join("_")),s==="t"&&a.toString().trim()===""&&(a="true"),i.push([s,a].join(p.getTransformKeyValueDelimiter())))}}i.length&&e.push(i.join(p.getTransformDelimiter()))}return e.join(p.getChainTransformDelimiter())}var ye=function(e,t){return ge(h(h({},t),e))};function Se(r){return r.urlEndpoint}var Te=function(e,t){return function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];if(i.length===t.length&&typeof i[i.length-1]<"u"){if(typeof i[i.length-1]!="function")throw new Error("Callback must be a function.");t.call.apply(t,[e].concat(i))}else return new Promise(function(a,l){var s=function(I){if(I)return l(I);for(var m=arguments.length,A=new Array(m>1?m-1:0),d=1;d<m;d++)A[d-1]=arguments[d];a(A.length>1?A:A[0])};i.pop(),i.push(s),t.call.apply(t,[e].concat(i))})}},Ne=(function(){function r(e){if(X(this,r),K(this,"options",{publicKey:"",urlEndpoint:"",transformationPosition:p.getDefault()}),this.options=h(h({},this.options),e||{}),!Se(this.options))throw u.MANDATORY_INITIALIZATION_MISSING;if(!p.validParameters(this.options))throw u.INVALID_TRANSFORMATION_POSITION}return te(r,[{key:"url",value:function(t){return ye(t,this.options)}},{key:"upload",value:function(t,n,i){var o;if(typeof n=="function"?o=n:i=n||{},!t||g(t)!=="object")return c(!0,u.INVALID_UPLOAD_OPTIONS,o);var a=h(h({},this.options),i),l=t||{},s=l.xhr;delete t.xhr;var f=s||new XMLHttpRequest;return Te(this,se)(f,t,a,o)}}]),r})();const ve={name:"FileUploadInput",props:["btnCls","disable","maxFileSize","storageType"],emits:["processUploadedFileUrl"],data(){return{componentId:null,file:null,newFileName:null,uploadedFileSize:null,uploadToken:null,waitingUpload:!1}},mounted(){this.componentId=this.$.uid},computed:{fileTooBig(){if(this.uploadedFileSize)return this.maxFileSize&&this.uploadedFileSize>this.maxFileSize}},methods:{async arweaveUpload(){const r=window.location.origin;let e;this.$config.public.fileUploadTokenService==="netlify"?e=r+"/.netlify/functions/arweaveUploader":this.$config.public.fileUploadTokenService==="vercel"&&(e=r+"/api/arweaveUploader");const t=await this.fileToBase64(this.file),n=this.file.type;let a=`ar://${(await H.post(e,{fileData:t,fileName:this.file.name,fileType:this.file.type})).data.transactionId}`;n.startsWith("image/")?a+="?img":n.startsWith("video/")||n.startsWith("audio/")?a+=`?${n}`:n.startsWith("text/plain")&&(a+="?txt"),this.$emit("processUploadedFileUrl",a)},async imageKitUpload(){const r=window.location.origin;let e;this.$config.public.fileUploadTokenService==="netlify"?e=r+"/.netlify/functions/imageKitUploader":this.$config.public.fileUploadTokenService==="vercel"&&(e=r+"/api/imageKitUploader");const t=await $fetch(e).catch(a=>a.data);let n=t;typeof t=="string"&&(n=JSON.parse(t));const o=await new Ne({publicKey:this.$config.public.imagekitPublicKey,urlEndpoint:this.$config.public.imagekitEndpoint}).upload({file:this.file,fileName:this.newFileName,tags:[this.$config.public.projectName,this.$config.public.projectUrl],token:n.data.token,signature:n.data.signature,expire:n.data.expire});this.$emit("processUploadedFileUrl",o.url),this.waitingUpload=!1},handleFileInput(r){const e=r.target.files[0];if(this.uploadedFileSize=e.size,this.maxFileSize&&e.size>this.maxFileSize){const o=this.maxFileSize/1024/1024;console.error("File is too large (max size is "+o+" MB)");return}const n=e.name.split(".").pop();this.newFileName=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+"."+n;const i=new File([e],this.newFileName,{type:e.type});this.file=i},async uploadFile(){if(this.waitingUpload=!0,this.storageType==="arweave")try{await this.arweaveUpload()}catch(r){console.error("Error uploading file to decentralized storage service",r),console.log("Falling back to centralized storage service"),await this.imageKitUpload()}else try{await this.imageKitUpload()}catch(r){console.error("Error uploading file to centralized storage service",r),console.log("Falling back to decentralized storage service"),await this.arweaveUpload()}this.waitingUpload=!1},fileToBase64(r){return new Promise((e,t)=>{const n=new FileReader;n.readAsDataURL(r),n.onload=()=>e(n.result.split(",")[1]),n.onerror=i=>t(i)})}}},_e=["id","disabled"],be=["disabled"],Re={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Ee={key:0,class:"alert alert-danger mt-3",role:"alert"};function we(r,e,t,n,i,o){return _(),v(Z,null,[x("input",{onChange:e[0]||(e[0]=(...a)=>o.handleFileInput&&o.handleFileInput(...a)),type:"file",class:"form-control form-control-lg mb-3",id:"file-input-"+i.componentId,disabled:i.waitingUpload||t.disable},null,40,_e),x("button",{type:"button",class:W(t.btnCls),onClick:e[1]||(e[1]=(...a)=>o.uploadFile&&o.uploadFile(...a)),disabled:i.waitingUpload||!i.file||o.fileTooBig||t.disable},[i.waitingUpload?(_(),v("span",Re)):L("",!0),e[2]||(e[2]=J(" Upload ",-1))],10,be),o.fileTooBig?(_(),v("div",Ee," File is too big (max size is "+Q(t.maxFileSize/1024/1024)+" MB). ",1)):L("",!0)],64)}const Me=Y(ve,[["render",we]]);export{Me as F};
