import{H as $,T as B,M as F}from"./components.9e95291f.js";import{a as y,ae as S,r as g,o as r,b as d,f as s,ah as C,t as c,e as h,l,af as L,ag as D,i as u,c as f,ad as x,u as v,w,as as E,F as M}from"./entry.02f14eb1.js";import{g as T}from"./textUtils.62156d50.js";import{I as U,C as P,u as N,f as A,v as W}from"./ethers.5e9a97a6.js";import{u as j}from"./user.683deb03.js";import{C as V,S as z}from"./SwitchChainButton.a8c9e9fd.js";import{I as H}from"./Image.4a762895.js";import{W as q}from"./WaitingToast.b34cfaf6.js";import{F as O}from"./FileUploadInput.603ba7f3.js";import{u as J}from"./site.1241b7d1.js";import{P as Y,g as Z,a as G}from"./domainUtils.93f7c2eb.js";import{g as K}from"./balanceUtils.5ad0a467.js";import{a as Q,b as I,s as R}from"./storageUtils.37096451.js";import"./composables.f2a4034c.js";const X={name:"ChangePfpModal",props:["componentId","domainName","storageType"],emits:["processFileUrl"],components:{ConnectWalletButton:V,FileUploadInput:O,Image:H,SwitchChainButton:z},data(){return{currentTab:"upload",imageLink:null,waitingSubmit:!1}},mounted(){this.fileUploadEnabled||(this.currentTab="paste")},computed:{domainNameWithoutTld(){return this.domainName.replace(this.$config.tldName,"")},fileUploadEnabled(){return this.siteStore.getFileUploadEnabled},isSupportedChain(){return this.chainId===this.$config.supportedChainId}},methods:{processUploadedFileUrl(e){this.imageLink=e,this.currentTab="paste"},async submitToBlockchain(){this.waitingSubmit=!0;const e=new U(["function getDomainData(string calldata _domainName) public view returns(string memory)","function editData(string calldata _domainName, string calldata _data) external"]),i=new P(this.$config.punkTldAddress,e,this.signer);let o=await i.getDomainData(String(this.domainNameWithoutTld).toLowerCase());try{o=JSON.parse(o)}catch{o={}}o.image=this.imageLink;try{const n=await i.editData(String(this.domainNameWithoutTld).toLowerCase(),JSON.stringify(o)),t=this.toast({component:q,props:{text:"Please wait for your transaction to confirm. Click on this notification to see transaction in the block explorer."}},{type:"info",onClick:()=>window.open(this.$config.blockExplorerBaseUrl+"/tx/"+n.hash,"_blank").focus()}),a=await n.wait();a.status===1?(this.waitingSubmit=!1,this.toast.dismiss(t),this.toast("You have successfully changed your profile image!",{type:"success",onClick:()=>window.open(this.$config.blockExplorerBaseUrl+"/tx/"+n.hash,"_blank").focus()}),this.$emit("processFileUrl",this.imageLink),document.getElementById("closeChangeImageModal"+this.componentId).click()):(this.waitingSubmit=!1,this.toast.dismiss(t),this.toast("Transaction has failed.",{type:"error",onClick:()=>window.open(this.$config.blockExplorerBaseUrl+"/tx/"+n.hash,"_blank").focus()}),console.log(a))}catch(n){console.error(n);try{let t=n.message.split("reason=")[1];t=t.split(", method=")[0],t=t.replace(/"/g,""),t=t.replace("execution reverted:","Error:"),console.log(t),this.toast(t,{type:"error"})}catch{this.toast("Transaction has failed.",{type:"error"})}this.waitingSubmit=!1}this.waitingSubmit=!1}},setup(){const{signer:e,chainId:i,isActivated:o}=N(),n=J(),t=S();return{signer:e,chainId:i,isActivated:o,siteStore:n,toast:t}},watch:{fileUploadEnabled(){this.fileUploadEnabled?this.currentTab="upload":this.currentTab="paste"},imageLink(e,i){i&&(this.currentTab="paste")}}},ee=["id","aria-labelledby"],te={class:"modal-dialog"},se={class:"modal-content"},ie={class:"modal-header"},oe=["id"],ne=["id"],ae={class:"modal-body mb-4"},re={class:"nav nav-tabs nav-fill"},le={class:"nav-item"},de=["disabled"],ce={class:"nav-item"},me={class:"tab-content mt-3"},he={key:0},ue={key:1},pe=s("p",null,"Submit the image link to blockchain",-1),ge={key:0,class:"mb-3"},fe=s("small",null,"If image didn't appear above, then something is wrong with the link you added (wait until the loading indicator completes).",-1),be=["disabled"],_e={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function ke(e,i,o,n,t,a){const p=g("FileUploadInput"),m=g("Image"),b=g("ConnectWalletButton"),k=g("SwitchChainButton");return r(),d("div",{class:"modal fade",id:"changeImageModal"+o.componentId,tabindex:"-1","aria-labelledby":"changeImageModalLabel"+o.componentId,"aria-hidden":"true"},[s("div",te,[s("div",se,[s("div",ie,[s("h1",{class:"modal-title fs-5",id:"changeImageModalLabel"+o.componentId},"Change your profile picture",8,oe),s("button",{id:"closeChangeImageModal"+o.componentId,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,8,ne)]),s("div",ae,[s("ul",re,[s("li",le,[s("button",{disabled:!this.fileUploadEnabled,class:C(["nav-link",t.currentTab==="upload"?"active":""]),onClick:i[0]||(i[0]=_=>t.currentTab="upload")}," Upload ",10,de)]),s("li",ce,[s("button",{class:C(["nav-link",t.currentTab==="paste"?"active":""]),onClick:i[1]||(i[1]=_=>t.currentTab="paste")}," Paste Link ",2)])]),s("div",me,[t.currentTab==="upload"?(r(),d("div",he,[s("p",null,"Upload your new profile image "+c(o.domainName)+".",1),h(p,{btnCls:"btn btn-primary",maxFileSize:e.$config.fileUploadSizeLimit,storageType:o.storageType,onProcessUploadedFileUrl:a.processUploadedFileUrl},null,8,["maxFileSize","storageType","onProcessUploadedFileUrl"])])):l("",!0),t.currentTab==="paste"?(r(),d("div",ue,[pe,L(s("input",{"onUpdate:modelValue":i[2]||(i[2]=_=>t.imageLink=_),type:"text",class:"form-control mb-3",placeholder:"Enter http link to file"},null,512),[[D,t.imageLink]]),t.imageLink?(r(),d("div",ge,[h(m,{url:t.imageLink,cls:"img-thumbnail img-fluid",style:{"max-width":"100px"}},null,8,["url"]),fe])):l("",!0),n.isActivated&&a.isSupportedChain?(r(),d("button",{key:1,class:"btn btn-primary",onClick:i[3]||(i[3]=(..._)=>a.submitToBlockchain&&a.submitToBlockchain(..._)),disabled:!t.imageLink||t.waitingSubmit},[t.waitingSubmit?(r(),d("span",_e)):l("",!0),u(" Submit to blockchain ")],8,be)):l("",!0),n.isActivated?l("",!0):(r(),f(b,{key:2,class:"btn btn-outline-primary mt-2 mb-2",btnText:"Connect Wallet"})),n.isActivated&&!a.isSupportedChain?(r(),f(k,{key:3})):l("",!0)])):l("",!0)])])])])],8,ee)}const we=y(X,[["render",ke]]),ye={name:"PunkProfile",props:["pAddress","pDomain"],data(){return{balanceAp:0,balanceChatTokenWei:0,domain:this.pDomain,newEmail:null,newImageLink:null,uAddress:this.pAddress,uBalance:0,waitingDataLoad:!1,waitingImageUpdate:!1}},components:{ChangePfpModal:we,ProfileImage:Y},mounted(){(!this.pAddress||!this.pDomain)&&this.fetchAddressAndDomain()},computed:{balanceChatToken(){const e=A(this.balanceChatTokenWei);return e>=0?Math.floor(Number(e)):Number(e).toFixed(4)},balanceEth(){const e=A(this.uBalance);return e>0?Number(e).toFixed(2):Number(e).toFixed(4)},isCurrentUser(){return String(this.uAddress).toLowerCase()===String(this.address).toLowerCase()},domainWithoutExtension(){return this.domain?String(this.domain).replace(this.$config.tldName,""):null}},methods:{changeCurrentTab(e){this.currentTab=e,localStorage.setItem("profileCurrentTab",e)},async fetchAddressAndDomain(){if(this.waitingDataLoad=!0,this.$route.query.id){const i=this.$route.query.id;i.includes(".")?this.domain=i:this.uAddress=i}else this.uAddress=this.address;!this.domain&&this.uAddress&&(this.domain=Q(window,this.uAddress));let e=this.$getFallbackProvider(this.$config.supportedChainId);if(this.isActivated&&this.chainId===this.$config.supportedChainId&&(e=this.signer),!this.domain&&this.uAddress){const i=await Z(this.uAddress,e);i&&(this.domain=String(i).replace(this.$config.tldName,"")+this.$config.tldName,I(window,this.uAddress,this.domain))}if(this.domain&&!this.uAddress){const i=await G(String(this.domain).toLowerCase().split(".")[0],e);i!==x&&(this.uAddress=i),this.domain=String(this.domain).replace(this.$config.tldName,"")+this.$config.tldName,I(window,this.uAddress,this.domain)}await this.fetchBalance()},async fetchBalance(){if(this.uAddress){let e=this.$getFallbackProvider(this.$config.supportedChainId);if(this.uBalance=await e.getBalance(this.uAddress),this.$config.chatTokenAddress){const i=new U(["function balanceOf(address owner) view returns (uint256)"]),o=new P(this.$config.chatTokenAddress,i,e);this.balanceChatTokenWei=await o.balanceOf(this.uAddress)}this.$config.activityPointsAddress&&this.$config.showFeatures.activityPoints&&(this.balanceAp=await K(this.uAddress,e))}},async insertImage(e){this.newImageLink=e,e&&R(window,this.domainWithoutExtension,{image:e},"img")}},setup(){const{address:e,balance:i,chainId:o,isActivated:n,signer:t}=N(),a=j(),p=S();return{address:e,balance:i,chainId:o,isActivated:n,userStore:a,shortenAddress:W,signer:t,toast:p}},watch:{address(){this.fetchAddressAndDomain()}}},Ce={class:"card border"},ve={class:"card-body"},Te={class:"fs-3"},Ae={class:"row"},Ie={class:"col-md-3 mt-3"},Se={class:"col-md-9 mt-3"},Ue={key:0,class:"mb-3"},Pe={key:1,class:"mb-3"},Ne={class:"mt-4 muted-text",style:{"font-size":"14px"}},$e={class:"me-4"},Be=s("i",{class:"bi bi-wallet me-1"},null,-1),Fe={key:0,class:"me-4"},Le=s("i",{class:"bi bi-wallet me-1"},null,-1),De={key:1,class:"me-4"},xe=s("i",{class:"bi bi-wallet me-1"},null,-1),Ee={class:"me-4"},Me=s("i",{class:"bi bi-box-arrow-up-right me-2"},null,-1),We=["href"],je={key:2,class:"mt-2"},Ve={class:"dropdown mt-2"},ze=s("button",{class:"btn btn-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[s("i",{class:"bi bi-sliders"}),u(" Profile settings ")],-1),He={class:"dropdown-menu"},qe=["data-bs-target"],Oe=s("i",{class:"bi bi-person-circle"},null,-1),Je=s("span",{class:"dropdown-item cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#changeUsernameModal"},[s("i",{class:"bi bi-pencil-square"}),u(" Change your username ")],-1),Ye=s("i",{class:"bi bi-send"},null,-1);function Ze(e,i,o,n,t,a){const p=g("ProfileImage"),m=E,b=g("ChangePfpModal");return r(),d("div",null,[s("div",Ce,[s("div",ve,[s("p",Te,[s("i",{class:"bi bi-arrow-left-circle cursor-pointer",onClick:i[0]||(i[0]=k=>e.$router.back())})]),s("div",Ae,[s("div",Ie,[(r(),f(p,{key:t.domain,class:"img-fluid img-thumbnail rounded-circle force-circle col-6 col-md-12",domain:t.domain,image:t.newImageLink},null,8,["domain","image"]))]),s("div",Se,[t.domain&&!a.isCurrentUser?(r(),d("h3",Ue,c(v(T)(t.domain)),1)):l("",!0),t.domain&&a.isCurrentUser?(r(),d("h3",Pe,c(v(T)(n.userStore.getDefaultDomain)),1)):l("",!0),s("div",Ne,[s("p",$e,[Be,u(" "+c(a.balanceEth)+" "+c(e.$config.tokenSymbol),1)]),e.$config.chatTokenAddress?(r(),d("p",Fe,[Le,u(" "+c(a.balanceChatToken)+" "+c(e.$config.chatTokenSymbol),1)])):l("",!0),e.$config.activityPointsAddress&&e.$config.showFeatures.activityPoints?(r(),d("p",De,[xe,u(" "+c(t.balanceAp)+" AP ",1)])):l("",!0),s("p",Ee,[Me,s("a",{href:e.$config.blockExplorerBaseUrl+"/address/"+t.uAddress,target:"_blank",class:"body-color hover-color",style:{"text-decoration":"none"}},c(n.shortenAddress(t.uAddress)),9,We)])]),a.isCurrentUser?(r(),d("div",je,[s("div",Ve,[ze,s("div",He,[s("span",{class:"dropdown-item cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#changeImageModal"+e.$.uid},[Oe,u(" Change your profile picture ")],8,qe),Je])])])):l("",!0),t.domain&&!a.isCurrentUser&&e.$config.showFeatures.sendTokens?(r(),f(m,{key:3,class:"btn btn-primary mt-2",to:"/send-tokens/?to="+t.domain},{default:w(()=>[Ye,u(" Send a tip ")]),_:1},8,["to"])):l("",!0)])])]),a.isCurrentUser?(r(),f(b,{key:t.domain,domainName:t.domain,componentId:e.$.uid,storageType:"arweave",onProcessFileUrl:a.insertImage},null,8,["domainName","componentId","onProcessFileUrl"])):l("",!0)])])}const Ge=y(ye,[["render",Ze]]),Ke={name:"Profile",components:{PunkProfile:Ge},setup(){}};function Qe(e,i,o,n,t,a){const p=B,m=F,b=$,k=g("PunkProfile");return r(),d(M,null,[h(b,null,{default:w(()=>[h(p,null,{default:w(()=>[u("Profile | "+c(e.$config.projectMetadataTitle),1)]),_:1}),h(m,{name:"description",content:"Check out this profile on "+e.$config.projectName+"!"},null,8,["content"]),h(m,{property:"og:image",content:e.$config.projectUrl+e.$config.previewImageProfile},null,8,["content"]),h(m,{property:"og:description",content:"Check out this profile on "+e.$config.projectName+"!"},null,8,["content"]),h(m,{name:"twitter:image",content:e.$config.projectUrl+e.$config.previewImageProfile},null,8,["content"]),h(m,{name:"twitter:description",content:"Check out this profile on "+e.$config.projectName+"!"},null,8,["content"])]),_:1}),(r(),f(k,{key:e.$route.query.id,class:"mt-1"}))],64)}const ht=y(Ke,[["render",Qe]]);export{ht as default};
