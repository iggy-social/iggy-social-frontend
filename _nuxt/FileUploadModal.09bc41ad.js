import{u as L}from"./site.9e2cc5b4.js";import{a as M,ab as k,o as c,b as f,f as s,l as g,i as x,Q as S,t as v,F as K,r as C,e as B,O as z,P as G}from"./entry.5fb68691.js";function y(a){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?y=function(t){return typeof t}:y=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(a)}function j(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function A(a,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(a,i.key,i)}}function V(a,t,e){return t&&A(a.prototype,t),e&&A(a,e),a}function R(a,t,e){return t in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e,a}function w(a,t){var e=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable})),e.push.apply(e,i)}return e}function h(a){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?w(Object(e),!0).forEach(function(i){R(a,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)):w(Object(e)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(e,i))})}return a}var q="2.0.0",d={MANDATORY_INITIALIZATION_MISSING:{message:"Missing urlEndpoint during SDK initialization",help:""},INVALID_TRANSFORMATION_POSITION:{message:"Invalid transformationPosition parameter",help:""},PRIVATE_KEY_CLIENT_SIDE:{message:"privateKey should not be passed on the client side",help:""},MISSING_UPLOAD_DATA:{message:"Missing data for upload",help:""},MISSING_UPLOAD_FILE_PARAMETER:{message:"Missing file parameter for upload",help:""},MISSING_UPLOAD_FILENAME_PARAMETER:{message:"Missing fileName parameter for upload",help:""},MISSING_AUTHENTICATION_ENDPOINT:{message:"Missing authentication endpoint for upload",help:""},MISSING_PUBLIC_KEY:{message:"Missing public key for upload",help:""},AUTH_ENDPOINT_TIMEOUT:{message:"The authenticationEndpoint you provided timed out in 60 seconds",help:""},AUTH_ENDPOINT_NETWORK_ERROR:{message:"Request to authenticationEndpoint failed due to network error",help:""},AUTH_INVALID_RESPONSE:{message:"Invalid response from authenticationEndpoint. The SDK expects a JSON response with three fields i.e. signature, token and expire.",help:""},UPLOAD_ENDPOINT_NETWORK_ERROR:{message:"Request to ImageKit upload endpoint failed due to network error",help:""},INVALID_UPLOAD_OPTIONS:{message:"Invalid uploadOptions parameter",help:""},MISSING_SIGNATURE:{message:"Missing signature for upload. The SDK expects token, sginature and expire for authentication.",help:""},MISSING_TOKEN:{message:"Missing token for upload. The SDK expects token, sginature and expire for authentication.",help:""},MISSING_EXPIRE:{message:"Missing expire for upload. The SDK expects token, sginature and expire for authentication.",help:""}};function u(a,t,e){typeof e=="function"&&(a?e(t,null):e(null,t))}function W(a){var t={},e=a.getAllResponseHeaders();return Object.keys(e).length&&e.trim().split(/[\r\n]+/).map(function(i){return i.split(/: /)}).forEach(function(i){t[i[0].trim()]=i[1].trim()}),t}var E=function(t,e){var i=h({},t),r={statusCode:e.status,headers:W(e)};return Object.defineProperty(i,"$ResponseMetadata",{value:r,enumerable:!1,writable:!1}),i},Y=function(t,e,i){J(t,e).then(function(r){return u(!1,r,i)},function(r){return u(!0,r,i)})},J=function(t,e){return new Promise(function(i,r){t.open("POST","https://upload.imagekit.io/api/v1/files/upload"),t.onerror=function(n){return r(d.UPLOAD_ENDPOINT_NETWORK_ERROR)},t.onload=function(){if(t.status===200)try{var n=JSON.parse(t.responseText),o=E(n,t);return i(o)}catch(m){return r(m)}else try{var n=JSON.parse(t.responseText),l=E(n,t);return r(l)}catch(m){return r(m)}},t.send(e)})},Q=function(t,e,i,r){if(!e.file){u(!0,d.MISSING_UPLOAD_FILE_PARAMETER,r);return}if(!e.fileName){u(!0,d.MISSING_UPLOAD_FILENAME_PARAMETER,r);return}if(!i.publicKey){u(!0,d.MISSING_PUBLIC_KEY,r);return}if(!e.token){u(!0,d.MISSING_TOKEN,r);return}if(!e.signature){u(!0,d.MISSING_SIGNATURE,r);return}if(!e.expire){u(!0,d.MISSING_EXPIRE,r);return}var n=new FormData,o;for(o in e)o&&(o==="file"&&typeof e.file!="string"?n.append("file",e.file,String(e.fileName)):o==="tags"&&Array.isArray(e.tags)?n.append("tags",e.tags.join(",")):o==="signature"?n.append("signature",e.signature):o==="expire"?n.append("expire",String(e.expire)):o==="token"?n.append("token",e.token):o==="responseFields"&&Array.isArray(e.responseFields)?n.append("responseFields",e.responseFields.join(",")):o==="extensions"&&Array.isArray(e.extensions)?n.append("extensions",JSON.stringify(e.extensions)):o==="customMetadata"&&y(e.customMetadata)==="object"&&!Array.isArray(e.customMetadata)&&e.customMetadata!==null?n.append("customMetadata",JSON.stringify(e.customMetadata)):e[o]!==void 0&&n.append(o,String(e[o])));n.append("publicKey",i.publicKey),Y(t,n,r)},P={width:"w",height:"h",aspectRatio:"ar",quality:"q",crop:"c",cropMode:"cm",focus:"fo",x:"x",y:"y",format:"f",radius:"r",background:"bg",border:"b",rotation:"rt",rotate:"rt",blur:"bl",named:"n",overlayImage:"oi",overlayImageAspectRatio:"oiar",overlayImageBackground:"oibg",overlayImageBorder:"oib",overlayImageDPR:"oidpr",overlayImageQuality:"oiq",overlayImageCropping:"oic",overlayImageTrim:"oit",overlayX:"ox",overlayY:"oy",overlayFocus:"ofo",overlayHeight:"oh",overlayWidth:"ow",overlayText:"ot",overlayTextFontSize:"ots",overlayTextFontFamily:"otf",overlayTextColor:"otc",overlayTextTransparency:"oa",overlayAlpha:"oa",overlayTextTypography:"ott",overlayBackground:"obg",overlayTextEncoded:"ote",overlayTextWidth:"otw",overlayTextBackground:"otbg",overlayTextPadding:"otp",overlayTextInnerAlignment:"otia",overlayRadius:"or",progressive:"pr",lossless:"lo",trim:"t",metadata:"md",colorProfile:"cp",defaultImage:"di",dpr:"dpr",effectSharpen:"e-sharpen",effectUSM:"e-usm",effectContrast:"e-contrast",effectGray:"e-grayscale",original:"orig",raw:"raw"},O="path",D="query",H=[O,D],Z=":",$=",",X="-",p={getDefault:function(){return O},addAsQueryParameter:function(t){return t.transformationPosition===D},validParameters:function(t){return typeof t.transformationPosition>"u"?!1:H.indexOf(t.transformationPosition)!=-1},getTransformKey:function(t){return t&&(P[t]||P[t.toLowerCase()])||""},getChainTransformDelimiter:function(){return Z},getTransformDelimiter:function(){return $},getTransformKeyValueDelimiter:function(){return X}},F="tr";function ee(a){return typeof a=="string"&&a[a.length-1]=="/"&&(a=a.substring(0,a.length-1)),a}function te(a){return typeof a=="string"&&a[0]=="/"&&(a=a.slice(1)),a}function b(a,t){var e=t||"/",i=new RegExp(e+"{1,}","g");return a.join(e).replace(i,e)}var ae=function(t){if(!t.path&&!t.src)return"";var e,i,r;try{t.path?(r=new URL(t.urlEndpoint).pathname,e=new URL(b([t.urlEndpoint.replace(r,""),t.path]))):(e=new URL(t.src),i=!0)}catch(l){return console.error(l),""}for(var n in t.queryParameters)e.searchParams.append(n,String(t.queryParameters[n]));var o=ie(t.transformation);return o&&o.length&&(p.addAsQueryParameter(t)||i?e.searchParams.append(F,o):e.pathname=b([F+p.getChainTransformDelimiter()+o,e.pathname])),r?e.pathname=b([r,e.pathname]):e.pathname=b([e.pathname]),e.href};function ie(a){if(!Array.isArray(a))return"";for(var t=[],e=0,i=a.length;e<i;e++){var r=[];for(var n in a[e]){var o=p.getTransformKey(n);if(o||(o=n),a[e][n]==="-")r.push(o);else if(n==="raw")r.push(a[e][n]);else{var l=a[e][n];(o==="oi"||o==="di")&&(l=ee(te(l||"")),l=l.replace(/\//g,"@@")),r.push([o,l].join(p.getTransformKeyValueDelimiter()))}}t.push(r.join(p.getTransformDelimiter()))}return t.join(p.getChainTransformDelimiter())}var re=function(t,e){return ae(h(h({},e),t))};function ne(a){return a.urlEndpoint}var oe=function(t,e){return function(){for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];if(r.length===e.length&&typeof r[r.length-1]<"u"){if(typeof r[r.length-1]!="function")throw new Error("Callback must be a function.");e.call.apply(e,[t].concat(r))}else return new Promise(function(o,l){var m=function(U){if(U)return l(U);for(var _=arguments.length,T=new Array(_>1?_-1:0),I=1;I<_;I++)T[I-1]=arguments[I];o(T.length>1?T:T[0])};r.pop(),r.push(m),e.call.apply(e,[t].concat(r))})}},se=function(){function a(t){if(j(this,a),R(this,"options",{sdkVersion:"javascript-".concat(q),publicKey:"",urlEndpoint:"",transformationPosition:p.getDefault()}),this.options=h(h({},this.options),t||{}),!ne(this.options))throw d.MANDATORY_INITIALIZATION_MISSING;if(!p.validParameters(this.options))throw d.INVALID_TRANSFORMATION_POSITION}return V(a,[{key:"url",value:function(e){return re(e,this.options)}},{key:"upload",value:function(e,i,r){var n;if(typeof i=="function"?n=i:r=i||{},!e||y(e)!=="object")return u(!0,d.INVALID_UPLOAD_OPTIONS,n);var o=h(h({},this.options),r),l=e||{},m=l.xhr;delete e.xhr;var N=m||new XMLHttpRequest;return oe(this,Q)(N,e,o,n)}}]),a}();const le={name:"FileUploadInput",props:["btnCls","disable","maxFileSize","storageType"],emits:["processUploadedFileUrl"],data(){return{componentId:null,file:null,newFileName:null,uploadedFileSize:null,uploadToken:null,waitingUpload:!1}},mounted(){this.componentId=this.$.uid},computed:{fileTooBig(){if(this.uploadedFileSize)return this.maxFileSize&&this.uploadedFileSize>this.maxFileSize}},methods:{async arweaveUpload(){const a=window.location.origin;let t;this.$config.fileUploadTokenService==="netlify"?t=a+"/.netlify/functions/arweaveUploader":this.$config.fileUploadTokenService==="vercel"&&(t=a+"/api/arweaveUploader");const e=await this.fileToBase64(this.file),i=this.file.type;let o=`ar://${(await k.post(t,{fileData:e,fileName:this.file.name,fileType:this.file.type})).data.transactionId}`;i.startsWith("image/")?o+="?img":i.startsWith("video/")||i.startsWith("audio/")?o+=`?${i}`:i.startsWith("text/plain")&&(o+="?txt"),this.$emit("processUploadedFileUrl",o)},async imageKitUpload(){const a=window.location.origin;let t;this.$config.fileUploadTokenService==="netlify"?t=a+"/.netlify/functions/imageKitUploader":this.$config.fileUploadTokenService==="vercel"&&(t=a+"/api/imageKitUploader");const e=await $fetch(t).catch(o=>o.data);let i=e;typeof e=="string"&&(i=JSON.parse(e));const n=await new se({publicKey:this.$config.imagekitPublicKey,urlEndpoint:this.$config.imagekitEndpoint}).upload({file:this.file,fileName:this.newFileName,tags:[this.$config.projectName,this.$config.projectUrl],token:i.data.token,signature:i.data.signature,expire:i.data.expire});this.$emit("processUploadedFileUrl",n.url),this.waitingUpload=!1},handleFileInput(a){const t=a.target.files[0];if(this.uploadedFileSize=t.size,this.maxFileSize&&t.size>this.maxFileSize){const n=this.maxFileSize/1024/1024;console.error("File is too large (max size is "+n+" MB)");return}const i=t.name.split(".").pop();this.newFileName=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+"."+i;const r=new File([t],this.newFileName,{type:t.type});this.file=r},async uploadFile(){if(this.waitingUpload=!0,this.storageType==="arweave")try{await this.arweaveUpload()}catch(a){console.error("Error uploading file to decentralized storage service",a),console.log("Falling back to centralized storage service"),await this.imageKitUpload()}else try{await this.imageKitUpload()}catch(a){console.error("Error uploading file to centralized storage service",a),console.log("Falling back to decentralized storage service"),await this.arweaveUpload()}this.waitingUpload=!1},fileToBase64(a){return new Promise((t,e)=>{const i=new FileReader;i.readAsDataURL(a),i.onload=()=>t(i.result.split(",")[1]),i.onerror=r=>e(r)})}}},de=["id","disabled"],ue=["disabled"],ce={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},fe={key:0,class:"alert alert-danger mt-3",role:"alert"};function pe(a,t,e,i,r,n){return c(),f(K,null,[s("input",{onChange:t[0]||(t[0]=(...o)=>n.handleFileInput&&n.handleFileInput(...o)),type:"file",class:"form-control form-control-lg mb-3",id:"file-input-"+r.componentId,disabled:r.waitingUpload||e.disable},null,40,de),s("button",{type:"button",class:S(e.btnCls),onClick:t[1]||(t[1]=(...o)=>n.uploadFile&&n.uploadFile(...o)),disabled:r.waitingUpload||!r.file||n.fileTooBig||e.disable},[r.waitingUpload?(c(),f("span",ce)):g("",!0),x(" Upload ")],10,ue),n.fileTooBig?(c(),f("div",fe," File is too big (max size is "+v(e.maxFileSize/1024/1024)+" MB). ",1)):g("",!0)],64)}const me=M(le,[["render",pe]]),he={name:"FileUploadModal",props:["title","componentId","infoText","maxFileSize","storageType"],emits:["processFileUrl"],components:{FileUploadInput:me},data(){return{currentTab:"upload",pastedLink:null}},mounted(){this.fileUploadEnabled||(this.currentTab="paste")},computed:{arweaveBalance(){const a=this.siteStore.arweaveBalance;if(a){const t=Number(a).toFixed(6);return Number.parseFloat(t)}return 0},arweaveBalanceTooLow(){return this.storageType!=="arweave"?!1:this.arweaveBalance<this.$config.arweaveMinBalance},fileUploadEnabled(){return this.siteStore.getFileUploadEnabled},getTitle(){return this.title||"Upload file"}},methods:{processUploadedFileUrl(a){this.$emit("processFileUrl",a),document.getElementById("closeFileUploadModal"+this.componentId).click()}},setup(){return{siteStore:L()}},watch:{fileUploadEnabled(){this.fileUploadEnabled?this.currentTab="upload":this.currentTab="paste"}}},ge=["id","aria-labelledby"],ve={class:"modal-dialog"},ye={class:"modal-content"},Te={class:"modal-header"},Ie=["id"],be=["id"],_e={class:"modal-body mb-4"},Se={class:"nav nav-tabs nav-fill"},Ne={class:"nav-item"},Ue=["disabled"],Ae={class:"nav-item"},we={class:"tab-content mt-3"},Ee={key:0},Pe={key:0},Fe={key:1},Me=s("p",{class:"text-danger"}," Error: Arweave is used as file storage. Current balance in the Arweave wallet is insufficient to do the upload. ",-1),xe={class:"text-danger"},Re=["href"],Oe={key:1},De=s("p",null,"Paste file link",-1),Le=["disabled"];function ke(a,t,e,i,r,n){const o=C("FileUploadInput");return c(),f("div",{class:"modal fade",id:"fileUploadModal"+e.componentId,tabindex:"-1","aria-labelledby":"fileUploadModalLabel"+e.componentId,"aria-hidden":"true"},[s("div",ve,[s("div",ye,[s("div",Te,[s("h1",{class:"modal-title fs-5",id:"fileUploadModalLabel"+e.componentId},v(n.getTitle),9,Ie),s("button",{id:"closeFileUploadModal"+e.componentId,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,8,be)]),s("div",_e,[s("ul",Se,[s("li",Ne,[s("button",{disabled:!this.fileUploadEnabled,class:S(["nav-link",r.currentTab==="upload"?"active":""]),onClick:t[0]||(t[0]=l=>r.currentTab="upload")}," Upload ",10,Ue)]),s("li",Ae,[s("button",{class:S(["nav-link",r.currentTab==="paste"?"active":""]),onClick:t[1]||(t[1]=l=>r.currentTab="paste")}," Paste Link ",2)])]),s("div",we,[r.currentTab==="upload"?(c(),f("div",Ee,[e.infoText?(c(),f("p",Pe,v(e.infoText),1)):g("",!0),n.arweaveBalanceTooLow?(c(),f("div",Fe,[Me,s("p",null,[s("span",xe,"Please send AR tokens to this wallet (min. "+v(a.$config.arweaveMinBalance)+" AR) to enable uploads: ",1),s("a",{href:"https://arscan.io/address/"+this.$config.arweaveAddress,target:"_blank"},v(this.$config.arweaveAddress),9,Re),x(". ")])])):g("",!0),B(o,{btnCls:"btn btn-primary",disable:n.arweaveBalanceTooLow,maxFileSize:e.maxFileSize,storageType:e.storageType,onProcessUploadedFileUrl:n.processUploadedFileUrl},null,8,["disable","maxFileSize","storageType","onProcessUploadedFileUrl"])])):g("",!0),r.currentTab==="paste"?(c(),f("div",Oe,[De,z(s("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>r.pastedLink=l),type:"text",class:"form-control mb-3",placeholder:"Enter http link to file"},null,512),[[G,r.pastedLink]]),s("button",{class:"btn btn-primary",onClick:t[3]||(t[3]=l=>n.processUploadedFileUrl(r.pastedLink)),disabled:!r.pastedLink}," Submit link ",8,Le)])):g("",!0)])])])])],8,ge)}const Be=M(he,[["render",ke]]);export{Be as F,me as a};
