import{u as D}from"./site.47fd0142.js";import{a as x,N as L,o as p,b as m,f as l,l as g,i as k,O as _,t as b,F as K,r as C,e as z,L as B,M as G}from"./entry.39daa801.js";function y(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?y=function(t){return typeof t}:y=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(i)}function j(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function A(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function V(i,t,e){return t&&A(i.prototype,t),e&&A(i,e),i}function w(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function E(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,n)}return e}function h(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?E(Object(e),!0).forEach(function(n){w(i,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):E(Object(e)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(e,n))})}return i}var q="2.0.0",d={MANDATORY_INITIALIZATION_MISSING:{message:"Missing urlEndpoint during SDK initialization",help:""},INVALID_TRANSFORMATION_POSITION:{message:"Invalid transformationPosition parameter",help:""},PRIVATE_KEY_CLIENT_SIDE:{message:"privateKey should not be passed on the client side",help:""},MISSING_UPLOAD_DATA:{message:"Missing data for upload",help:""},MISSING_UPLOAD_FILE_PARAMETER:{message:"Missing file parameter for upload",help:""},MISSING_UPLOAD_FILENAME_PARAMETER:{message:"Missing fileName parameter for upload",help:""},MISSING_AUTHENTICATION_ENDPOINT:{message:"Missing authentication endpoint for upload",help:""},MISSING_PUBLIC_KEY:{message:"Missing public key for upload",help:""},AUTH_ENDPOINT_TIMEOUT:{message:"The authenticationEndpoint you provided timed out in 60 seconds",help:""},AUTH_ENDPOINT_NETWORK_ERROR:{message:"Request to authenticationEndpoint failed due to network error",help:""},AUTH_INVALID_RESPONSE:{message:"Invalid response from authenticationEndpoint. The SDK expects a JSON response with three fields i.e. signature, token and expire.",help:""},UPLOAD_ENDPOINT_NETWORK_ERROR:{message:"Request to ImageKit upload endpoint failed due to network error",help:""},INVALID_UPLOAD_OPTIONS:{message:"Invalid uploadOptions parameter",help:""},MISSING_SIGNATURE:{message:"Missing signature for upload. The SDK expects token, sginature and expire for authentication.",help:""},MISSING_TOKEN:{message:"Missing token for upload. The SDK expects token, sginature and expire for authentication.",help:""},MISSING_EXPIRE:{message:"Missing expire for upload. The SDK expects token, sginature and expire for authentication.",help:""}};function u(i,t,e){typeof e=="function"&&(i?e(t,null):e(null,t))}function W(i){var t={},e=i.getAllResponseHeaders();return Object.keys(e).length&&e.trim().split(/[\r\n]+/).map(function(n){return n.split(/: /)}).forEach(function(n){t[n[0].trim()]=n[1].trim()}),t}var P=function(t,e){var n=h({},t),r={statusCode:e.status,headers:W(e)};return Object.defineProperty(n,"$ResponseMetadata",{value:r,enumerable:!1,writable:!1}),n},Y=function(t,e,n){J(t,e).then(function(r){return u(!1,r,n)},function(r){return u(!0,r,n)})},J=function(t,e){return new Promise(function(n,r){t.open("POST","https://upload.imagekit.io/api/v1/files/upload"),t.onerror=function(a){return r(d.UPLOAD_ENDPOINT_NETWORK_ERROR)},t.onload=function(){if(t.status===200)try{var a=JSON.parse(t.responseText),o=P(a,t);return n(o)}catch(c){return r(c)}else try{var a=JSON.parse(t.responseText),s=P(a,t);return r(s)}catch(c){return r(c)}},t.send(e)})},H=function(t,e,n,r){if(!e.file){u(!0,d.MISSING_UPLOAD_FILE_PARAMETER,r);return}if(!e.fileName){u(!0,d.MISSING_UPLOAD_FILENAME_PARAMETER,r);return}if(!n.publicKey){u(!0,d.MISSING_PUBLIC_KEY,r);return}if(!e.token){u(!0,d.MISSING_TOKEN,r);return}if(!e.signature){u(!0,d.MISSING_SIGNATURE,r);return}if(!e.expire){u(!0,d.MISSING_EXPIRE,r);return}var a=new FormData,o;for(o in e)o&&(o==="file"&&typeof e.file!="string"?a.append("file",e.file,String(e.fileName)):o==="tags"&&Array.isArray(e.tags)?a.append("tags",e.tags.join(",")):o==="signature"?a.append("signature",e.signature):o==="expire"?a.append("expire",String(e.expire)):o==="token"?a.append("token",e.token):o==="responseFields"&&Array.isArray(e.responseFields)?a.append("responseFields",e.responseFields.join(",")):o==="extensions"&&Array.isArray(e.extensions)?a.append("extensions",JSON.stringify(e.extensions)):o==="customMetadata"&&y(e.customMetadata)==="object"&&!Array.isArray(e.customMetadata)&&e.customMetadata!==null?a.append("customMetadata",JSON.stringify(e.customMetadata)):e[o]!==void 0&&a.append(o,String(e[o])));a.append("publicKey",n.publicKey),Y(t,a,r)},F={width:"w",height:"h",aspectRatio:"ar",quality:"q",crop:"c",cropMode:"cm",focus:"fo",x:"x",y:"y",format:"f",radius:"r",background:"bg",border:"b",rotation:"rt",rotate:"rt",blur:"bl",named:"n",overlayImage:"oi",overlayImageAspectRatio:"oiar",overlayImageBackground:"oibg",overlayImageBorder:"oib",overlayImageDPR:"oidpr",overlayImageQuality:"oiq",overlayImageCropping:"oic",overlayImageTrim:"oit",overlayX:"ox",overlayY:"oy",overlayFocus:"ofo",overlayHeight:"oh",overlayWidth:"ow",overlayText:"ot",overlayTextFontSize:"ots",overlayTextFontFamily:"otf",overlayTextColor:"otc",overlayTextTransparency:"oa",overlayAlpha:"oa",overlayTextTypography:"ott",overlayBackground:"obg",overlayTextEncoded:"ote",overlayTextWidth:"otw",overlayTextBackground:"otbg",overlayTextPadding:"otp",overlayTextInnerAlignment:"otia",overlayRadius:"or",progressive:"pr",lossless:"lo",trim:"t",metadata:"md",colorProfile:"cp",defaultImage:"di",dpr:"dpr",effectSharpen:"e-sharpen",effectUSM:"e-usm",effectContrast:"e-contrast",effectGray:"e-grayscale",original:"orig",raw:"raw"},R="path",O="query",Q=[R,O],Z=":",$=",",X="-",f={getDefault:function(){return R},addAsQueryParameter:function(t){return t.transformationPosition===O},validParameters:function(t){return typeof t.transformationPosition>"u"?!1:Q.indexOf(t.transformationPosition)!=-1},getTransformKey:function(t){return t&&(F[t]||F[t.toLowerCase()])||""},getChainTransformDelimiter:function(){return Z},getTransformDelimiter:function(){return $},getTransformKeyValueDelimiter:function(){return X}},M="tr";function ee(i){return typeof i=="string"&&i[i.length-1]=="/"&&(i=i.substring(0,i.length-1)),i}function te(i){return typeof i=="string"&&i[0]=="/"&&(i=i.slice(1)),i}function T(i,t){var e=t||"/",n=new RegExp(e+"{1,}","g");return i.join(e).replace(n,e)}var ie=function(t){if(!t.path&&!t.src)return"";var e,n,r;try{t.path?(r=new URL(t.urlEndpoint).pathname,e=new URL(T([t.urlEndpoint.replace(r,""),t.path]))):(e=new URL(t.src),n=!0)}catch(s){return console.error(s),""}for(var a in t.queryParameters)e.searchParams.append(a,String(t.queryParameters[a]));var o=re(t.transformation);return o&&o.length&&(f.addAsQueryParameter(t)||n?e.searchParams.append(M,o):e.pathname=T([M+f.getChainTransformDelimiter()+o,e.pathname])),r?e.pathname=T([r,e.pathname]):e.pathname=T([e.pathname]),e.href};function re(i){if(!Array.isArray(i))return"";for(var t=[],e=0,n=i.length;e<n;e++){var r=[];for(var a in i[e]){var o=f.getTransformKey(a);if(o||(o=a),i[e][a]==="-")r.push(o);else if(a==="raw")r.push(i[e][a]);else{var s=i[e][a];(o==="oi"||o==="di")&&(s=ee(te(s||"")),s=s.replace(/\//g,"@@")),r.push([o,s].join(f.getTransformKeyValueDelimiter()))}}t.push(r.join(f.getTransformDelimiter()))}return t.join(f.getChainTransformDelimiter())}var ne=function(t,e){return ie(h(h({},e),t))};function ae(i){return i.urlEndpoint}var oe=function(t,e){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];if(r.length===e.length&&typeof r[r.length-1]<"u"){if(typeof r[r.length-1]!="function")throw new Error("Callback must be a function.");e.call.apply(e,[t].concat(r))}else return new Promise(function(o,s){var c=function(U){if(U)return s(U);for(var S=arguments.length,I=new Array(S>1?S-1:0),v=1;v<S;v++)I[v-1]=arguments[v];o(I.length>1?I:I[0])};r.pop(),r.push(c),e.call.apply(e,[t].concat(r))})}},se=function(){function i(t){if(j(this,i),w(this,"options",{sdkVersion:"javascript-".concat(q),publicKey:"",urlEndpoint:"",transformationPosition:f.getDefault()}),this.options=h(h({},this.options),t||{}),!ae(this.options))throw d.MANDATORY_INITIALIZATION_MISSING;if(!f.validParameters(this.options))throw d.INVALID_TRANSFORMATION_POSITION}return V(i,[{key:"url",value:function(e){return ne(e,this.options)}},{key:"upload",value:function(e,n,r){var a;if(typeof n=="function"?a=n:r=n||{},!e||y(e)!=="object")return u(!0,d.INVALID_UPLOAD_OPTIONS,a);var o=h(h({},this.options),r),s=e||{},c=s.xhr;delete e.xhr;var N=c||new XMLHttpRequest;return oe(this,H)(N,e,o,a)}}]),i}();const le={name:"FileUploadInput",props:["btnCls","maxFileSize","storageType"],emits:["processUploadedFileUrl"],data(){return{componentId:null,file:null,newFileName:null,uploadedFileSize:null,uploadToken:null,waitingUpload:!1}},mounted(){this.componentId=this.$.uid},computed:{fileTooBig(){if(this.uploadedFileSize)return this.maxFileSize&&this.uploadedFileSize>this.maxFileSize}},methods:{async imageKitUpload(){const i=window.location.origin;let t;this.$config.fileUploadTokenService==="netlify"?t=i+"/.netlify/functions/imageUploaderFallback":this.$config.fileUploadTokenService==="vercel"&&(t=i+"/api/imageUploaderFallback");const e=await $fetch(t).catch(o=>o.data);let n=e;typeof e=="string"&&(n=JSON.parse(e));const a=await new se({publicKey:this.$config.imagekitPublicKey,urlEndpoint:this.$config.imagekitEndpoint}).upload({file:this.file,fileName:this.newFileName,tags:[this.$config.projectName,this.$config.projectUrl],token:n.data.token,signature:n.data.signature,expire:n.data.expire});this.$emit("processUploadedFileUrl",a.url),this.waitingUpload=!1},handleFileInput(i){const t=i.target.files[0];if(this.uploadedFileSize=t.size,this.maxFileSize&&t.size>this.maxFileSize){const a=this.maxFileSize/1024/1024;console.error("File is too large (max size is "+a+" MB)");return}const n=t.name.split(".").pop();this.newFileName=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+"."+n;const r=new File([t],this.newFileName,{type:t.type});this.file=r},async uploadFile(){if(this.waitingUpload=!0,this.storageType==="arweave")try{const i=window.location.origin;let t;this.$config.fileUploadTokenService==="netlify"?t=i+"/.netlify/functions/arweaveUploader":this.$config.fileUploadTokenService==="vercel"&&(t=i+"/api/arweaveUploader"),console.log(t);const e=await this.fileToBase64(this.file),n=this.file.type,r=await L.post(t,{fileData:e,fileName:this.file.name,fileType:this.file.type});console.log(r);let o=`ar://${r.data.transactionId}`;n.startsWith("image/")?o+="?img":n.startsWith("video/")||n.startsWith("audio/")?o+=`?${n}`:n.startsWith("text/plain")&&(o+="?txt"),this.$emit("processUploadedFileUrl",o)}catch(i){console.error("Error uploading file to decentralized storage service",i),console.log("Falling back to centralized storage service"),await this.imageKitUpload()}else await this.imageKitUpload();this.waitingUpload=!1},fileToBase64(i){return new Promise((t,e)=>{const n=new FileReader;n.readAsDataURL(i),n.onload=()=>t(n.result.split(",")[1]),n.onerror=r=>e(r)})}}},de=["id"],ue=["disabled"],fe={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},ce={key:0,class:"alert alert-danger mt-3",role:"alert"};function pe(i,t,e,n,r,a){return p(),m(K,null,[l("input",{onChange:t[0]||(t[0]=(...o)=>a.handleFileInput&&a.handleFileInput(...o)),type:"file",class:"form-control form-control-lg mb-3",id:"file-input-"+r.componentId},null,40,de),l("button",{type:"button",class:_(e.btnCls),onClick:t[1]||(t[1]=(...o)=>a.uploadFile&&a.uploadFile(...o)),disabled:r.waitingUpload||!r.file||a.fileTooBig},[r.waitingUpload?(p(),m("span",fe)):g("",!0),k(" Upload ")],10,ue),a.fileTooBig?(p(),m("div",ce," File is too big (max size is "+b(e.maxFileSize/1024/1024)+" MB). ",1)):g("",!0)],64)}const me=x(le,[["render",pe]]),he={name:"FileUploadModal",props:["title","componentId","infoText","maxFileSize","storageType"],emits:["processFileUrl"],components:{FileUploadInput:me},data(){return{currentTab:"upload",pastedLink:null}},mounted(){this.fileUploadEnabled||(this.currentTab="paste")},computed:{fileUploadEnabled(){return this.siteStore.getFileUploadEnabled},getTitle(){return this.title||"Upload file"}},methods:{processUploadedFileUrl(i){this.$emit("processFileUrl",i),document.getElementById("closeFileUploadModal"+this.componentId).click()}},setup(){return{siteStore:D()}},watch:{fileUploadEnabled(){this.fileUploadEnabled?this.currentTab="upload":this.currentTab="paste"}}},ge=["id","aria-labelledby"],ye={class:"modal-dialog"},Ie={class:"modal-content"},ve={class:"modal-header"},Te=["id"],Se=["id"],_e={class:"modal-body mb-4"},be={class:"nav nav-tabs nav-fill"},Ne={class:"nav-item"},Ue=["disabled"],Ae={class:"nav-item"},Ee={class:"tab-content mt-3"},Pe={key:0},Fe={key:0},Me={key:1},xe=l("p",null,"Paste file link",-1),we=["disabled"];function Re(i,t,e,n,r,a){const o=C("FileUploadInput");return p(),m("div",{class:"modal fade",id:"fileUploadModal"+e.componentId,tabindex:"-1","aria-labelledby":"fileUploadModalLabel"+e.componentId,"aria-hidden":"true"},[l("div",ye,[l("div",Ie,[l("div",ve,[l("h1",{class:"modal-title fs-5",id:"fileUploadModalLabel"+e.componentId},b(a.getTitle),9,Te),l("button",{id:"closeFileUploadModal"+e.componentId,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,8,Se)]),l("div",_e,[l("ul",be,[l("li",Ne,[l("button",{disabled:!this.fileUploadEnabled,class:_(["nav-link",r.currentTab==="upload"?"active":""]),onClick:t[0]||(t[0]=s=>r.currentTab="upload")}," Upload ",10,Ue)]),l("li",Ae,[l("button",{class:_(["nav-link",r.currentTab==="paste"?"active":""]),onClick:t[1]||(t[1]=s=>r.currentTab="paste")}," Paste Link ",2)])]),l("div",Ee,[r.currentTab==="upload"?(p(),m("div",Pe,[e.infoText?(p(),m("p",Fe,b(e.infoText),1)):g("",!0),z(o,{btnCls:"btn btn-primary",maxFileSize:e.maxFileSize,storageType:e.storageType,onProcessUploadedFileUrl:a.processUploadedFileUrl},null,8,["maxFileSize","storageType","onProcessUploadedFileUrl"])])):g("",!0),r.currentTab==="paste"?(p(),m("div",Me,[xe,B(l("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>r.pastedLink=s),type:"text",class:"form-control mb-3",placeholder:"Enter http link to file"},null,512),[[G,r.pastedLink]]),l("button",{class:"btn btn-primary",onClick:t[3]||(t[3]=s=>a.processUploadedFileUrl(r.pastedLink)),disabled:!r.pastedLink}," Submit link ",8,we)])):g("",!0)])])])])],8,ge)}const Le=x(he,[["render",Re]]);export{Le as F,me as a};
