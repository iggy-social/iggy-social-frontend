import{u as D}from"./site.b9e3a73f.js";import{u as L}from"./ipfsUtils.5193581b.js";import{a as x,o as p,b as m,f as s,l as g,i as k,Z as S,t as _,F as C,r as K,e as z,L as G,M as j}from"./entry.b3e49a4d.js";function y(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?y=function(t){return typeof t}:y=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(r)}function B(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function U(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function V(r,t,e){return t&&U(r.prototype,t),e&&U(r,e),r}function R(r,t,e){return t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}function E(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,n)}return e}function h(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?E(Object(e),!0).forEach(function(n){R(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):E(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}var q="2.0.0",d={MANDATORY_INITIALIZATION_MISSING:{message:"Missing urlEndpoint during SDK initialization",help:""},INVALID_TRANSFORMATION_POSITION:{message:"Invalid transformationPosition parameter",help:""},PRIVATE_KEY_CLIENT_SIDE:{message:"privateKey should not be passed on the client side",help:""},MISSING_UPLOAD_DATA:{message:"Missing data for upload",help:""},MISSING_UPLOAD_FILE_PARAMETER:{message:"Missing file parameter for upload",help:""},MISSING_UPLOAD_FILENAME_PARAMETER:{message:"Missing fileName parameter for upload",help:""},MISSING_AUTHENTICATION_ENDPOINT:{message:"Missing authentication endpoint for upload",help:""},MISSING_PUBLIC_KEY:{message:"Missing public key for upload",help:""},AUTH_ENDPOINT_TIMEOUT:{message:"The authenticationEndpoint you provided timed out in 60 seconds",help:""},AUTH_ENDPOINT_NETWORK_ERROR:{message:"Request to authenticationEndpoint failed due to network error",help:""},AUTH_INVALID_RESPONSE:{message:"Invalid response from authenticationEndpoint. The SDK expects a JSON response with three fields i.e. signature, token and expire.",help:""},UPLOAD_ENDPOINT_NETWORK_ERROR:{message:"Request to ImageKit upload endpoint failed due to network error",help:""},INVALID_UPLOAD_OPTIONS:{message:"Invalid uploadOptions parameter",help:""},MISSING_SIGNATURE:{message:"Missing signature for upload. The SDK expects token, sginature and expire for authentication.",help:""},MISSING_TOKEN:{message:"Missing token for upload. The SDK expects token, sginature and expire for authentication.",help:""},MISSING_EXPIRE:{message:"Missing expire for upload. The SDK expects token, sginature and expire for authentication.",help:""}};function u(r,t,e){typeof e=="function"&&(r?e(t,null):e(null,t))}function Y(r){var t={},e=r.getAllResponseHeaders();return Object.keys(e).length&&e.trim().split(/[\r\n]+/).map(function(n){return n.split(/: /)}).forEach(function(n){t[n[0].trim()]=n[1].trim()}),t}var F=function(t,e){var n=h({},t),i={statusCode:e.status,headers:Y(e)};return Object.defineProperty(n,"$ResponseMetadata",{value:i,enumerable:!1,writable:!1}),n},J=function(t,e,n){W(t,e).then(function(i){return u(!1,i,n)},function(i){return u(!0,i,n)})},W=function(t,e){return new Promise(function(n,i){t.open("POST","https://upload.imagekit.io/api/v1/files/upload"),t.onerror=function(a){return i(d.UPLOAD_ENDPOINT_NETWORK_ERROR)},t.onload=function(){if(t.status===200)try{var a=JSON.parse(t.responseText),o=F(a,t);return n(o)}catch(c){return i(c)}else try{var a=JSON.parse(t.responseText),l=F(a,t);return i(l)}catch(c){return i(c)}},t.send(e)})},H=function(t,e,n,i){if(!e.file){u(!0,d.MISSING_UPLOAD_FILE_PARAMETER,i);return}if(!e.fileName){u(!0,d.MISSING_UPLOAD_FILENAME_PARAMETER,i);return}if(!n.publicKey){u(!0,d.MISSING_PUBLIC_KEY,i);return}if(!e.token){u(!0,d.MISSING_TOKEN,i);return}if(!e.signature){u(!0,d.MISSING_SIGNATURE,i);return}if(!e.expire){u(!0,d.MISSING_EXPIRE,i);return}var a=new FormData,o;for(o in e)o&&(o==="file"&&typeof e.file!="string"?a.append("file",e.file,String(e.fileName)):o==="tags"&&Array.isArray(e.tags)?a.append("tags",e.tags.join(",")):o==="signature"?a.append("signature",e.signature):o==="expire"?a.append("expire",String(e.expire)):o==="token"?a.append("token",e.token):o==="responseFields"&&Array.isArray(e.responseFields)?a.append("responseFields",e.responseFields.join(",")):o==="extensions"&&Array.isArray(e.extensions)?a.append("extensions",JSON.stringify(e.extensions)):o==="customMetadata"&&y(e.customMetadata)==="object"&&!Array.isArray(e.customMetadata)&&e.customMetadata!==null?a.append("customMetadata",JSON.stringify(e.customMetadata)):e[o]!==void 0&&a.append(o,String(e[o])));a.append("publicKey",n.publicKey),J(t,a,i)},P={width:"w",height:"h",aspectRatio:"ar",quality:"q",crop:"c",cropMode:"cm",focus:"fo",x:"x",y:"y",format:"f",radius:"r",background:"bg",border:"b",rotation:"rt",rotate:"rt",blur:"bl",named:"n",overlayImage:"oi",overlayImageAspectRatio:"oiar",overlayImageBackground:"oibg",overlayImageBorder:"oib",overlayImageDPR:"oidpr",overlayImageQuality:"oiq",overlayImageCropping:"oic",overlayImageTrim:"oit",overlayX:"ox",overlayY:"oy",overlayFocus:"ofo",overlayHeight:"oh",overlayWidth:"ow",overlayText:"ot",overlayTextFontSize:"ots",overlayTextFontFamily:"otf",overlayTextColor:"otc",overlayTextTransparency:"oa",overlayAlpha:"oa",overlayTextTypography:"ott",overlayBackground:"obg",overlayTextEncoded:"ote",overlayTextWidth:"otw",overlayTextBackground:"otbg",overlayTextPadding:"otp",overlayTextInnerAlignment:"otia",overlayRadius:"or",progressive:"pr",lossless:"lo",trim:"t",metadata:"md",colorProfile:"cp",defaultImage:"di",dpr:"dpr",effectSharpen:"e-sharpen",effectUSM:"e-usm",effectContrast:"e-contrast",effectGray:"e-grayscale",original:"orig",raw:"raw"},w="path",O="query",Q=[w,O],Z=":",$=",",X="-",f={getDefault:function(){return w},addAsQueryParameter:function(t){return t.transformationPosition===O},validParameters:function(t){return typeof t.transformationPosition>"u"?!1:Q.indexOf(t.transformationPosition)!=-1},getTransformKey:function(t){return t&&(P[t]||P[t.toLowerCase()])||""},getChainTransformDelimiter:function(){return Z},getTransformDelimiter:function(){return $},getTransformKeyValueDelimiter:function(){return X}},M="tr";function ee(r){return typeof r=="string"&&r[r.length-1]=="/"&&(r=r.substring(0,r.length-1)),r}function te(r){return typeof r=="string"&&r[0]=="/"&&(r=r.slice(1)),r}function v(r,t){var e=t||"/",n=new RegExp(e+"{1,}","g");return r.join(e).replace(n,e)}var re=function(t){if(!t.path&&!t.src)return"";var e,n,i;try{t.path?(i=new URL(t.urlEndpoint).pathname,e=new URL(v([t.urlEndpoint.replace(i,""),t.path]))):(e=new URL(t.src),n=!0)}catch(l){return console.error(l),""}for(var a in t.queryParameters)e.searchParams.append(a,String(t.queryParameters[a]));var o=ie(t.transformation);return o&&o.length&&(f.addAsQueryParameter(t)||n?e.searchParams.append(M,o):e.pathname=v([M+f.getChainTransformDelimiter()+o,e.pathname])),i?e.pathname=v([i,e.pathname]):e.pathname=v([e.pathname]),e.href};function ie(r){if(!Array.isArray(r))return"";for(var t=[],e=0,n=r.length;e<n;e++){var i=[];for(var a in r[e]){var o=f.getTransformKey(a);if(o||(o=a),r[e][a]==="-")i.push(o);else if(a==="raw")i.push(r[e][a]);else{var l=r[e][a];(o==="oi"||o==="di")&&(l=ee(te(l||"")),l=l.replace(/\//g,"@@")),i.push([o,l].join(f.getTransformKeyValueDelimiter()))}}t.push(i.join(f.getTransformDelimiter()))}return t.join(f.getChainTransformDelimiter())}var ne=function(t,e){return re(h(h({},e),t))};function ae(r){return r.urlEndpoint}var oe=function(t,e){return function(){for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];if(i.length===e.length&&typeof i[i.length-1]<"u"){if(typeof i[i.length-1]!="function")throw new Error("Callback must be a function.");e.call.apply(e,[t].concat(i))}else return new Promise(function(o,l){var c=function(A){if(A)return l(A);for(var b=arguments.length,I=new Array(b>1?b-1:0),T=1;T<b;T++)I[T-1]=arguments[T];o(I.length>1?I:I[0])};i.pop(),i.push(c),e.call.apply(e,[t].concat(i))})}},le=function(){function r(t){if(B(this,r),R(this,"options",{sdkVersion:"javascript-".concat(q),publicKey:"",urlEndpoint:"",transformationPosition:f.getDefault()}),this.options=h(h({},this.options),t||{}),!ae(this.options))throw d.MANDATORY_INITIALIZATION_MISSING;if(!f.validParameters(this.options))throw d.INVALID_TRANSFORMATION_POSITION}return V(r,[{key:"url",value:function(e){return ne(e,this.options)}},{key:"upload",value:function(e,n,i){var a;if(typeof n=="function"?a=n:i=n||{},!e||y(e)!=="object")return u(!0,d.INVALID_UPLOAD_OPTIONS,a);var o=h(h({},this.options),i),l=e||{},c=l.xhr;delete e.xhr;var N=c||new XMLHttpRequest;return oe(this,H)(N,e,o,a)}}]),r}();const se={name:"FileUploadInput",props:["btnCls","maxFileSize","storageType"],emits:["processUploadedFileUrl"],data(){return{componentId:null,file:null,newFileName:null,uploadedFileSize:null,uploadToken:null,waitingUpload:!1}},mounted(){this.componentId=this.$.uid},computed:{fileTooBig(){if(this.uploadedFileSize)return this.maxFileSize&&this.uploadedFileSize>this.maxFileSize}},methods:{async fallbackUpload(){const r=window.location.origin;let t;this.$config.fileUploadTokenService==="netlify"?t=r+"/.netlify/functions/imageUploaderFallback":this.$config.fileUploadTokenService==="vercel"&&(t=r+"/api/imageUploaderFallback");const e=await $fetch(t).catch(o=>o.data);let n=e;typeof e=="string"&&(n=JSON.parse(e));const a=await new le({publicKey:this.$config.imagekitPublicKey,urlEndpoint:this.$config.imagekitEndpoint}).upload({file:this.file,fileName:this.newFileName,tags:[this.$config.projectName,this.$config.projectUrl],token:n.data.token,signature:n.data.signature,expire:n.data.expire});this.$emit("processUploadedFileUrl",a.url),this.waitingUpload=!1},handleFileInput(r){const t=r.target.files[0];if(this.uploadedFileSize=t.size,this.maxFileSize&&t.size>this.maxFileSize){const a=this.maxFileSize/1024/1024;console.error("File is too large (max size is "+a+" MB)");return}const n=t.name.split(".").pop();this.newFileName=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+"."+n;const i=new File([t],this.newFileName,{type:t.type});this.file=i},async uploadFile(){if(this.waitingUpload=!0,this.storageType==="ipfs")try{const r=await L(this.file);this.$emit("processUploadedFileUrl",r)}catch(r){console.error("Error uploading file to IPFS",r),console.log("Falling back to centralized storage service"),await this.fallbackUpload()}else await this.fallbackUpload();this.waitingUpload=!1}}},de=["id"],ue=["disabled"],fe={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},ce={key:0,class:"alert alert-danger mt-3",role:"alert"};function pe(r,t,e,n,i,a){return p(),m(C,null,[s("input",{onChange:t[0]||(t[0]=(...o)=>a.handleFileInput&&a.handleFileInput(...o)),type:"file",class:"form-control form-control-lg mb-3",id:"file-input-"+i.componentId},null,40,de),s("button",{type:"button",class:S(e.btnCls),onClick:t[1]||(t[1]=(...o)=>a.uploadFile&&a.uploadFile(...o)),disabled:i.waitingUpload||!i.file||a.fileTooBig},[i.waitingUpload?(p(),m("span",fe)):g("",!0),k(" Upload ")],10,ue),a.fileTooBig?(p(),m("div",ce," File is too big (max size is "+_(e.maxFileSize/1024/1024)+" MB). ",1)):g("",!0)],64)}const me=x(se,[["render",pe]]),he={name:"FileUploadModal",props:["title","componentId","infoText","maxFileSize","storageType"],emits:["processFileUrl"],components:{FileUploadInput:me},data(){return{currentTab:"upload",pastedLink:null}},mounted(){this.fileUploadEnabled||(this.currentTab="paste")},computed:{fileUploadEnabled(){return this.siteStore.getFileUploadEnabled},getTitle(){return this.title||"Upload file"}},methods:{processUploadedFileUrl(r){this.$emit("processFileUrl",r),document.getElementById("closeFileUploadModal"+this.componentId).click()}},setup(){return{siteStore:D()}},watch:{fileUploadEnabled(){this.fileUploadEnabled?this.currentTab="upload":this.currentTab="paste"}}},ge=["id","aria-labelledby"],ye={class:"modal-dialog"},Ie={class:"modal-content"},Te={class:"modal-header"},ve=["id"],be=["id"],Se={class:"modal-body mb-4"},_e={class:"nav nav-tabs nav-fill"},Ne={class:"nav-item"},Ae=["disabled"],Ue={class:"nav-item"},Ee={class:"tab-content mt-3"},Fe={key:0},Pe={key:0},Me={key:1},xe=s("p",null,"Paste file link",-1),Re=["disabled"];function we(r,t,e,n,i,a){const o=K("FileUploadInput");return p(),m("div",{class:"modal fade",id:"fileUploadModal"+e.componentId,tabindex:"-1","aria-labelledby":"fileUploadModalLabel"+e.componentId,"aria-hidden":"true"},[s("div",ye,[s("div",Ie,[s("div",Te,[s("h1",{class:"modal-title fs-5",id:"fileUploadModalLabel"+e.componentId},_(a.getTitle),9,ve),s("button",{id:"closeFileUploadModal"+e.componentId,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,8,be)]),s("div",Se,[s("ul",_e,[s("li",Ne,[s("button",{disabled:!this.fileUploadEnabled,class:S(["nav-link",i.currentTab==="upload"?"active":""]),onClick:t[0]||(t[0]=l=>i.currentTab="upload")}," Upload ",10,Ae)]),s("li",Ue,[s("button",{class:S(["nav-link",i.currentTab==="paste"?"active":""]),onClick:t[1]||(t[1]=l=>i.currentTab="paste")}," Paste Link ",2)])]),s("div",Ee,[i.currentTab==="upload"?(p(),m("div",Fe,[e.infoText?(p(),m("p",Pe,_(e.infoText),1)):g("",!0),z(o,{btnCls:"btn btn-primary",maxFileSize:e.maxFileSize,storageType:e.storageType,onProcessUploadedFileUrl:a.processUploadedFileUrl},null,8,["maxFileSize","storageType","onProcessUploadedFileUrl"])])):g("",!0),i.currentTab==="paste"?(p(),m("div",Me,[xe,G(s("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>i.pastedLink=l),type:"text",class:"form-control mb-3",placeholder:"Enter http link to file"},null,512),[[j,i.pastedLink]]),s("button",{class:"btn btn-primary",onClick:t[3]||(t[3]=l=>a.processUploadedFileUrl(i.pastedLink)),disabled:!i.pastedLink}," Submit link ",8,Re)])):g("",!0)])])])])],8,ge)}const ke=x(he,[["render",we]]);export{ke as F,me as a};
