import{_ as q,ae as J,c as F,o as L,a as C,g as Y,d as H,G as W,F as Q}from"#entry";function A(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?A=function(e){return typeof e}:A=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(r)}function Z(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function X(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function ee(r,e,t){return e&&X(r.prototype,e),r}function V(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function k(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function y(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?k(Object(t),!0).forEach(function(n){V(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):k(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function te(r,e){if(r){if(typeof r=="string")return j(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return j(r,e)}}function j(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function re(r,e){var t;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(t=te(r))||e){t&&(r=t);var n=0,i=function(){};return{s:i,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(s){throw s},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){t=r[Symbol.iterator]()},n:function(){var s=t.next();return o=s.done,s},e:function(s){a=!0,u=s},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw u}}}}var c={MANDATORY_INITIALIZATION_MISSING:{message:"Missing urlEndpoint during SDK initialization",help:""},INVALID_TRANSFORMATION_POSITION:{message:"Invalid transformationPosition parameter",help:""},PRIVATE_KEY_CLIENT_SIDE:{message:"privateKey should not be passed on the client side",help:""},MISSING_UPLOAD_DATA:{message:"Missing data for upload",help:""},MISSING_UPLOAD_FILE_PARAMETER:{message:"Missing file parameter for upload",help:""},MISSING_UPLOAD_FILENAME_PARAMETER:{message:"Missing fileName parameter for upload",help:""},MISSING_AUTHENTICATION_ENDPOINT:{message:"Missing authentication endpoint for upload",help:""},MISSING_PUBLIC_KEY:{message:"Missing public key for upload",help:""},AUTH_ENDPOINT_TIMEOUT:{message:"The authenticationEndpoint you provided timed out in 60 seconds",help:""},AUTH_ENDPOINT_NETWORK_ERROR:{message:"Request to authenticationEndpoint failed due to network error",help:""},AUTH_INVALID_RESPONSE:{message:"Invalid response from authenticationEndpoint. The SDK expects a JSON response with three fields i.e. signature, token and expire.",help:""},UPLOAD_ENDPOINT_NETWORK_ERROR:{message:"Request to ImageKit upload endpoint failed due to network error",help:""},INVALID_UPLOAD_OPTIONS:{message:"Invalid uploadOptions parameter",help:""},MISSING_SIGNATURE:{message:"Missing signature for upload. The SDK expects token, signature and expire for authentication.",help:""},MISSING_TOKEN:{message:"Missing token for upload. The SDK expects token, signature and expire for authentication.",help:""},MISSING_EXPIRE:{message:"Missing expire for upload. The SDK expects token, signature and expire for authentication.",help:""},INVALID_TRANSFORMATION:{message:"Invalid transformation parameter. Please include at least pre, post, or both.",help:""},INVALID_PRE_TRANSFORMATION:{message:"Invalid pre transformation parameter.",help:""},INVALID_POST_TRANSFORMATION:{message:"Invalid post transformation parameter.",help:""}};function p(r,e,t){typeof t=="function"&&(r?t(e,null):t(null,e))}function ne(r){var e={},t=r.getAllResponseHeaders();return Object.keys(t).length&&t.trim().split(/[\r\n]+/).map(function(n){return n.split(/: /)}).forEach(function(n){e[n[0].trim()]=n[1].trim()}),e}var K=function(e,t){var n=y({},e),i={statusCode:t.status,headers:ne(t)};return Object.defineProperty(n,"$ResponseMetadata",{value:i,enumerable:!1,writable:!1}),n},ie=function(e,t,n){ae(e,t).then(function(i){return p(!1,i,n)},function(i){return p(!0,i,n)})},ae=function(e,t){return new Promise(function(n,i){e.open("POST","https://upload.imagekit.io/api/v1/files/upload"),e.onerror=function(o){return i(c.UPLOAD_ENDPOINT_NETWORK_ERROR)},e.onload=function(){if(e.status===200)try{var o=JSON.parse(e.responseText),a=K(o,e);return n(a)}catch(s){return i(s)}else try{var o=JSON.parse(e.responseText),u=K(o,e);return i(u)}catch(s){return i(s)}},e.send(t)})},oe=function(e,t,n,i){if(!t.file){p(!0,c.MISSING_UPLOAD_FILE_PARAMETER,i);return}if(!t.fileName){p(!0,c.MISSING_UPLOAD_FILENAME_PARAMETER,i);return}if(!n.publicKey){p(!0,c.MISSING_PUBLIC_KEY,i);return}if(!t.token){p(!0,c.MISSING_TOKEN,i);return}if(!t.signature){p(!0,c.MISSING_SIGNATURE,i);return}if(!t.expire){p(!0,c.MISSING_EXPIRE,i);return}if(t.transformation){if(!(Object.keys(t.transformation).includes("pre")||Object.keys(t.transformation).includes("post"))){p(!0,c.INVALID_TRANSFORMATION,i);return}if(Object.keys(t.transformation).includes("pre")&&!t.transformation.pre){p(!0,c.INVALID_PRE_TRANSFORMATION,i);return}if(Object.keys(t.transformation).includes("post"))if(Array.isArray(t.transformation.post)){var o=re(t.transformation.post),a;try{for(o.s();!(a=o.n()).done;){var u=a.value;if(u.type==="abs"&&!(u.protocol||u.value)){p(!0,c.INVALID_POST_TRANSFORMATION,i);return}else if(u.type==="transformation"&&!u.value){p(!0,c.INVALID_POST_TRANSFORMATION,i);return}}}catch(d){o.e(d)}finally{o.f()}}else{p(!0,c.INVALID_POST_TRANSFORMATION,i);return}}var s=new FormData,l;for(l in t)l&&(l==="file"&&typeof t.file!="string"?s.append("file",t.file,String(t.fileName)):l==="tags"&&Array.isArray(t.tags)?s.append("tags",t.tags.join(",")):l==="signature"?s.append("signature",t.signature):l==="expire"?s.append("expire",String(t.expire)):l==="token"?s.append("token",t.token):l==="responseFields"&&Array.isArray(t.responseFields)?s.append("responseFields",t.responseFields.join(",")):l==="extensions"&&Array.isArray(t.extensions)?s.append("extensions",JSON.stringify(t.extensions)):l==="customMetadata"&&A(t.customMetadata)==="object"&&!Array.isArray(t.customMetadata)&&t.customMetadata!==null?s.append("customMetadata",JSON.stringify(t.customMetadata)):l==="transformation"&&A(t.transformation)==="object"&&t.transformation!==null?s.append(l,JSON.stringify(t.transformation)):l==="checks"&&t.checks?s.append("checks",t.checks):t[l]!==void 0&&s.append(l,String(t[l])));s.append("publicKey",n.publicKey),ie(e,s,i)},z={width:"w",height:"h",aspectRatio:"ar",background:"bg",border:"b",crop:"c",cropMode:"cm",dpr:"dpr",focus:"fo",quality:"q",x:"x",xCenter:"xc",y:"y",yCenter:"yc",format:"f",videoCodec:"vc",audioCodec:"ac",radius:"r",rotation:"rt",blur:"bl",named:"n",defaultImage:"di",flip:"fl",original:"orig",startOffset:"so",endOffset:"eo",duration:"du",streamingResolutions:"sr",grayscale:"e-grayscale",aiUpscale:"e-upscale",aiRetouch:"e-retouch",aiVariation:"e-genvar",aiDropShadow:"e-dropshadow",aiChangeBackground:"e-changebg",aiRemoveBackground:"e-bgremove",aiRemoveBackgroundExternal:"e-removedotbg",contrastStretch:"e-contrast",shadow:"e-shadow",sharpen:"e-sharpen",unsharpMask:"e-usm",gradient:"e-gradient",progressive:"pr",lossless:"lo",colorProfile:"cp",metadata:"md",opacity:"o",trim:"t",zoom:"z",page:"pg",fontSize:"fs",fontFamily:"ff",fontColor:"co",innerAlignment:"ia",padding:"pa",alpha:"al",typography:"tg",lineHeight:"lh",fontOutline:"fol",fontShadow:"fsh",raw:"raw"},b="query",se="path",le=b,ue=[se,b],fe=":",ce=",",pe="-",m={getDefault:function(){return le},addAsQueryParameter:function(e){return e.transformationPosition===b},validParameters:function(e){return typeof e.transformationPosition>"u"?!1:ue.indexOf(e.transformationPosition)!=-1},getTransformKey:function(e){return e&&(z[e]||z[e.toLowerCase()])||""},getChainTransformDelimiter:function(){return fe},getTransformDelimiter:function(){return ce},getTransformKeyValueDelimiter:function(){return pe}},v=function(e){return typeof window<"u"?btoa(e):Buffer.from(e,"utf8").toString("base64")},E="tr",de=new RegExp("^[a-zA-Z0-9-._/ ]*$"),ge=new RegExp("^[a-zA-Z0-9-._ ]*$");function G(r){return typeof r=="string"&&r[r.length-1]=="/"&&(r=r.substring(0,r.length-1)),r}function B(r){return typeof r=="string"&&r[0]=="/"&&(r=r.slice(1)),r}function N(r,e){var t="/",n=new RegExp(t+"{1,}","g");return r.join(t).replace(n,t)}var me=function(e){if(!e.path&&!e.src)return"";var t,n,i;try{e.path?(i=new URL(e.urlEndpoint).pathname,t=new URL(N([e.urlEndpoint.replace(i,""),e.path]))):(t=new URL(e.src),n=!0)}catch(u){return console.error(u),""}for(var o in e.queryParameters)t.searchParams.append(o,String(e.queryParameters[o]));var a=$(e.transformation);return a&&a.length&&!m.addAsQueryParameter(e)&&!n&&(t.pathname=N([E+m.getChainTransformDelimiter()+a,t.pathname])),i?t.pathname=N([i,t.pathname]):t.pathname=N([t.pathname]),a&&a.length&&(m.addAsQueryParameter(e)||n)?t.searchParams.toString()!==""?"".concat(t.href,"&").concat(E,"=").concat(a):"".concat(t.href,"?").concat(E,"=").concat(a):t.href};function R(r,e){return r=G(B(r)),e==="plain"?"i-".concat(r.replace(/\//g,"@@")):e==="base64"?"ie-".concat(encodeURIComponent(v(r))):de.test(r)?"i-".concat(r.replace(/\//g,"@@")):"ie-".concat(encodeURIComponent(v(r)))}function he(r,e){return e==="plain"?"i-".concat(encodeURIComponent(r)):e==="base64"?"ie-".concat(encodeURIComponent(v(r))):ge.test(r)?"i-".concat(encodeURIComponent(r)):"ie-".concat(encodeURIComponent(v(r)))}function Ie(r){var e=[];if(r){var t=r.type,n=r.position,i=n===void 0?{}:n,o=r.timing,a=o===void 0?{}:o,u=r.transformation,s=u===void 0?[]:u;if(!t)throw new Error("Overlay type is required");switch(t){case"text":{var l=r;if(!l.text)return;var d=l.encoding||"auto";e.push("l-text"),e.push(he(l.text,d))}break;case"image":e.push("l-image");{var g=r,h=g.encoding||"auto";if(g.input)e.push(R(g.input,h));else return}break;case"video":e.push("l-video");{var f=r,T=f.encoding||"auto";if(f.input)e.push(R(f.input,T));else return}break;case"subtitle":e.push("l-subtitle");{var S=r,I=S.encoding||"auto";if(S.input)e.push(R(S.input,I));else return}break;case"solidColor":e.push("l-image"),e.push("i-ik_canvas");{var w=r;if(w.color)e.push("bg-".concat(w.color));else return}break}var P=i.x,M=i.y,O=i.focus;P&&e.push("lx-".concat(P)),M&&e.push("ly-".concat(M)),O&&e.push("lfo-".concat(O));var U=a.start,D=a.end,x=a.duration;U&&e.push("lso-".concat(U)),D&&e.push("leo-".concat(D)),x&&e.push("ldu-".concat(x));var _=$(s);return _&&_.trim()!==""&&e.push(_),e.push("l-end"),e.join(m.getTransformDelimiter())}}function $(r){if(!Array.isArray(r))return"";for(var e=[],t=0,n=r.length;t<n;t++){var i=[];for(var o in r[t]){var a=r[t][o];if(a!=null){if(o==="overlay"&&A(a)==="object"){var u=Ie(a);u&&u.trim()!==""&&i.push(u);continue}var s=m.getTransformKey(o);if(s||(s=o),s!=="")if(["e-grayscale","e-contrast","e-removedotbg","e-bgremove","e-upscale","e-retouch","e-genvar"].includes(s))if(a===!0||a==="-"||a==="true")i.push(s);else continue;else["e-sharpen","e-shadow","e-gradient","e-usm","e-dropshadow"].includes(s)&&(a.toString().trim()===""||a===!0||a==="true")?i.push(s):o==="raw"?i.push(r[t][o]):(s==="di"&&(a=G(B(a||"")),a=a.replace(/\//g,"@@")),s==="sr"&&Array.isArray(a)&&(a=a.join("_")),s==="t"&&a.toString().trim()===""&&(a="true"),i.push([s,a].join(m.getTransformKeyValueDelimiter())))}}i.length&&e.push(i.join(m.getTransformDelimiter()))}return e.join(m.getChainTransformDelimiter())}var ye=function(e,t){return me(y(y({},t),e))};function Ae(r){return r.urlEndpoint}var Se=function(e,t){return function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];if(i.length===t.length&&typeof i[i.length-1]<"u"){if(typeof i[i.length-1]!="function")throw new Error("Callback must be a function.");t.call.apply(t,[e].concat(i))}else return new Promise(function(a,u){var s=function(d){if(d)return u(d);for(var g=arguments.length,h=new Array(g>1?g-1:0),f=1;f<g;f++)h[f-1]=arguments[f];a(h.length>1?h:h[0])};i.pop(),i.push(s),t.call.apply(t,[e].concat(i))})}},Te=(function(){function r(e){if(Z(this,r),V(this,"options",{publicKey:"",urlEndpoint:"",transformationPosition:m.getDefault()}),this.options=y(y({},this.options),e||{}),!Ae(this.options))throw c.MANDATORY_INITIALIZATION_MISSING;if(!m.validParameters(this.options))throw c.INVALID_TRANSFORMATION_POSITION}return ee(r,[{key:"url",value:function(t){return ye(t,this.options)}},{key:"upload",value:function(t,n,i){var o;if(typeof n=="function"?o=n:i=n||{},!t||A(t)!=="object")return p(!0,c.INVALID_UPLOAD_OPTIONS,o);var a=y(y({},this.options),i),u=t||{},s=u.xhr;delete t.xhr;var l=s||new XMLHttpRequest;return Se(this,oe)(l,t,a,o)}}]),r})();async function Ne(r,e=1920,t=1920,n=1024*1024){return new Promise((i,o)=>{if(!["image/jpeg","image/png","image/webp"].includes(r.type))return o(new Error("Unsupported file type. Only JPG, PNG, WebP allowed."));const u=new Image,s=new FileReader;s.onload=l=>{if(!l.target?.result)return o(new Error("File load failed"));u.src=l.target.result},u.onload=()=>{let{width:l,height:d}=u;if(l>e||d>t){const I=Math.min(e/l,t/d);l=Math.round(l*I),d=Math.round(d*I)}const g=document.createElement("canvas");g.width=l,g.height=d;const h=g.getContext("2d");if(!h)return o(new Error("Canvas not supported"));h.drawImage(u,0,0,l,d);let f=r.type;f==="image/png"&&(f="image/jpeg");let T=.9;const S=()=>{g.toBlob(I=>{if(!I)return o(new Error("Canvas export failed"));if(I.size>n&&(f==="image/jpeg"||f==="image/webp")&&T>.3)return T-=.1,S();i(new File([I],ve(r.name,f),{type:f}))},f,T)};S()},u.onerror=()=>o(new Error("Image load failed")),s.readAsDataURL(r)})}function ve(r,e){const t=e==="image/jpeg"?"jpg":e.split("/")[1];return r.replace(/\.[^/.]+$/,"")+"."+t}const _e={name:"FileUploadInput",props:["btnCls","disable","maxFileSize","storageType"],emits:["processUploadedFileUrl"],data(){return{componentId:null,file:null,uploadedFileSize:null,uploadToken:null,waitingUpload:!1}},mounted(){this.componentId=this.$.uid},computed:{fileTooBig(){if(this.uploadedFileSize)return this.maxFileSize&&this.uploadedFileSize>this.maxFileSize}},methods:{async arweaveUpload(){const r=window.location.origin;let e;this.$config.public.fileUploadTokenService==="netlify"?e=r+"/.netlify/functions/arweaveUploader":this.$config.public.fileUploadTokenService==="vercel"&&(e=r+"/api/arweaveUploader");const t=await this.fileToBase64(this.file),n=this.file.type;let a=`ar://${(await J.post(e,{fileData:t,fileName:this.file.name,fileType:this.file.type})).data.transactionId}`;n.startsWith("image/")?a+="?img":n.startsWith("video/")||n.startsWith("audio/")?a+=`?${n}`:n.startsWith("text/plain")&&(a+="?txt"),this.$emit("processUploadedFileUrl",a)},handleFileInput(r){const e=r.target.files[0];if(this.uploadedFileSize=e.size,this.fileTooBig&&!this.isSupportedImage(e)){const a=this.maxFileSize/1024/1024;console.error("File is too large (max size is "+a+" MB)");return}const n=e.name.split(".").pop(),i=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+"."+n,o=new File([e],i,{type:e.type});this.file=o},async imageKitUpload(){const r=window.location.origin;let e;this.$config.public.fileUploadTokenService==="netlify"?e=r+"/.netlify/functions/imageKitUploader":this.$config.public.fileUploadTokenService==="vercel"&&(e=r+"/api/imageKitUploader");const t=await $fetch(e).catch(a=>a.data);let n=t;typeof t=="string"&&(n=JSON.parse(t));const o=await new Te({publicKey:this.$config.public.imagekitPublicKey,urlEndpoint:this.$config.public.imagekitEndpoint}).upload({file:this.file,fileName:this.file.name,tags:[this.$config.public.projectName,this.$config.public.projectUrl],token:n.data.token,signature:n.data.signature,expire:n.data.expire});this.$emit("processUploadedFileUrl",o.url),this.waitingUpload=!1},isSupportedImage(r){return["image/jpeg","image/png","image/webp"].includes(r.type)},async uploadFile(){if(this.waitingUpload=!0,this.isSupportedImage(this.file)&&this.fileTooBig&&(this.file=await Ne(this.file)),this.storageType==="arweave")try{await this.arweaveUpload()}catch(r){console.error("Error uploading file to decentralized storage service",r),console.log("Falling back to centralized storage service"),await this.imageKitUpload()}else try{await this.imageKitUpload()}catch(r){console.error("Error uploading file to centralized storage service",r),console.log("Falling back to decentralized storage service"),await this.arweaveUpload()}this.waitingUpload=!1},fileToBase64(r){return new Promise((e,t)=>{const n=new FileReader;n.readAsDataURL(r),n.onload=()=>e(n.result.split(",")[1]),n.onerror=i=>t(i)})}}},Ee=["id","disabled"],Re=["disabled"],be={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function we(r,e,t,n,i,o){return L(),F(Q,null,[C("input",{onChange:e[0]||(e[0]=(...a)=>o.handleFileInput&&o.handleFileInput(...a)),type:"file",class:"form-control form-control-lg mb-3",id:"file-input-"+i.componentId,disabled:i.waitingUpload||t.disable},null,40,Ee),C("button",{type:"button",class:W(t.btnCls),onClick:e[1]||(e[1]=(...a)=>o.uploadFile&&o.uploadFile(...a)),disabled:i.waitingUpload||!i.file||t.disable},[i.waitingUpload?(L(),F("span",be)):Y("",!0),e[2]||(e[2]=H(" Upload ",-1))],10,Re)],64)}const Me=q(_e,[["render",we]]);export{Me as F};
