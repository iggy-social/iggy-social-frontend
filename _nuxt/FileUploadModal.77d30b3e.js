import{u as L}from"./site.033e9873.js";import{a as x,ab as k,o as c,b as f,f as s,l as g,i as S,Q as N,t as v,F as K,r as C,e as B,O as z,P as G}from"./entry.5abbf7eb.js";function y(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?y=function(t){return typeof t}:y=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(i)}function j(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function w(i,t){for(var e=0;e<t.length;e++){var a=t[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,a.key,a)}}function V(i,t,e){return t&&w(i.prototype,t),e&&w(i,e),i}function R(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function E(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(i);t&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,a)}return e}function h(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?E(Object(e),!0).forEach(function(a){R(i,a,e[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):E(Object(e)).forEach(function(a){Object.defineProperty(i,a,Object.getOwnPropertyDescriptor(e,a))})}return i}var q="2.0.0",d={MANDATORY_INITIALIZATION_MISSING:{message:"Missing urlEndpoint during SDK initialization",help:""},INVALID_TRANSFORMATION_POSITION:{message:"Invalid transformationPosition parameter",help:""},PRIVATE_KEY_CLIENT_SIDE:{message:"privateKey should not be passed on the client side",help:""},MISSING_UPLOAD_DATA:{message:"Missing data for upload",help:""},MISSING_UPLOAD_FILE_PARAMETER:{message:"Missing file parameter for upload",help:""},MISSING_UPLOAD_FILENAME_PARAMETER:{message:"Missing fileName parameter for upload",help:""},MISSING_AUTHENTICATION_ENDPOINT:{message:"Missing authentication endpoint for upload",help:""},MISSING_PUBLIC_KEY:{message:"Missing public key for upload",help:""},AUTH_ENDPOINT_TIMEOUT:{message:"The authenticationEndpoint you provided timed out in 60 seconds",help:""},AUTH_ENDPOINT_NETWORK_ERROR:{message:"Request to authenticationEndpoint failed due to network error",help:""},AUTH_INVALID_RESPONSE:{message:"Invalid response from authenticationEndpoint. The SDK expects a JSON response with three fields i.e. signature, token and expire.",help:""},UPLOAD_ENDPOINT_NETWORK_ERROR:{message:"Request to ImageKit upload endpoint failed due to network error",help:""},INVALID_UPLOAD_OPTIONS:{message:"Invalid uploadOptions parameter",help:""},MISSING_SIGNATURE:{message:"Missing signature for upload. The SDK expects token, sginature and expire for authentication.",help:""},MISSING_TOKEN:{message:"Missing token for upload. The SDK expects token, sginature and expire for authentication.",help:""},MISSING_EXPIRE:{message:"Missing expire for upload. The SDK expects token, sginature and expire for authentication.",help:""}};function u(i,t,e){typeof e=="function"&&(i?e(t,null):e(null,t))}function W(i){var t={},e=i.getAllResponseHeaders();return Object.keys(e).length&&e.trim().split(/[\r\n]+/).map(function(a){return a.split(/: /)}).forEach(function(a){t[a[0].trim()]=a[1].trim()}),t}var P=function(t,e){var a=h({},t),r={statusCode:e.status,headers:W(e)};return Object.defineProperty(a,"$ResponseMetadata",{value:r,enumerable:!1,writable:!1}),a},Y=function(t,e,a){J(t,e).then(function(r){return u(!1,r,a)},function(r){return u(!0,r,a)})},J=function(t,e){return new Promise(function(a,r){t.open("POST","https://upload.imagekit.io/api/v1/files/upload"),t.onerror=function(n){return r(d.UPLOAD_ENDPOINT_NETWORK_ERROR)},t.onload=function(){if(t.status===200)try{var n=JSON.parse(t.responseText),o=P(n,t);return a(o)}catch(m){return r(m)}else try{var n=JSON.parse(t.responseText),l=P(n,t);return r(l)}catch(m){return r(m)}},t.send(e)})},Q=function(t,e,a,r){if(!e.file){u(!0,d.MISSING_UPLOAD_FILE_PARAMETER,r);return}if(!e.fileName){u(!0,d.MISSING_UPLOAD_FILENAME_PARAMETER,r);return}if(!a.publicKey){u(!0,d.MISSING_PUBLIC_KEY,r);return}if(!e.token){u(!0,d.MISSING_TOKEN,r);return}if(!e.signature){u(!0,d.MISSING_SIGNATURE,r);return}if(!e.expire){u(!0,d.MISSING_EXPIRE,r);return}var n=new FormData,o;for(o in e)o&&(o==="file"&&typeof e.file!="string"?n.append("file",e.file,String(e.fileName)):o==="tags"&&Array.isArray(e.tags)?n.append("tags",e.tags.join(",")):o==="signature"?n.append("signature",e.signature):o==="expire"?n.append("expire",String(e.expire)):o==="token"?n.append("token",e.token):o==="responseFields"&&Array.isArray(e.responseFields)?n.append("responseFields",e.responseFields.join(",")):o==="extensions"&&Array.isArray(e.extensions)?n.append("extensions",JSON.stringify(e.extensions)):o==="customMetadata"&&y(e.customMetadata)==="object"&&!Array.isArray(e.customMetadata)&&e.customMetadata!==null?n.append("customMetadata",JSON.stringify(e.customMetadata)):e[o]!==void 0&&n.append(o,String(e[o])));n.append("publicKey",a.publicKey),Y(t,n,r)},F={width:"w",height:"h",aspectRatio:"ar",quality:"q",crop:"c",cropMode:"cm",focus:"fo",x:"x",y:"y",format:"f",radius:"r",background:"bg",border:"b",rotation:"rt",rotate:"rt",blur:"bl",named:"n",overlayImage:"oi",overlayImageAspectRatio:"oiar",overlayImageBackground:"oibg",overlayImageBorder:"oib",overlayImageDPR:"oidpr",overlayImageQuality:"oiq",overlayImageCropping:"oic",overlayImageTrim:"oit",overlayX:"ox",overlayY:"oy",overlayFocus:"ofo",overlayHeight:"oh",overlayWidth:"ow",overlayText:"ot",overlayTextFontSize:"ots",overlayTextFontFamily:"otf",overlayTextColor:"otc",overlayTextTransparency:"oa",overlayAlpha:"oa",overlayTextTypography:"ott",overlayBackground:"obg",overlayTextEncoded:"ote",overlayTextWidth:"otw",overlayTextBackground:"otbg",overlayTextPadding:"otp",overlayTextInnerAlignment:"otia",overlayRadius:"or",progressive:"pr",lossless:"lo",trim:"t",metadata:"md",colorProfile:"cp",defaultImage:"di",dpr:"dpr",effectSharpen:"e-sharpen",effectUSM:"e-usm",effectContrast:"e-contrast",effectGray:"e-grayscale",original:"orig",raw:"raw"},O="path",D="query",H=[O,D],Z=":",$=",",X="-",p={getDefault:function(){return O},addAsQueryParameter:function(t){return t.transformationPosition===D},validParameters:function(t){return typeof t.transformationPosition>"u"?!1:H.indexOf(t.transformationPosition)!=-1},getTransformKey:function(t){return t&&(F[t]||F[t.toLowerCase()])||""},getChainTransformDelimiter:function(){return Z},getTransformDelimiter:function(){return $},getTransformKeyValueDelimiter:function(){return X}},M="tr";function ee(i){return typeof i=="string"&&i[i.length-1]=="/"&&(i=i.substring(0,i.length-1)),i}function te(i){return typeof i=="string"&&i[0]=="/"&&(i=i.slice(1)),i}function b(i,t){var e=t||"/",a=new RegExp(e+"{1,}","g");return i.join(e).replace(a,e)}var ie=function(t){if(!t.path&&!t.src)return"";var e,a,r;try{t.path?(r=new URL(t.urlEndpoint).pathname,e=new URL(b([t.urlEndpoint.replace(r,""),t.path]))):(e=new URL(t.src),a=!0)}catch(l){return console.error(l),""}for(var n in t.queryParameters)e.searchParams.append(n,String(t.queryParameters[n]));var o=ae(t.transformation);return o&&o.length&&(p.addAsQueryParameter(t)||a?e.searchParams.append(M,o):e.pathname=b([M+p.getChainTransformDelimiter()+o,e.pathname])),r?e.pathname=b([r,e.pathname]):e.pathname=b([e.pathname]),e.href};function ae(i){if(!Array.isArray(i))return"";for(var t=[],e=0,a=i.length;e<a;e++){var r=[];for(var n in i[e]){var o=p.getTransformKey(n);if(o||(o=n),i[e][n]==="-")r.push(o);else if(n==="raw")r.push(i[e][n]);else{var l=i[e][n];(o==="oi"||o==="di")&&(l=ee(te(l||"")),l=l.replace(/\//g,"@@")),r.push([o,l].join(p.getTransformKeyValueDelimiter()))}}t.push(r.join(p.getTransformDelimiter()))}return t.join(p.getChainTransformDelimiter())}var re=function(t,e){return ie(h(h({},e),t))};function ne(i){return i.urlEndpoint}var oe=function(t,e){return function(){for(var a=arguments.length,r=new Array(a),n=0;n<a;n++)r[n]=arguments[n];if(r.length===e.length&&typeof r[r.length-1]<"u"){if(typeof r[r.length-1]!="function")throw new Error("Callback must be a function.");e.call.apply(e,[t].concat(r))}else return new Promise(function(o,l){var m=function(A){if(A)return l(A);for(var _=arguments.length,T=new Array(_>1?_-1:0),I=1;I<_;I++)T[I-1]=arguments[I];o(T.length>1?T:T[0])};r.pop(),r.push(m),e.call.apply(e,[t].concat(r))})}},se=function(){function i(t){if(j(this,i),R(this,"options",{sdkVersion:"javascript-".concat(q),publicKey:"",urlEndpoint:"",transformationPosition:p.getDefault()}),this.options=h(h({},this.options),t||{}),!ne(this.options))throw d.MANDATORY_INITIALIZATION_MISSING;if(!p.validParameters(this.options))throw d.INVALID_TRANSFORMATION_POSITION}return V(i,[{key:"url",value:function(e){return re(e,this.options)}},{key:"upload",value:function(e,a,r){var n;if(typeof a=="function"?n=a:r=a||{},!e||y(e)!=="object")return u(!0,d.INVALID_UPLOAD_OPTIONS,n);var o=h(h({},this.options),r),l=e||{},m=l.xhr;delete e.xhr;var U=m||new XMLHttpRequest;return oe(this,Q)(U,e,o,n)}}]),i}();const le={name:"FileUploadInput",props:["btnCls","disable","maxFileSize","storageType"],emits:["processUploadedFileUrl"],data(){return{componentId:null,file:null,newFileName:null,uploadedFileSize:null,uploadToken:null,waitingUpload:!1}},mounted(){this.componentId=this.$.uid},computed:{fileTooBig(){if(this.uploadedFileSize)return this.maxFileSize&&this.uploadedFileSize>this.maxFileSize}},methods:{async arweaveUpload(){const i=window.location.origin;let t;this.$config.fileUploadTokenService==="netlify"?t=i+"/.netlify/functions/arweaveUploader":this.$config.fileUploadTokenService==="vercel"&&(t=i+"/api/arweaveUploader");const e=await this.fileToBase64(this.file),a=this.file.type;let o=`ar://${(await k.post(t,{fileData:e,fileName:this.file.name,fileType:this.file.type})).data.transactionId}`;a.startsWith("image/")?o+="?img":a.startsWith("video/")||a.startsWith("audio/")?o+=`?${a}`:a.startsWith("text/plain")&&(o+="?txt"),this.$emit("processUploadedFileUrl",o)},async imageKitUpload(){const i=window.location.origin;let t;this.$config.fileUploadTokenService==="netlify"?t=i+"/.netlify/functions/imageKitUploader":this.$config.fileUploadTokenService==="vercel"&&(t=i+"/api/imageKitUploader");const e=await $fetch(t).catch(o=>o.data);let a=e;typeof e=="string"&&(a=JSON.parse(e));const n=await new se({publicKey:this.$config.imagekitPublicKey,urlEndpoint:this.$config.imagekitEndpoint}).upload({file:this.file,fileName:this.newFileName,tags:[this.$config.projectName,this.$config.projectUrl],token:a.data.token,signature:a.data.signature,expire:a.data.expire});this.$emit("processUploadedFileUrl",n.url),this.waitingUpload=!1},handleFileInput(i){const t=i.target.files[0];if(this.uploadedFileSize=t.size,this.maxFileSize&&t.size>this.maxFileSize){const n=this.maxFileSize/1024/1024;console.error("File is too large (max size is "+n+" MB)");return}const a=t.name.split(".").pop();this.newFileName=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+"."+a;const r=new File([t],this.newFileName,{type:t.type});this.file=r},async uploadFile(){if(this.waitingUpload=!0,this.storageType==="arweave")try{await this.arweaveUpload()}catch(i){console.error("Error uploading file to decentralized storage service",i),console.log("Falling back to centralized storage service"),await this.imageKitUpload()}else try{await this.imageKitUpload()}catch(i){console.error("Error uploading file to centralized storage service",i),console.log("Falling back to decentralized storage service"),await this.arweaveUpload()}this.waitingUpload=!1},fileToBase64(i){return new Promise((t,e)=>{const a=new FileReader;a.readAsDataURL(i),a.onload=()=>t(a.result.split(",")[1]),a.onerror=r=>e(r)})}}},de=["id","disabled"],ue=["disabled"],ce={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},fe={key:0,class:"alert alert-danger mt-3",role:"alert"};function pe(i,t,e,a,r,n){return c(),f(K,null,[s("input",{onChange:t[0]||(t[0]=(...o)=>n.handleFileInput&&n.handleFileInput(...o)),type:"file",class:"form-control form-control-lg mb-3",id:"file-input-"+r.componentId,disabled:r.waitingUpload||e.disable},null,40,de),s("button",{type:"button",class:N(e.btnCls),onClick:t[1]||(t[1]=(...o)=>n.uploadFile&&n.uploadFile(...o)),disabled:r.waitingUpload||!r.file||n.fileTooBig||e.disable},[r.waitingUpload?(c(),f("span",ce)):g("",!0),S(" Upload ")],10,ue),n.fileTooBig?(c(),f("div",fe," File is too big (max size is "+v(e.maxFileSize/1024/1024)+" MB). ",1)):g("",!0)],64)}const me=x(le,[["render",pe]]),he={name:"FileUploadModal",props:["title","componentId","infoText","maxFileSize","storageType"],emits:["processFileUrl"],components:{FileUploadInput:me},data(){return{currentTab:"upload",pastedLink:null}},mounted(){this.fileUploadEnabled||(this.currentTab="paste")},computed:{arweaveBalance(){const i=this.siteStore.arweaveBalance;if(i){const t=Number(i).toFixed(6);return Number.parseFloat(t)}return 0},arweaveBalanceTooLow(){return this.storageType!=="arweave"?!1:this.arweaveBalance<this.$config.arweaveMinBalance},fileUploadEnabled(){return this.siteStore.getFileUploadEnabled},getTitle(){return this.title||"Upload file"}},methods:{processUploadedFileUrl(i){this.$emit("processFileUrl",i),document.getElementById("closeFileUploadModal"+this.componentId).click()}},setup(){return{siteStore:L()}},watch:{fileUploadEnabled(){this.fileUploadEnabled?this.currentTab="upload":this.currentTab="paste"}}},ge=["id","aria-labelledby"],ve={class:"modal-dialog"},ye={class:"modal-content"},Te={class:"modal-header"},Ie=["id"],be=["id"],_e={class:"modal-body mb-4"},Se={class:"nav nav-tabs nav-fill"},Ne={class:"nav-item"},Ue=["disabled"],Ae={class:"nav-item"},we={class:"tab-content mt-3"},Ee={key:0},Pe={key:0},Fe={key:1},Me=s("p",{class:"text-danger"}," Error: Arweave is used as file storage. Current balance in the Arweave wallet is insufficient to do the upload. ",-1),xe=["href"],Re={key:1},Oe=s("p",null,"Paste file link",-1),De=["disabled"];function Le(i,t,e,a,r,n){const o=C("FileUploadInput");return c(),f("div",{class:"modal fade",id:"fileUploadModal"+e.componentId,tabindex:"-1","aria-labelledby":"fileUploadModalLabel"+e.componentId,"aria-hidden":"true"},[s("div",ve,[s("div",ye,[s("div",Te,[s("h1",{class:"modal-title fs-5",id:"fileUploadModalLabel"+e.componentId},v(n.getTitle),9,Ie),s("button",{id:"closeFileUploadModal"+e.componentId,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,8,be)]),s("div",_e,[s("ul",Se,[s("li",Ne,[s("button",{disabled:!this.fileUploadEnabled,class:N(["nav-link",r.currentTab==="upload"?"active":""]),onClick:t[0]||(t[0]=l=>r.currentTab="upload")}," Upload ",10,Ue)]),s("li",Ae,[s("button",{class:N(["nav-link",r.currentTab==="paste"?"active":""]),onClick:t[1]||(t[1]=l=>r.currentTab="paste")}," Paste Link ",2)])]),s("div",we,[r.currentTab==="upload"?(c(),f("div",Ee,[e.infoText?(c(),f("p",Pe,v(e.infoText),1)):g("",!0),n.arweaveBalanceTooLow?(c(),f("div",Fe,[Me,s("p",null,[S(" Please send AR tokens to this wallet (min. "+v(i.$config.arweaveMinBalance)+" AR): ",1),s("a",{href:"https://arscan.io/address/"+this.$config.arweaveAddress,target:"_blank"},v(this.$config.arweaveAddress),9,xe),S(". ")])])):g("",!0),B(o,{btnCls:"btn btn-primary",disable:n.arweaveBalanceTooLow,maxFileSize:e.maxFileSize,storageType:e.storageType,onProcessUploadedFileUrl:n.processUploadedFileUrl},null,8,["disable","maxFileSize","storageType","onProcessUploadedFileUrl"])])):g("",!0),r.currentTab==="paste"?(c(),f("div",Re,[Oe,z(s("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>r.pastedLink=l),type:"text",class:"form-control mb-3",placeholder:"Enter http link to file"},null,512),[[G,r.pastedLink]]),s("button",{class:"btn btn-primary",onClick:t[3]||(t[3]=l=>n.processUploadedFileUrl(r.pastedLink)),disabled:!r.pastedLink}," Submit link ",8,De)])):g("",!0)])])])])],8,ge)}const Ce=x(he,[["render",Le]]);export{Ce as F,me as a};
