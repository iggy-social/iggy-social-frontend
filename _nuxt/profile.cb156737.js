import{H as U,T as F,M as L}from"./components.8e057a49.js";import{a as v,I as E,C,l as M,r as g,o as n,b as r,z as a,F as I,G as O,e as m,f as s,t as c,p as P,A as N,v as $,S as x,c as b,u as S,i as u,D as y,w as k,x as B,y as j,h as V,T as z}from"./entry.354d6115.js";import{g as T}from"./textUtils.b82efedc.js";import{u as H}from"./user.99e34a82.js";import{P as q}from"./ProfileImage.8d714880.js";import{F as W}from"./FileUploadModal.417a32ab.js";import{M as R}from"./MintedPostImage.dfed9a30.js";import{r as Y,R as G}from"./ChatPost.d3c0e654.js";import{C as Z}from"./ChatFeed.ac9b5a1e.js";import{a as J,s as A}from"./storageUtils.01372656.js";import{g as K}from"./balanceUtils.5275f201.js";import"./composables.3d2a5f27.js";import"./site.c346025e.js";import"./WaitingToast.ddd58833.js";import"./ConnectWalletButton.790a22a2.js";import"./SwitchChainButton.75f5ad55.js";const Q={name:"UserMintedPosts",props:["address"],data(){return{loadingMintedPosts:!1,mintedPostIds:[],postsDifference:0}},components:{MintedPostImage:R},mounted(){this.fetchMintedPostIds()},methods:{async fetchMintedPostIds(){this.loadingMintedPosts=!0;let e=this.$getFallbackProvider(this.$config.supportedChainId);this.isActivated&&this.chainId===this.$config.supportedChainId&&(e=this.signer);const o=new E(["function getMintedPostIdsArray(address) external view returns (uint256[] memory)"]);let l=await new C(this.$config.iggyPostStatsAddress,o,e).getMintedPostIdsArray(this.address);l=[...l].reverse(),this.mintedPostIds=l.slice(0,this.$config.profileMintedPostIdsMax),this.postsDifference=l.length-this.mintedPostIds.length,this.loadingMintedPosts=!1}},setup(){const{isActivated:e,chainId:o,signer:i}=M();return{isActivated:e,chainId:o,signer:i}}},X={key:0,class:"d-flex justify-content-center mb-3"},ee=s("span",{class:"spinner-border spinner-border-lg",role:"status","aria-hidden":"true"},null,-1),se=[ee],te={key:1,class:"row"},ie={key:2,class:"d-flex justify-content-center mt-3"},oe={key:3},ne=s("p",null,"No minted posts yet.",-1),re=[ne];function ae(e,o,i,l,t,d){const f=g("MintedPostImage");return n(),r(I,null,[t.loadingMintedPosts?(n(),r("div",X,se)):a("",!0),t.mintedPostIds?(n(),r("div",te,[(n(!0),r(I,null,O(t.mintedPostIds,h=>(n(),r("div",{class:"col-6 col-sm-4 col-md-3 mb-2",key:h},[m(f,{id:h},null,8,["id"])]))),128))])):a("",!0),t.postsDifference>0?(n(),r("div",ie,[s("p",null,"+ "+c(t.postsDifference)+" other minted posts",1)])):a("",!0),!t.loadingMintedPosts&&t.mintedPostIds.length===0?(n(),r("div",oe,re)):a("",!0)],64)}const de=v(Q,[["render",ae]]),le={name:"PunkProfile",props:["pAddress","pDomain"],data(){return{balanceAp:0,balanceChatTokenWei:0,currentTab:"posts",domain:this.pDomain,emailForNotificationsSet:!1,followers:0,following:0,lastActivityTimestamp:null,newEmail:null,newImageLink:null,orbisImage:null,orbisProfile:null,uAddress:this.pAddress,uBalance:0,uDid:null,waitingDataLoad:!1,waitingImageUpdate:!1,waitingSetEmail:!1}},components:{ChatFeed:Z,FileUploadModal:W,ProfileImage:q,UserMintedPosts:de},mounted(){this.currentTab=localStorage.getItem("profileCurrentTab"),this.currentTab||(this.currentTab="posts"),(!this.pAddress||!this.pDomain)&&this.fetchAddressAndDomain(),this.checkConnectionToOrbis()},computed:{balanceChatToken(){const e=P(this.balanceChatTokenWei);return e>=0?Math.floor(Number(e)):Number(e).toFixed(4)},balanceEth(){const e=P(this.uBalance);return e>0?Number(e).toFixed(2):Number(e).toFixed(4)},getOrbisContext(){return this.$config.orbisTest?this.$config.orbisTestContext:this.$config.chatChannels.general},isCurrentUser(){return String(this.uAddress).toLowerCase()===String(this.address).toLowerCase()},isEmail(){return!!(this.newEmail&&this.newEmail.includes("@")&&this.newEmail.includes("."))},isImage(){return!!(this.newImageLink&&(this.newImageLink.includes(".jpg")||this.newImageLink.includes(".jpeg")||this.newImageLink.includes(".png")||this.newImageLink.includes(".gif")||this.newImageLink.includes(".webp")))}},methods:{changeCurrentTab(e){this.currentTab=e,localStorage.setItem("profileCurrentTab",e)},async changeImage(){if(this.userStore.getIsConnectedToOrbis){this.waitingImageUpdate=!0,this.orbisProfile||(this.orbisProfile={pfp:"",username:""}),this.orbisProfile.pfp=this.newImageLink,!this.orbisProfile.username&&this.domain&&(this.orbisProfile.username=this.domain);const e=await this.$orbis.updateProfile(this.orbisProfile);e.status!==200?(console.log("Error: ",e),this.toast(e.result,{type:"error"}),this.waitingImageUpdate=!1):(this.orbisImage=this.newImageLink,this.userStore.setOrbisImage(this.newImageLink),sessionStorage.setItem(String(this.address).toLowerCase()+"-img",this.newImageLink),this.toast("Image successfully updated!",{type:"success"}),this.waitingImageUpdate=!1)}else this.toast("Please connect to chat first",{type:"error"})},async checkConnectionToOrbis(){this.userStore.getIsConnectedToOrbis||(await this.$orbis.isConnected()?(this.userStore.setIsConnectedToOrbis(!0),this.$orbis.session&&!this.userStore.getDid&&(this.userStore.setDid(this.$orbis.session.did._id),this.userStore.setDidParent(this.$orbis.session.did._parentId))):this.userStore.setIsConnectedToOrbis(!1))},async connectToOrbis(){if(!this.userStore.getIsConnectedToOrbis){let e=await this.$orbis.connect_v2({provider:this.signer.provider.provider,lit:!1});e.status==200?(this.userStore.setIsConnectedToOrbis(!0),this.$orbis.session&&(this.userStore.setDid(this.$orbis.session.did._id),this.userStore.setDidParent(this.$orbis.session.did._parentId))):(console.log("Error connecting to Ceramic: ",e),this.toast(e.result,{type:"error"}))}},async fetchAddressAndDomain(){if(this.waitingDataLoad=!0,this.$route.query.id){const i=this.$route.query.id;i.includes(".")?this.domain=i:this.uAddress=i}else this.uAddress=this.address;!this.domain&&this.uAddress&&(this.domain=J(window,this.uAddress));let e=this.$getFallbackProvider(this.$config.supportedChainId);this.isActivated&&this.chainId===this.$config.supportedChainId&&(e=this.signer);const o=new C(Y[this.$config.supportedChainId],G,e);if(!this.domain&&this.uAddress){const i=await o.getDefaultDomain(String(this.uAddress).toLowerCase(),String(this.$config.tldName).toLowerCase());i&&(this.domain=i+this.$config.tldName,A(window,this.uAddress,this.domain))}if(this.domain&&!this.uAddress){const i=await o.getDomainHolder(String(this.domain).toLowerCase().split(".")[0],String(this.$config.tldName).toLowerCase());i!==N&&(this.uAddress=i),A(window,this.uAddress,this.domain)}await this.fetchOrbisProfile(),await this.fetchBalance()},async fetchBalance(){if(this.uAddress){let e=this.$getFallbackProvider(this.$config.supportedChainId);if(this.uBalance=await e.getBalance(this.uAddress),this.$config.chatTokenAddress){const o=new E(["function balanceOf(address owner) view returns (uint256)"]),i=new C(this.$config.chatTokenAddress,o,e);this.balanceChatTokenWei=await i.balanceOf(this.uAddress)}this.$config.activityPointsAddress&&this.$config.showFeatures.activityPoints&&(this.balanceAp=await K(this.uAddress,e))}},async fetchOrbisProfile(){if(this.orbisProfile={pfp:"",username:""},this.uAddress){let{data:e,error:o}=await this.$orbis.getDids(this.uAddress);if(e[0]?.did){this.uDid=e[0].did;const i=await this.$orbis.getProfile(e[0].did);i.status===200&&(this.orbisProfile=i.data.details.profile,i&&i.data.details.profile&&i.data.details.profile.pfp&&(this.orbisImage=i.data.details.profile.pfp),i&&(this.followers=i.data.count_followers,this.following=i.data.count_following,this.lastActivityTimestamp=i.data.last_activity_timestamp),i.data.details.encrypted_email?this.emailForNotificationsSet=!0:this.emailForNotificationsSet=!1,this.waitingDataLoad=!1)}this.waitingDataLoad=!1}},async insertImage(e){this.newImageLink=e,this.changeImage()},async setEmailNotifications(e){if(this.userStore.getIsConnectedToOrbis){this.waitingSetEmail=!0,e&&(this.newEmail="");let o=await this.$orbis.setEmail(this.newEmail);o.status!==200?(console.log("Error: ",o),this.toast(o.result,{type:"error"}),this.waitingSetEmail=!1):(this.toast("Email notifications successfully set!",{type:"success"}),this.waitingSetEmail=!1,document.getElementById("setEmailModalClose").click())}else this.toast("Please connect to chat first",{type:"error"})}},setup(){const{address:e,balance:o,chainId:i,isActivated:l,signer:t}=M(),d=H(),f=$();return{address:e,balance:o,chainId:i,isActivated:l,userStore:d,shortenAddress:x,signer:t,toast:f}},watch:{address(){this.fetchAddressAndDomain()}}},ce={class:"card border"},he={class:"card-body"},me=s("i",{class:"bi bi-arrow-left-circle cursor-pointer"},null,-1),ue=[me],fe={class:"row"},pe={class:"col-md-3 mt-3"},ge={class:"col-md-9 mt-3"},be={key:0,class:"mb-3"},_e={key:1,class:"mb-3"},we={class:"mt-4 muted-text",style:{"font-size":"14px"}},ye={class:"me-4"},Ce=s("i",{class:"bi bi-wallet me-1"},null,-1),Ie={key:0,class:"me-4"},ke=s("i",{class:"bi bi-wallet me-1"},null,-1),ve={key:1,class:"me-4"},Pe=s("i",{class:"bi bi-wallet me-1"},null,-1),Se={class:"me-4"},Te=s("i",{class:"bi bi-box-arrow-up-right me-2"},null,-1),Ae=["href"],Ee={key:2,class:"mt-2"},Me={class:"dropdown mt-2"},De=s("button",{class:"btn btn-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[s("i",{class:"bi bi-sliders"}),u(" Profile settings ")],-1),Ue={class:"dropdown-menu"},Fe={key:0,class:"dropdown-item cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#verifyAccountModal"},Le=s("i",{class:"bi bi-person-check-fill"},null,-1),Oe=["data-bs-target"],Ne=s("i",{class:"bi bi-person-circle"},null,-1),$e=V('<span class="dropdown-item cursor-pointer" data-bs-toggle="modal" data-bs-target="#changeUsernameModal"><i class="bi bi-pencil-square"></i> Change your username </span><span class="dropdown-item cursor-pointer" data-bs-toggle="modal" data-bs-target="#setEmailModal"><i class="bi bi-envelope-at-fill"></i> Set email notification for chat </span><span class="dropdown-item cursor-pointer" data-bs-toggle="modal" data-bs-target="#chatSettingsModal"><i class="bi bi-gear-fill"></i> Other settings </span><span class="dropdown-item cursor-pointer" data-bs-toggle="modal" data-bs-target="#referralModal"><i class="bi bi-person-plus-fill"></i> Share referral link </span>',4),xe=s("i",{class:"bi bi-send"},null,-1),Be={class:"modal fade",id:"setEmailModal",tabindex:"-1","aria-labelledby":"setEmailModalLabel","aria-hidden":"true"},je={class:"modal-dialog"},Ve={class:"modal-content"},ze=s("div",{class:"modal-header"},[s("h1",{class:"modal-title fs-5",id:"setEmailModalLabel"},"Set email notifications"),s("button",{type:"button",id:"setEmailModalClose",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),He={class:"modal-body"},qe={key:0},We=s("p",null,"First connect to Ceramic to set email notifications:",-1),Re={key:1,class:"mt-3"},Ye=s("p",null,"Enter your email address to receive notifications about replies on your posts.",-1),Ge=s("p",null,"The email address will be encrypted and will not be publicly visible.",-1),Ze={key:0},Je={key:1},Ke={key:2,class:"text-danger"},Qe={class:"modal-footer"},Xe=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1),es=["disabled"],ss={key:0,class:"spinner-border spinner-border-sm mx-1",role:"status","aria-hidden":"true"},ts={class:"card border mt-3 mb-3"},is={class:"card-body"},os={class:"nav nav-tabs nav-fill"},ns={class:"nav-item"},rs={class:"nav-item"},as={class:"tab-content mt-3"},ds={key:0},ls={key:1};function cs(e,o,i,l,t,d){const f=g("ProfileImage"),h=z,_=g("FileUploadModal"),w=g("ChatFeed"),D=g("UserMintedPosts");return n(),r("div",null,[s("div",ce,[s("div",he,[s("p",{class:"fs-3",onClick:o[0]||(o[0]=p=>e.$router.back())},ue),s("div",fe,[s("div",pe,[t.uAddress?(n(),b(f,{key:t.orbisImage,class:"img-fluid img-thumbnail rounded-circle col-6 col-md-12",address:t.uAddress,domain:t.domain,image:t.orbisImage},null,8,["address","domain","image"])):a("",!0)]),s("div",ge,[t.domain&&!d.isCurrentUser?(n(),r("h3",be,c(S(T)(t.domain)),1)):a("",!0),t.domain&&d.isCurrentUser?(n(),r("h3",_e,c(S(T)(l.userStore.getDefaultDomain)),1)):a("",!0),s("div",we,[s("p",ye,[Ce,u(" "+c(d.balanceEth)+" "+c(e.$config.tokenSymbol),1)]),e.$config.chatTokenAddress?(n(),r("p",Ie,[ke,u(" "+c(d.balanceChatToken)+" "+c(e.$config.chatTokenSymbol),1)])):a("",!0),e.$config.activityPointsAddress&&e.$config.showFeatures.activityPoints?(n(),r("p",ve,[Pe,u(" "+c(t.balanceAp)+" AP ",1)])):a("",!0),s("p",Se,[Te,s("a",{href:e.$config.blockExplorerBaseUrl+"/address/"+t.uAddress,target:"_blank",style:{"text-decoration":"none"}},c(l.shortenAddress(t.uAddress)),9,Ae)])]),d.isCurrentUser?(n(),r("div",Ee,[s("div",Me,[De,s("div",Ue,[l.userStore.getIsConnectedToOrbis?a("",!0):(n(),r("span",Fe,[Le,u(" Verify account ownership ")])),s("span",{class:y(["dropdown-item cursor-pointer",l.userStore.getIsConnectedToOrbis?"":"disabled"]),"data-bs-toggle":"modal","data-bs-target":"#fileUploadModal"+e.$.uid},[Ne,u(" Change your profile picture ")],10,Oe),$e])])])):a("",!0),t.domain&&!d.isCurrentUser&&e.$config.showFeatures.sendTokens?(n(),b(h,{key:3,class:"btn btn-primary mt-2",to:"/send-tokens/?to="+t.domain},{default:k(()=>[xe,u(" Send tokens to "+c(t.domain),1)]),_:1},8,["to"])):a("",!0)])])]),s("div",Be,[s("div",je,[s("div",Ve,[ze,s("div",He,[l.userStore.getIsConnectedToOrbis?a("",!0):(n(),r("div",qe,[We,s("button",{class:"btn btn-primary",onClick:o[1]||(o[1]=(...p)=>d.connectToOrbis&&d.connectToOrbis(...p))},"Connect to Ceramic")])),l.userStore.getIsConnectedToOrbis?(n(),r("div",Re,[Ye,Ge,t.emailForNotificationsSet?(n(),r("p",Ze," Currently, the email for notifications is already set. You can change it by entering a new email address below: ")):a("",!0),t.emailForNotificationsSet?a("",!0):(n(),r("p",Je," Currently, the email for notifications is NOT yet set. You can add your email address below: ")),B(s("input",{"onUpdate:modelValue":o[2]||(o[2]=p=>t.newEmail=p),type:"email",class:"form-control mt-2",placeholder:"Enter email address"},null,512),[[j,t.newEmail]]),t.newEmail&&!d.isEmail?(n(),r("small",Ke," Error: The entered text is not an email. ")):a("",!0)])):a("",!0)]),s("div",Qe,[Xe,s("button",{type:"button",class:"btn btn-primary",onClick:o[3]||(o[3]=p=>d.setEmailNotifications(!1)),disabled:!l.userStore.getIsConnectedToOrbis||!d.isEmail},[t.waitingSetEmail?(n(),r("span",ss)):a("",!0),u(" Submit email ")],8,es)])])])]),l.userStore.getIsConnectedToOrbis?(n(),b(_,{key:0,onProcessFileUrl:d.insertImage,title:"Change profile image",infoText:"Upload a new profile picture.",componentId:e.$.uid,maxFileSize:e.$config.fileUploadSizeLimit},null,8,["onProcessFileUrl","componentId","maxFileSize"])):a("",!0)]),s("div",ts,[s("div",is,[s("ul",os,[s("li",ns,[s("button",{class:y(["nav-link",t.currentTab==="posts"?"active":""]),onClick:o[4]||(o[4]=p=>d.changeCurrentTab("posts"))},"Posts",2)]),s("li",rs,[s("button",{class:y(["nav-link",t.currentTab==="mints"?"active":""]),onClick:o[5]||(o[5]=p=>d.changeCurrentTab("mints"))},"Mints",2)])]),s("div",as,[t.currentTab==="posts"&&t.uDid?(n(),r("div",ds,[m(w,{byDid:t.uDid,hideCommentBox:!0,orbisContext:d.getOrbisContext},null,8,["byDid","orbisContext"])])):a("",!0),t.currentTab==="mints"&&t.uAddress?(n(),r("div",ls,[m(D,{address:t.uAddress},null,8,["address"])])):a("",!0)])])])])}const hs=v(le,[["render",cs]]),ms={name:"Profile",components:{PunkProfile:hs},setup(){}};function us(e,o,i,l,t,d){const f=F,h=L,_=U,w=g("PunkProfile");return n(),r(I,null,[m(_,null,{default:k(()=>[m(f,null,{default:k(()=>[u("Profile | "+c(e.$config.projectMetadataTitle),1)]),_:1}),m(h,{name:"description",content:"Check out this profile on "+e.$config.projectName+"!"},null,8,["content"]),m(h,{property:"og:image",content:e.$config.projectUrl+e.$config.previewImageProfile},null,8,["content"]),m(h,{property:"og:description",content:"Check out this profile on "+e.$config.projectName+"!"},null,8,["content"]),m(h,{name:"twitter:image",content:e.$config.projectUrl+e.$config.previewImageProfile},null,8,["content"]),m(h,{name:"twitter:description",content:"Check out this profile on "+e.$config.projectName+"!"},null,8,["content"])]),_:1}),(n(),b(w,{key:e.$route.query.id,class:"mt-1"}))],64)}const Ms=v(ms,[["render",us]]);export{Ms as default};
