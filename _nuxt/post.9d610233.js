import{H as f,M}from"./components.d76c6de7.js";import{a as I,ar as x,ae as T,b as c,f as _,e as r,w as d,c as l,l as p,F as b,r as g,as as N,o,i as k}from"./entry.78874e04.js";import{C as w,a as v}from"./ChatFeed.31e691dd.js";import{I as R,C as F}from"./ethers.864c86b9.js";import"./composables.bc785379.js";import"./textUtils.b5bfc50f.js";import"./Image.c2f1e3a9.js";import"./site.a14dd1d9.js";import"./balanceUtils.e864ca70.js";import"./user.ed657d98.js";import"./SwitchChainButton.16857b5e.js";import"./WaitingToast.c7c3bee6.js";import"./domainUtils.65e04b8e.js";import"./storageUtils.c8deba3e.js";import"./FileUploadModal.b8ae4db2.js";import"./FileUploadInput.0485fc12.js";const V={data(){return{message:null,reply:null}},components:{ChatFeed:w,ChatMessage:v},created(){this.getMessage()},computed:{getChatContext(){return this.route.query.context},getMessageId(){return this.route.query.id},getReplyId(){return this.route.query.reply},isReply(){return!!this.route.query.reply},mainMessagePage(){return`/post/?id=${this.getMessageId}&context=${this.getChatContext}`}},methods:{async getMessage(){this.message=null,this.reply=null;try{const e=this.$getFallbackProvider(this.$config.supportedChainId),s=new R([{inputs:[{internalType:"uint256",name:"mainMsgIndex_",type:"uint256"}],name:"getMainMessage",outputs:[{components:[{internalType:"address",name:"author",type:"address"},{internalType:"uint256",name:"createdAt",type:"uint256"},{internalType:"bool",name:"deleted",type:"bool"},{internalType:"uint256",name:"index",type:"uint256"},{internalType:"uint256",name:"repliesCount",type:"uint256"},{internalType:"string",name:"url",type:"string"}],internalType:"struct ChatFeed.Message",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"mainMsgIndex_",type:"uint256"},{internalType:"uint256",name:"replyMsgIndex_",type:"uint256"}],name:"getReply",outputs:[{components:[{internalType:"address",name:"author",type:"address"},{internalType:"uint256",name:"createdAt",type:"uint256"},{internalType:"bool",name:"deleted",type:"bool"},{internalType:"uint256",name:"index",type:"uint256"},{internalType:"uint256",name:"repliesCount",type:"uint256"},{internalType:"string",name:"url",type:"string"}],internalType:"struct ChatFeed.Message",name:"",type:"tuple"}],stateMutability:"view",type:"function"}]),u=new F(this.getChatContext,s,e);let n,t;n=await u.getMainMessage(this.getMessageId),this.isReply&&(t=await u.getReply(this.getMessageId,this.getReplyId)),n.deleted?this.toast("This message has been deleted.",{type:"info"}):this.message={author:n.author,url:n.url,createdAt:n.createdAt.toNumber(),deleted:n.deleted,repliesCount:n.repliesCount.toNumber(),index:n.index.toNumber()},t&&(t.deleted?this.toast("This reply has been deleted.",{type:"info"}):this.reply={author:t.author,url:t.url,createdAt:t.createdAt.toNumber(),deleted:t.deleted,repliesCount:t.repliesCount.toNumber(),index:t.index.toNumber()})}catch(e){console.error(e),this.toast("Failed to load the message",{type:"error"})}}},setup(){const e=x(),s=T();return{route:e,toast:s}},watch:{getChatContext(e,s){this.getMessage()},getMessageId(e,s){this.getMessage()},getReplyId(e,s){this.getMessage()}}};function j(e,s,u,n,t,a){const i=M,y=f,m=g("ChatMessage"),h=g("ChatFeed"),C=N;return o(),c(b,null,[_("div",null,[r(y,null,{default:d(()=>[r(i,{name:"description",content:"Check out this chat post on "+e.$config.projectName+"!"},null,8,["content"]),r(i,{property:"og:image",content:e.$config.projectUrl+e.$config.previewImagePost},null,8,["content"]),r(i,{property:"og:description",content:"Check out this chat post on "+e.$config.projectName+"!"},null,8,["content"]),r(i,{name:"twitter:image",content:e.$config.projectUrl+e.$config.previewImagePost},null,8,["content"]),r(i,{name:"twitter:description",content:"Check out this chat post on "+e.$config.projectName+"!"},null,8,["content"])]),_:1})]),(o(),c("div",{key:t.message?.url},[t.message?(o(),l(m,{key:0,message:t.message,chatContext:a.getChatContext},null,8,["message","chatContext"])):p("",!0),t.reply?(o(),l(m,{key:1,message:t.reply,mainItemId:a.getMessageId,chatContext:a.getChatContext},null,8,["message","mainItemId","chatContext"])):p("",!0),a.isReply?p("",!0):(o(),l(h,{key:2,chatContext:a.getChatContext,mainItemId:a.getMessageId},null,8,["chatContext","mainItemId"])),a.isReply?(o(),l(C,{key:3,to:a.mainMessagePage,class:"btn btn-primary"},{default:d(()=>[k("See other replies")]),_:1},8,["to"])):p("",!0)]))],64)}const Q=I(V,[["render",j]]);export{Q as default};
