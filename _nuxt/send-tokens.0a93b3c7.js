import{H as N,T as R,M as E}from"./components.9223a110.js";import{t as M}from"./tokens.f7a97a02.js";import{a as I,$ as U,I as L,C as k,A as y,Q as w,l as W,x as V,o as c,b as l,f as n,m as u,y as f,z as T,i as b,t as d,F as S,G as F,c as B,r as g,e as p,w as x}from"./entry.ec541abc.js";import{a as H,E as C}from"./balanceUtils.2fca1795.js";import{h as v}from"./textUtils.bf1f1837.js";import{W as A}from"./WaitingToast.caad0369.js";import{C as j}from"./ConnectWalletButton.4a301f84.js";import{S as D}from"./SwitchChainButton.e792a2e3.js";import"./composables.faaa4453.js";const P={name:"SendTokensComponent",props:["recipient","tokens"],data(){return{filterTextInput:"",hasBlankCharacter:!1,inputReceiver:null,inputToken:null,inputTokenAmount:null,inputTokenBalance:null,recipientAddress:null,tokenList:[],waiting:!1}},components:{ConnectWalletButton:j,SwitchChainButton:D},mounted(){this.inputReceiver=this.recipient,this.processRecipient(this.recipient),this.findBlankCharacter(),this.tokenList=this.tokens.tokens,this.selectInputToken(this.tokenList[0])},computed:{filteredTokensInput(){const e=new RegExp(this.filterTextInput,"i");return this.tokenList.filter(t=>e.test(t.symbol))},formatInputTokenBalance(){return this.inputTokenBalance?this.inputTokenBalance==0?0:this.inputTokenBalance>100?Number(this.inputTokenBalance).toFixed(2):Number(this.inputTokenBalance).toFixed(4):0},inputAmountLessThanBalance(){return this.inputTokenAmount&&this.inputTokenBalance?Number(this.inputTokenAmount)<=Number(this.inputTokenBalance):!1},isSupportedNetwork(){return this.chainId==this.$config.supportedChainId}},methods:{getTokenBalance:H,hasTextBlankCharacters:v,findBlankCharacter(){this.hasBlankCharacter=!1,this.hasBlankCharacter=v(this.inputReceiver)},async processRecipient(e){if(e)if(U(e))this.recipientAddress=e;else{const t=String(e).trim().toLowerCase().replace(this.$config.tldName,"");let i=this.$getFallbackProvider(this.$config.supportedChainId);this.isActivated&&this.chainId===this.$config.supportedChainId&&(i=this.signer);const r=new L(["function getDomainHolder(string) view returns (address)"]),s=new k(this.$config.punkTldAddress,r,i);this.recipientAddress=await s.getDomainHolder(t)}},async selectInputToken(e){this.inputToken=e,this.inputTokenAmount=null,this.signer&&(this.inputTokenBalance=await this.getTokenBalance(e,this.address,this.signer))},async send(){if(this.inputReceiver.includes(".")&&!this.inputReceiver.endsWith(this.$config.tldName))return this.toast.error("Invalid domain name. Only "+this.$config.tldName+" domains are supported.");if(this.waiting=!0,await this.processRecipient(this.inputReceiver),this.recipientAddress==y)return this.waiting=!1,this.toast.error("This domain name does not exist");this.inputToken.address==y?this.sendNativeCoin():this.sendErc20Tokens()},async sendErc20Tokens(){const e=new k(this.inputToken.address,C,this.signer);try{const t=await e.transfer(this.recipientAddress,w(this.inputTokenAmount,this.inputToken.decimals)),i=this.toast({component:A,props:{text:"Please wait for your transaction to confirm. Click on this notification to see transaction in the block explorer."}},{type:"info",onClick:()=>window.open(this.$config.blockExplorerBaseUrl+"/tx/"+t.hash,"_blank").focus()}),r=await t.wait();r.status===1?(this.toast.dismiss(i),this.toast("You have successfully sent "+String(this.inputTokenAmount)+" "+this.inputToken.symbol+" to "+this.inputReceiver,{type:"success",onClick:()=>window.open(this.$config.blockExplorerBaseUrl+"/tx/"+t.hash,"_blank").focus()}),this.subtractInputTokenBalance(),this.waiting=!1):(this.toast.dismiss(i),this.waiting=!1,this.toast("Transaction has failed.",{type:"error",onClick:()=>window.open(this.$config.blockExplorerBaseUrl+"/tx/"+t.hash,"_blank").focus()}),console.log(r))}catch(t){console.error(t);try{let i=t.message.split("reason=")[1];i=i.split(", method=")[0],i=i.replace(/"/g,""),i=i.replace("execution reverted:","Error:"),console.log(i),this.toast(i,{type:"error"})}catch{this.toast("Transaction has failed.",{type:"error"})}this.waiting=!1}},async sendNativeCoin(){new k(this.inputToken.address,C,this.signer);try{const e=await this.signer.sendTransaction({to:this.recipientAddress,value:w(this.inputTokenAmount,this.inputToken.decimals)}),t=this.toast({component:A,props:{text:"Please wait for your transaction to confirm. Click on this notification to see transaction in the block explorer."}},{type:"info",onClick:()=>window.open(this.$config.blockExplorerBaseUrl+"/tx/"+e.hash,"_blank").focus()}),i=await e.wait();i.status===1?(this.toast.dismiss(t),this.toast("You have successfully sent "+String(this.inputTokenAmount)+" "+this.inputToken.symbol+" to "+this.inputReceiver,{type:"success",onClick:()=>window.open(this.$config.blockExplorerBaseUrl+"/tx/"+e.hash,"_blank").focus()}),this.subtractInputTokenBalance(),this.waiting=!1):(this.toast.dismiss(t),this.waiting=!1,this.toast("Transaction has failed.",{type:"error",onClick:()=>window.open(this.$config.blockExplorerBaseUrl+"/tx/"+e.hash,"_blank").focus()}),console.log(i))}catch(e){console.error(e);try{let t=e.message.split("reason=")[1];t=t.split(", method=")[0],t=t.replace(/"/g,""),t=t.replace("execution reverted:","Error:"),console.log(t),this.toast(t,{type:"error"})}catch{this.toast("Transaction has failed.",{type:"error"})}this.waiting=!1}},setMaxInputTokenAmount(){this.inputTokenAmount=String(this.inputTokenBalance)},subtractInputTokenBalance(){this.inputTokenBalance=Number(this.inputTokenBalance)-Number(this.inputTokenAmount)}},setup(){const{address:e,chainId:t,isActivated:i,signer:r}=W(),s=V();return{address:e,chainId:t,isActivated:i,signer:r,toast:s}},watch:{async isActivated(){this.address&&(this.inputTokenBalance=await this.getTokenBalance(this.inputToken,this.address,this.signer))}}},Q={class:"mb-3"},q={class:"input-group"},Y={key:0,class:"input-group-text",id:"basic-addon3"},z=n("i",{class:"bi bi-exclamation-triangle-fill"},null,-1),G=[z],K={key:0,class:"form-text",id:"basic-addon4"},O=n("i",{class:"bi bi-exclamation-triangle-fill"},null,-1),X={class:"input-group mb-1 mt-3"},Z={class:"btn btn-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},J={class:"dropdown-menu p-2"},$=["onClick"],tt=n("small",null,"MAX",-1),et=[tt],nt=n("em",null,"Balance: ",-1),st={class:"cursor-pointer hover-color"},it={class:"d-flex justify-content-center mt-4"},ot={key:1,disabled:!0,class:"btn btn-outline-primary",type:"button"},at=["disabled"],rt={key:0,class:"spinner-border spinner-border-sm mx-1",role:"status","aria-hidden":"true"},ct={key:3,disabled:!0,class:"btn btn-outline-primary",type:"button"};function lt(e,t,i,r,s,o){const h=g("ConnectWalletButton"),m=g("SwitchChainButton");return c(),l("div",null,[n("div",Q,[n("div",q,[s.hasBlankCharacter?(c(),l("span",Y,G)):u("",!0),f(n("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>s.inputReceiver=a),type:"text",class:"form-control",id:"basic-url","aria-describedby":"basic-addon3 basic-addon4",placeholder:"Enter recipient's domain name or address",onKeyup:t[1]||(t[1]=(...a)=>o.findBlankCharacter&&o.findBlankCharacter(...a))},null,544),[[T,s.inputReceiver]])]),s.hasBlankCharacter?(c(),l("div",K,[O,b(" This domain name contains a blank character: "+d(encodeURIComponent(s.inputReceiver))+". Proceed with caution. ",1)])):u("",!0)]),n("div",X,[n("button",Z,d(s.inputToken?.symbol),1),n("ul",J,[f(n("input",{class:"form-control mb-2",placeholder:"Filter tokens","onUpdate:modelValue":t[2]||(t[2]=a=>s.filterTextInput=a)},null,512),[[T,s.filterTextInput]]),(c(!0),l(S,null,F(o.filteredTokensInput,a=>(c(),l("li",{key:a.address,class:"cursor-pointer"},[n("span",{onClick:_=>o.selectInputToken(a),class:"dropdown-item"},d(a.symbol)+" ("+d(a.name)+")",9,$)]))),128))]),f(n("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>s.inputTokenAmount=a),type:"text",class:"form-control",placeholder:"0.00"},null,512),[[T,s.inputTokenAmount]]),n("button",{onClick:t[4]||(t[4]=(...a)=>o.setMaxInputTokenAmount&&o.setMaxInputTokenAmount(...a)),class:"btn btn-outline-secondary",type:"button",id:"button-addon2"},et)]),n("small",{onClick:t[5]||(t[5]=(...a)=>o.setMaxInputTokenAmount&&o.setMaxInputTokenAmount(...a))},[nt,n("em",st,d(o.formatInputTokenBalance)+" "+d(s.inputToken?.symbol),1)]),n("div",it,[r.isActivated?u("",!0):(c(),B(h,{key:0,class:"btn btn-outline-primary",btnText:"Connect wallet"})),r.isActivated&&!s.inputTokenAmount&&o.isSupportedNetwork?(c(),l("button",ot," Send tokens ")):u("",!0),r.isActivated&&s.inputTokenAmount&&o.inputAmountLessThanBalance&&o.isSupportedNetwork?(c(),l("button",{key:2,disabled:s.waiting||!s.inputToken||!s.inputTokenAmount||!r.isActivated||!o.inputAmountLessThanBalance||!s.inputReceiver||!o.isSupportedNetwork,class:"btn btn-outline-primary",type:"button",onClick:t[6]||(t[6]=(...a)=>o.send&&o.send(...a))},[s.waiting?(c(),l("span",rt)):u("",!0),b(" Send tokens ")],8,at)):u("",!0),r.isActivated&&s.inputTokenAmount&&!o.inputAmountLessThanBalance&&o.isSupportedNetwork?(c(),l("button",ct," Balance too low ")):u("",!0),r.isActivated&&!e.isSupportedChain?(c(),B(m,{key:4})):u("",!0)])])}const ut=I(P,[["render",lt]]),dt={name:"SendTokens",components:{SendTokensComponent:ut},computed:{getQueryRecipient(){return this.$route.query.to?this.$route.query.to:null}},setup(){return{tokens:M}}},pt={class:"scroll-500"},ht={class:"card border"},mt={class:"card-body mb-3"},kt={class:"fs-3"},ft=n("h3",{class:"mt-3"},"Send tokens",-1),Tt={class:"d-flex justify-content-center mt-5"},bt={class:"col-12 col-lg-8"};function gt(e,t,i,r,s,o){const h=R,m=E,a=N,_=g("SendTokensComponent");return c(),l(S,null,[p(a,null,{default:x(()=>[p(h,null,{default:x(()=>[b("Send tokens | "+d(e.$config.projectMetadataTitle),1)]),_:1}),p(m,{property:"og:title",content:"Send tokens | "+e.$config.projectMetadataTitle},null,8,["content"])]),_:1}),n("div",pt,[n("div",ht,[n("div",mt,[n("p",kt,[n("i",{class:"bi bi-arrow-left-circle cursor-pointer",onClick:t[0]||(t[0]=_t=>e.$router.back())})]),ft,n("div",Tt,[n("div",bt,[p(_,{tokens:r.tokens,recipient:o.getQueryRecipient},null,8,["tokens","recipient"])])])])])])],64)}const Nt=I(dt,[["render",gt]]);export{Nt as default};
