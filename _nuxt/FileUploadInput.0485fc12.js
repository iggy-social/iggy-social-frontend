import{a as O}from"./Image.c2f1e3a9.js";import{a as x,o as I,b as v,f as N,l as A,i as D,ah as F,t as L,F as K}from"./entry.78874e04.js";function p(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?p=function(t){return typeof t}:p=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(r)}function z(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function E(r,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,i.key,i)}}function C(r,t,e){return t&&E(r.prototype,t),e&&E(r,e),r}function R(r,t,e){return t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}function _(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),e.push.apply(e,i)}return e}function d(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?_(Object(e),!0).forEach(function(i){R(r,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):_(Object(e)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(e,i))})}return r}var k="2.0.0",l={MANDATORY_INITIALIZATION_MISSING:{message:"Missing urlEndpoint during SDK initialization",help:""},INVALID_TRANSFORMATION_POSITION:{message:"Invalid transformationPosition parameter",help:""},PRIVATE_KEY_CLIENT_SIDE:{message:"privateKey should not be passed on the client side",help:""},MISSING_UPLOAD_DATA:{message:"Missing data for upload",help:""},MISSING_UPLOAD_FILE_PARAMETER:{message:"Missing file parameter for upload",help:""},MISSING_UPLOAD_FILENAME_PARAMETER:{message:"Missing fileName parameter for upload",help:""},MISSING_AUTHENTICATION_ENDPOINT:{message:"Missing authentication endpoint for upload",help:""},MISSING_PUBLIC_KEY:{message:"Missing public key for upload",help:""},AUTH_ENDPOINT_TIMEOUT:{message:"The authenticationEndpoint you provided timed out in 60 seconds",help:""},AUTH_ENDPOINT_NETWORK_ERROR:{message:"Request to authenticationEndpoint failed due to network error",help:""},AUTH_INVALID_RESPONSE:{message:"Invalid response from authenticationEndpoint. The SDK expects a JSON response with three fields i.e. signature, token and expire.",help:""},UPLOAD_ENDPOINT_NETWORK_ERROR:{message:"Request to ImageKit upload endpoint failed due to network error",help:""},INVALID_UPLOAD_OPTIONS:{message:"Invalid uploadOptions parameter",help:""},MISSING_SIGNATURE:{message:"Missing signature for upload. The SDK expects token, sginature and expire for authentication.",help:""},MISSING_TOKEN:{message:"Missing token for upload. The SDK expects token, sginature and expire for authentication.",help:""},MISSING_EXPIRE:{message:"Missing expire for upload. The SDK expects token, sginature and expire for authentication.",help:""}};function f(r,t,e){typeof e=="function"&&(r?e(t,null):e(null,t))}function G(r){var t={},e=r.getAllResponseHeaders();return Object.keys(e).length&&e.trim().split(/[\r\n]+/).map(function(i){return i.split(/: /)}).forEach(function(i){t[i[0].trim()]=i[1].trim()}),t}var w=function(t,e){var i=d({},t),a={statusCode:e.status,headers:G(e)};return Object.defineProperty(i,"$ResponseMetadata",{value:a,enumerable:!1,writable:!1}),i},B=function(t,e,i){j(t,e).then(function(a){return f(!1,a,i)},function(a){return f(!0,a,i)})},j=function(t,e){return new Promise(function(i,a){t.open("POST","https://upload.imagekit.io/api/v1/files/upload"),t.onerror=function(n){return a(l.UPLOAD_ENDPOINT_NETWORK_ERROR)},t.onload=function(){if(t.status===200)try{var n=JSON.parse(t.responseText),o=w(n,t);return i(o)}catch(c){return a(c)}else try{var n=JSON.parse(t.responseText),s=w(n,t);return a(s)}catch(c){return a(c)}},t.send(e)})},V=function(t,e,i,a){if(!e.file){f(!0,l.MISSING_UPLOAD_FILE_PARAMETER,a);return}if(!e.fileName){f(!0,l.MISSING_UPLOAD_FILENAME_PARAMETER,a);return}if(!i.publicKey){f(!0,l.MISSING_PUBLIC_KEY,a);return}if(!e.token){f(!0,l.MISSING_TOKEN,a);return}if(!e.signature){f(!0,l.MISSING_SIGNATURE,a);return}if(!e.expire){f(!0,l.MISSING_EXPIRE,a);return}var n=new FormData,o;for(o in e)o&&(o==="file"&&typeof e.file!="string"?n.append("file",e.file,String(e.fileName)):o==="tags"&&Array.isArray(e.tags)?n.append("tags",e.tags.join(",")):o==="signature"?n.append("signature",e.signature):o==="expire"?n.append("expire",String(e.expire)):o==="token"?n.append("token",e.token):o==="responseFields"&&Array.isArray(e.responseFields)?n.append("responseFields",e.responseFields.join(",")):o==="extensions"&&Array.isArray(e.extensions)?n.append("extensions",JSON.stringify(e.extensions)):o==="customMetadata"&&p(e.customMetadata)==="object"&&!Array.isArray(e.customMetadata)&&e.customMetadata!==null?n.append("customMetadata",JSON.stringify(e.customMetadata)):e[o]!==void 0&&n.append(o,String(e[o])));n.append("publicKey",i.publicKey),B(t,n,a)},P={width:"w",height:"h",aspectRatio:"ar",quality:"q",crop:"c",cropMode:"cm",focus:"fo",x:"x",y:"y",format:"f",radius:"r",background:"bg",border:"b",rotation:"rt",rotate:"rt",blur:"bl",named:"n",overlayImage:"oi",overlayImageAspectRatio:"oiar",overlayImageBackground:"oibg",overlayImageBorder:"oib",overlayImageDPR:"oidpr",overlayImageQuality:"oiq",overlayImageCropping:"oic",overlayImageTrim:"oit",overlayX:"ox",overlayY:"oy",overlayFocus:"ofo",overlayHeight:"oh",overlayWidth:"ow",overlayText:"ot",overlayTextFontSize:"ots",overlayTextFontFamily:"otf",overlayTextColor:"otc",overlayTextTransparency:"oa",overlayAlpha:"oa",overlayTextTypography:"ott",overlayBackground:"obg",overlayTextEncoded:"ote",overlayTextWidth:"otw",overlayTextBackground:"otbg",overlayTextPadding:"otp",overlayTextInnerAlignment:"otia",overlayRadius:"or",progressive:"pr",lossless:"lo",trim:"t",metadata:"md",colorProfile:"cp",defaultImage:"di",dpr:"dpr",effectSharpen:"e-sharpen",effectUSM:"e-usm",effectContrast:"e-contrast",effectGray:"e-grayscale",original:"orig",raw:"raw"},M="path",U="query",q=[M,U],W=":",Y=",",J="-",u={getDefault:function(){return M},addAsQueryParameter:function(t){return t.transformationPosition===U},validParameters:function(t){return typeof t.transformationPosition>"u"?!1:q.indexOf(t.transformationPosition)!=-1},getTransformKey:function(t){return t&&(P[t]||P[t.toLowerCase()])||""},getChainTransformDelimiter:function(){return W},getTransformDelimiter:function(){return Y},getTransformKeyValueDelimiter:function(){return J}},b="tr";function $(r){return typeof r=="string"&&r[r.length-1]=="/"&&(r=r.substring(0,r.length-1)),r}function H(r){return typeof r=="string"&&r[0]=="/"&&(r=r.slice(1)),r}function h(r,t){var e=t||"/",i=new RegExp(e+"{1,}","g");return r.join(e).replace(i,e)}var Q=function(t){if(!t.path&&!t.src)return"";var e,i,a;try{t.path?(a=new URL(t.urlEndpoint).pathname,e=new URL(h([t.urlEndpoint.replace(a,""),t.path]))):(e=new URL(t.src),i=!0)}catch(s){return console.error(s),""}for(var n in t.queryParameters)e.searchParams.append(n,String(t.queryParameters[n]));var o=Z(t.transformation);return o&&o.length&&(u.addAsQueryParameter(t)||i?e.searchParams.append(b,o):e.pathname=h([b+u.getChainTransformDelimiter()+o,e.pathname])),a?e.pathname=h([a,e.pathname]):e.pathname=h([e.pathname]),e.href};function Z(r){if(!Array.isArray(r))return"";for(var t=[],e=0,i=r.length;e<i;e++){var a=[];for(var n in r[e]){var o=u.getTransformKey(n);if(o||(o=n),r[e][n]==="-")a.push(o);else if(n==="raw")a.push(r[e][n]);else{var s=r[e][n];(o==="oi"||o==="di")&&(s=$(H(s||"")),s=s.replace(/\//g,"@@")),a.push([o,s].join(u.getTransformKeyValueDelimiter()))}}t.push(a.join(u.getTransformDelimiter()))}return t.join(u.getChainTransformDelimiter())}var X=function(t,e){return Q(d(d({},e),t))};function ee(r){return r.urlEndpoint}var te=function(t,e){return function(){for(var i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];if(a.length===e.length&&typeof a[a.length-1]<"u"){if(typeof a[a.length-1]!="function")throw new Error("Callback must be a function.");e.call.apply(e,[t].concat(a))}else return new Promise(function(o,s){var c=function(S){if(S)return s(S);for(var y=arguments.length,m=new Array(y>1?y-1:0),g=1;g<y;g++)m[g-1]=arguments[g];o(m.length>1?m:m[0])};a.pop(),a.push(c),e.call.apply(e,[t].concat(a))})}},re=function(){function r(t){if(z(this,r),R(this,"options",{sdkVersion:"javascript-".concat(k),publicKey:"",urlEndpoint:"",transformationPosition:u.getDefault()}),this.options=d(d({},this.options),t||{}),!ee(this.options))throw l.MANDATORY_INITIALIZATION_MISSING;if(!u.validParameters(this.options))throw l.INVALID_TRANSFORMATION_POSITION}return C(r,[{key:"url",value:function(e){return X(e,this.options)}},{key:"upload",value:function(e,i,a){var n;if(typeof i=="function"?n=i:a=i||{},!e||p(e)!=="object")return f(!0,l.INVALID_UPLOAD_OPTIONS,n);var o=d(d({},this.options),a),s=e||{},c=s.xhr;delete e.xhr;var T=c||new XMLHttpRequest;return te(this,V)(T,e,o,n)}}]),r}();const ie={name:"FileUploadInput",props:["btnCls","disable","maxFileSize","storageType"],emits:["processUploadedFileUrl"],data(){return{componentId:null,file:null,newFileName:null,uploadedFileSize:null,uploadToken:null,waitingUpload:!1}},mounted(){this.componentId=this.$.uid},computed:{fileTooBig(){if(this.uploadedFileSize)return this.maxFileSize&&this.uploadedFileSize>this.maxFileSize}},methods:{async arweaveUpload(){const r=window.location.origin;let t;this.$config.fileUploadTokenService==="netlify"?t=r+"/.netlify/functions/arweaveUploader":this.$config.fileUploadTokenService==="vercel"&&(t=r+"/api/arweaveUploader");const e=await this.fileToBase64(this.file),i=this.file.type;let o=`ar://${(await O.post(t,{fileData:e,fileName:this.file.name,fileType:this.file.type})).data.transactionId}`;i.startsWith("image/")?o+="?img":i.startsWith("video/")||i.startsWith("audio/")?o+=`?${i}`:i.startsWith("text/plain")&&(o+="?txt"),this.$emit("processUploadedFileUrl",o)},async imageKitUpload(){const r=window.location.origin;let t;this.$config.fileUploadTokenService==="netlify"?t=r+"/.netlify/functions/imageKitUploader":this.$config.fileUploadTokenService==="vercel"&&(t=r+"/api/imageKitUploader");const e=await $fetch(t).catch(o=>o.data);let i=e;typeof e=="string"&&(i=JSON.parse(e));const n=await new re({publicKey:this.$config.imagekitPublicKey,urlEndpoint:this.$config.imagekitEndpoint}).upload({file:this.file,fileName:this.newFileName,tags:[this.$config.projectName,this.$config.projectUrl],token:i.data.token,signature:i.data.signature,expire:i.data.expire});this.$emit("processUploadedFileUrl",n.url),this.waitingUpload=!1},handleFileInput(r){const t=r.target.files[0];if(this.uploadedFileSize=t.size,this.maxFileSize&&t.size>this.maxFileSize){const n=this.maxFileSize/1024/1024;console.error("File is too large (max size is "+n+" MB)");return}const i=t.name.split(".").pop();this.newFileName=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+"."+i;const a=new File([t],this.newFileName,{type:t.type});this.file=a},async uploadFile(){if(this.waitingUpload=!0,this.storageType==="arweave")try{await this.arweaveUpload()}catch(r){console.error("Error uploading file to decentralized storage service",r),console.log("Falling back to centralized storage service"),await this.imageKitUpload()}else try{await this.imageKitUpload()}catch(r){console.error("Error uploading file to centralized storage service",r),console.log("Falling back to decentralized storage service"),await this.arweaveUpload()}this.waitingUpload=!1},fileToBase64(r){return new Promise((t,e)=>{const i=new FileReader;i.readAsDataURL(r),i.onload=()=>t(i.result.split(",")[1]),i.onerror=a=>e(a)})}}},ae=["id","disabled"],ne=["disabled"],oe={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},se={key:0,class:"alert alert-danger mt-3",role:"alert"};function le(r,t,e,i,a,n){return I(),v(K,null,[N("input",{onChange:t[0]||(t[0]=(...o)=>n.handleFileInput&&n.handleFileInput(...o)),type:"file",class:"form-control form-control-lg mb-3",id:"file-input-"+a.componentId,disabled:a.waitingUpload||e.disable},null,40,ae),N("button",{type:"button",class:F(e.btnCls),onClick:t[1]||(t[1]=(...o)=>n.uploadFile&&n.uploadFile(...o)),disabled:a.waitingUpload||!a.file||n.fileTooBig||e.disable},[a.waitingUpload?(I(),v("span",oe)):A("",!0),D(" Upload ")],10,ne),n.fileTooBig?(I(),v("div",se," File is too big (max size is "+L(e.maxFileSize/1024/1024)+" MB). ",1)):A("",!0)],64)}const ce=x(ie,[["render",le]]);export{ce as F};
