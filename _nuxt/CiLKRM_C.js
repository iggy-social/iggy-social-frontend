import{_ as v,S as L,I as E,x as S,y as N,A as W,i as B,j as P,l as F,W as M,m as $,r as g,c as d,o as a,a as i,G as A,g as r,b as m,t as c,p as x,f as b,v as j,d as p,P as V,z,J as H,B as O,K as q,L as C,N as J,O as R,Q as I,R as G,U as D,s as _,n as K,D as Q,q as w,V as U,w as T,e as Y,T as X,M as Z,H as ee,F as te}from"#entry";import{I as ie}from"./BRYG_3z3.js";import{F as se}from"./Cq9uDqBZ.js";const ne={name:"ChangePfpModal",props:["componentId","domainName","storageType"],emits:["processFileUrl"],components:{ConnectWalletButton:E,FileUploadInput:se,Image:ie,SwitchChainButton:L},data(){return{currentTab:"upload",imageLink:null,waitingSubmit:!1}},mounted(){this.fileUploadEnabled||(this.currentTab="paste")},computed:{domainNameWithoutTld(){return this.domainName.replace(this.$config.public.tldName,"")},fileUploadEnabled(){return this.$config.public.fileUploadEnabled},isSupportedChain(){return this.chainId===this.$config.public.supportedChainId}},methods:{handleCloseClick(){const e=document.getElementById("closeChangeImageModal"+this.componentId);e&&e.blur()},processUploadedFileUrl(e){this.imageLink=e,this.currentTab="paste"},async submitToBlockchain(){this.waitingSubmit=!0;let e;try{const t=await P({address:this.$config.public.punkTldAddress,abi:[{inputs:[{name:"_domainName",type:"string"}],name:"getDomainData",outputs:[{name:"",type:"string"}],stateMutability:"view",type:"function"}],functionName:"getDomainData",args:[String(this.domainNameWithoutTld).toLowerCase()]});let n={};if(t)try{n=JSON.parse(t)}catch(o){console.warn("Failed to parse domain data as JSON, using empty object:",o),n={}}else console.log("No existing domain data found, creating new domain data for:",this.domainNameWithoutTld);n.image=this.imageLink;const l=await F({address:this.$config.public.punkTldAddress,abi:[{inputs:[{name:"_domainName",type:"string"},{name:"_data",type:"string"}],name:"editData",outputs:[],stateMutability:"nonpayable",type:"function"}],functionName:"editData",args:[String(this.domainNameWithoutTld).toLowerCase(),JSON.stringify(n)]});e=this.toast({component:M,props:{text:"Please wait for your transaction to confirm. Click on this notification to see transaction in the block explorer."}},{type:"info",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+l,"_blank").focus()});const s=await $(l);s.status==="success"?(this.waitingSubmit=!1,this.toast.dismiss(e),this.toast("You have successfully changed your profile image!",{type:"success",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+l,"_blank").focus()}),this.$emit("processFileUrl",this.imageLink),document.getElementById("closeChangeImageModal"+this.componentId).click()):(this.waitingSubmit=!1,this.toast.dismiss(e),this.toast("Transaction has failed.",{type:"error",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+l,"_blank").focus()}),console.log(s))}catch(t){console.error(t);try{let n=t.message.split("Details:")[1];n=n.split("Version: viem")[0],n=n.replace(/"/g,""),n=n.replace("execution reverted:","Error:"),console.log(n),this.toast(n,{type:"error"})}catch{this.toast("Transaction has failed.",{type:"error"})}this.waitingSubmit=!1}finally{this.toast.dismiss(e),this.waitingSubmit=!1}this.waitingSubmit=!1}},setup(){const e=S(),{isConnected:t,chainId:n}=N({config:e}),{fileUploadEnabled:l}=W(),s=B();return{fileUploadEnabled:l,isConnected:t,chainId:n,toast:s}},watch:{fileUploadEnabled(){this.fileUploadEnabled?this.currentTab="upload":this.currentTab="paste"},imageLink(e,t){t&&(this.currentTab="paste")}}},oe=["id","aria-labelledby"],ae={class:"modal-dialog"},le={class:"modal-content"},re={class:"modal-header"},de=["id"],ce=["id"],ue={class:"modal-body mb-4"},me={class:"nav nav-tabs nav-fill"},pe={class:"nav-item"},he=["disabled"],ge={class:"nav-item"},be={class:"tab-content mt-3"},fe={key:0},ke={key:1},ye={key:0,class:"mb-3"},we=["disabled"],Ce={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function _e(e,t,n,l,s,o){const f=g("FileUploadInput"),u=g("Image"),k=g("ConnectWalletButton"),y=g("SwitchChainButton");return a(),d("div",{class:"modal fade",id:"changeImageModal"+n.componentId,"aria-labelledby":"changeImageModalLabel"+n.componentId},[i("div",ae,[i("div",le,[i("div",re,[i("h1",{class:"modal-title fs-5",id:"changeImageModalLabel"+n.componentId},"Change your profile picture",8,de),i("button",{id:"closeChangeImageModal"+n.componentId,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:t[0]||(t[0]=(...h)=>o.handleCloseClick&&o.handleCloseClick(...h))},null,8,ce)]),i("div",ue,[i("ul",me,[i("li",pe,[i("button",{disabled:!l.fileUploadEnabled,class:A(["nav-link",s.currentTab==="upload"?"active":""]),onClick:t[1]||(t[1]=h=>s.currentTab="upload")}," Upload ",10,he)]),i("li",ge,[i("button",{class:A(["nav-link",s.currentTab==="paste"?"active":""]),onClick:t[2]||(t[2]=h=>s.currentTab="paste")}," Paste Link ",2)])]),i("div",be,[s.currentTab==="upload"?(a(),d("div",fe,[i("p",null,"Upload your new profile image "+c(n.domainName)+".",1),m(f,{btnCls:"btn btn-primary",maxFileSize:e.$config.public.fileUploadSizeLimit,storageType:n.storageType,onProcessUploadedFileUrl:o.processUploadedFileUrl},null,8,["maxFileSize","storageType","onProcessUploadedFileUrl"])])):r("",!0),s.currentTab==="paste"?(a(),d("div",ke,[t[7]||(t[7]=i("p",null,"Submit the image link to blockchain",-1)),x(i("input",{"onUpdate:modelValue":t[3]||(t[3]=h=>s.imageLink=h),type:"text",class:"form-control mb-3",placeholder:"Enter http link to file"},null,512),[[j,s.imageLink]]),s.imageLink?(a(),d("div",ye,[m(u,{url:s.imageLink,cls:"img-thumbnail img-fluid",style:{"max-width":"100px"}},null,8,["url"]),t[5]||(t[5]=i("small",null,"If image didn't appear above, then something is wrong with the link you added (wait until the loading indicator completes).",-1))])):r("",!0),l.isConnected&&o.isSupportedChain?(a(),d("button",{key:1,class:"btn btn-primary",onClick:t[4]||(t[4]=(...h)=>o.submitToBlockchain&&o.submitToBlockchain(...h)),disabled:!s.imageLink||s.waitingSubmit},[s.waitingSubmit?(a(),d("span",Ce)):r("",!0),t[6]||(t[6]=p(" Submit to blockchain ",-1))],8,we)):r("",!0),l.isConnected?r("",!0):(a(),b(k,{key:2,class:"btn-outline-primary mt-2 mb-2",btnText:"Connect Wallet"})),l.isConnected&&!o.isSupportedChain?(a(),b(y,{key:3})):r("",!0)])):r("",!0)])])])])],8,oe)}const Te=v(ne,[["render",_e]]),ve={name:"PunkProfile",props:["pAddress","pDomain"],data(){return{balanceAp:0,balanceChatTokenWei:BigInt(0),domain:this.pDomain,newEmail:null,newImageLink:null,uAddress:this.pAddress,uBalance:BigInt(0),waitingDataLoad:!1,waitingImageUpdate:!1}},components:{ChangePfpModal:Te,ProfileImage:V},mounted(){(!this.pAddress||!this.pDomain)&&this.fetchAddressAndDomain()},computed:{balanceChatToken(){return _(Q(this.balanceChatTokenWei,18))},balanceEth(){return _(K(this.uBalance))},isCurrentUser(){return String(this.uAddress).toLowerCase()===String(this.address).toLowerCase()},domainWithoutExtension(){return this.domain?String(this.domain).replace(this.$config.public.tldName,""):null},shortAddress(){return this.address?D(this.address):""}},methods:{changeCurrentTab(e){this.currentTab=e,localStorage.setItem("profileCurrentTab",e)},async fetchAddressAndDomain(){if(this.waitingDataLoad=!0,(this._.provides[C]||this.$route).query.id){const e=(this._.provides[C]||this.$route).query.id;e.includes(".")?this.domain=e:this.uAddress=e}else this.uAddress=this.address;if(!this.domain&&this.uAddress&&(this.domain=J(window,this.uAddress)),!this.domain&&this.uAddress){const e=await R(this.uAddress,window);if(e){const t=e.split(".")[0]+this.$config.public.tldName;this.domain=t,I(window,this.uAddress,this.domain)}}if(this.domain&&!this.uAddress){const e=await G(String(this.domain).toLowerCase().split(".")[0]);e&&e!=="0x0000000000000000000000000000000000000000"&&(this.uAddress=e),this.domain=String(this.domain).split(".")[0]+this.$config.public.tldName,I(window,this.uAddress,this.domain)}await this.fetchBalance()},async fetchBalance(){if(this.uAddress){if(this.uBalance=await O(this.uAddress),this.$config.public.chatTokenAddress){const e={address:this.$config.public.chatTokenAddress,abi:[{constant:!0,inputs:[{name:"owner",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"}],functionName:"balanceOf",args:[this.uAddress]},t=await P(e);t&&(this.balanceChatTokenWei=t)}this.$config.public.activityPointsAddress&&this.$config.public.showFeatures.activityPoints&&(this.balanceAp=await q(this.uAddress))}},async insertImage(e){this.newImageLink=e,e&&H(window,this.domainWithoutExtension,{image:e},"img")}},setup(){const e=S(),{address:t}=N({config:e}),{domainName:n}=z(),l=B();return{address:t,domainName:n,toast:l}},watch:{address(){this.fetchAddressAndDomain()}}},Ae={class:"card border"},Ie={class:"card-body"},Ue={class:"fs-3"},Se={class:"row"},Ne={class:"col-md-3 mt-3"},Be={class:"col-md-9 mt-3"},Pe={key:0,class:"mb-3"},De={key:1,class:"mb-3"},Le={key:2,class:"mb-3"},Ee={class:"mt-4 muted-text",style:{"font-size":"14px"}},We={class:"me-4"},Fe={key:0,class:"me-4"},Me={key:1,class:"me-4"},$e={class:"me-4"},xe=["href"],je={key:3,class:"mt-2"},Ve={class:"dropdown mt-2"},ze={class:"dropdown-menu"},He=["data-bs-target"];function Oe(e,t,n,l,s,o){const f=g("ProfileImage"),u=Y,k=g("ChangePfpModal");return a(),d("div",null,[i("div",Ae,[i("div",Ie,[i("p",Ue,[i("i",{class:"bi bi-arrow-left-circle cursor-pointer",onClick:t[0]||(t[0]=y=>e.$router.back())})]),i("div",Se,[i("div",Ne,[(a(),b(f,{key:s.domain,class:"img-fluid img-thumbnail rounded-circle force-circle col-6 col-md-12",domain:s.domain,image:s.newImageLink},null,8,["domain","image"]))]),i("div",Be,[s.domain&&!o.isCurrentUser?(a(),d("h3",Pe,c(("getTextWithoutBlankCharacters"in e?e.getTextWithoutBlankCharacters:w(U))(s.domain)),1)):r("",!0),s.domain&&o.isCurrentUser?(a(),d("h3",De,c(("getTextWithoutBlankCharacters"in e?e.getTextWithoutBlankCharacters:w(U))(l.domainName)),1)):r("",!0),!s.domain&&l.address?(a(),d("h3",Le,c(o.shortAddress),1)):r("",!0),i("div",Ee,[i("p",We,[t[1]||(t[1]=i("i",{class:"bi bi-wallet me-1"},null,-1)),p(" "+c(o.balanceEth)+" "+c(e.$config.public.tokenSymbol),1)]),e.$config.public.chatTokenAddress?(a(),d("p",Fe,[t[2]||(t[2]=i("i",{class:"bi bi-wallet me-1"},null,-1)),p(" "+c(o.balanceChatToken)+" "+c(e.$config.public.chatTokenSymbol),1)])):r("",!0),e.$config.public.activityPointsAddress&&e.$config.public.showFeatures.activityPoints?(a(),d("p",Me,[t[3]||(t[3]=i("i",{class:"bi bi-wallet me-1"},null,-1)),p(" "+c(("getLessDecimals"in e?e.getLessDecimals:w(_))(s.balanceAp))+" AP ",1)])):r("",!0),i("p",$e,[t[4]||(t[4]=i("i",{class:"bi bi-box-arrow-up-right me-2"},null,-1)),i("a",{href:e.$config.public.blockExplorerBaseUrl+"/address/"+s.uAddress,target:"_blank",class:"body-color hover-color",style:{"text-decoration":"none"}},c(("shortenAddress"in e?e.shortenAddress:w(D))(s.uAddress)),9,xe)])]),o.isCurrentUser?(a(),d("div",je,[i("div",Ve,[t[7]||(t[7]=i("button",{class:"btn btn-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[i("i",{class:"bi bi-sliders"}),p(" Profile settings ")],-1)),i("div",ze,[i("span",{class:"dropdown-item cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#changeImageModal"+e.$.uid},[...t[5]||(t[5]=[i("i",{class:"bi bi-person-circle"},null,-1),p(" Change your profile picture ",-1)])],8,He),t[6]||(t[6]=i("span",{class:"dropdown-item cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#changeUsernameModal"},[i("i",{class:"bi bi-pencil-square"}),p(" Change your username ")],-1))])])])):r("",!0),s.domain&&!o.isCurrentUser&&e.$config.public.showFeatures.sendTokens?(a(),b(u,{key:4,class:"btn btn-primary mt-2",to:"/send-tokens/?to="+s.domain},{default:T(()=>[...t[8]||(t[8]=[i("i",{class:"bi bi-send"},null,-1),p(" Send a tip ",-1)])]),_:1},8,["to"])):r("",!0)])])]),o.isCurrentUser?(a(),b(k,{key:s.domain,domainName:s.domain,componentId:e.$.uid,storageType:"arweave",onProcessFileUrl:o.insertImage},null,8,["domainName","componentId","onProcessFileUrl"])):r("",!0)])])}const qe=v(ve,[["render",Oe]]),Je={name:"Profile",components:{PunkProfile:qe}};function Re(e,t,n,l,s,o){const f=X,u=Z,k=ee,y=g("PunkProfile");return a(),d(te,null,[m(k,null,{default:T(()=>[m(f,null,{default:T(()=>[p("Profile | "+c(e.$config.public.projectMetadataTitle),1)]),_:1}),m(u,{name:"description",content:"Check out this profile on "+e.$config.public.projectName+"!"},null,8,["content"]),m(u,{property:"og:image",content:e.$config.public.projectUrl+e.$config.public.previewImageProfile},null,8,["content"]),m(u,{property:"og:description",content:"Check out this profile on "+e.$config.public.projectName+"!"},null,8,["content"]),m(u,{name:"twitter:image",content:e.$config.public.projectUrl+e.$config.public.previewImageProfile},null,8,["content"]),m(u,{name:"twitter:description",content:"Check out this profile on "+e.$config.public.projectName+"!"},null,8,["content"])]),_:1}),(a(),b(y,{key:(e._.provides[C]||e.$route).query.id,class:"mt-1"}))],64)}const Ye=v(Je,[["render",Re]]);export{Ye as default};
