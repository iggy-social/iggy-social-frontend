import{_ as A,aa as C,a7 as I,W as k,S as R,I as N,x as E,y as M,i as F,ab as L,m as w,E as U,l as V,a5 as D,Z as B,ac as W,j,r as T,c,o as l,a as s,g as u,p as f,v as b,d as g,t as p,F as S,$ as H,f as x,b as d,w as v,T as P,M as q,H as Q,L as _}from"#entry";import{t as Y}from"./CWGjUj_J.js";const z={name:"SendTokensComponent",props:["recipient","tokens"],data(){return{filterTextInput:"",hasBlankCharacter:!1,inputReceiver:null,inputToken:null,inputTokenAmount:null,inputTokenBalance:null,recipientAddress:null,tokenList:[],waiting:!1}},components:{ConnectWalletButton:N,SwitchChainButton:R,WaitingToast:k},mounted(){this.inputReceiver=this.recipient,this.processRecipient(this.recipient),this.findBlankCharacter(),this.tokenList=this.tokens.tokens,this.selectInputToken(this.tokenList[0])},computed:{filteredTokensInput(){const i=new RegExp(this.filterTextInput,"i");return this.tokenList.filter(t=>i.test(t.symbol))},formatInputTokenBalance(){return this.inputTokenBalance?this.inputTokenBalance==0?0:this.inputTokenBalance>100?Number.parseFloat(Number(this.inputTokenBalance).toFixed(2)):Number.parseFloat(Number(this.inputTokenBalance).toFixed(8)):0},inputAmountLessThanBalance(){return this.inputTokenAmount&&this.inputTokenBalance?Number(this.inputTokenAmount)<=Number(this.inputTokenBalance):!1},isSupportedChain(){return this.chainId==this.$config.public.supportedChainId}},methods:{getTokenBalance:I,hasTextBlankCharacters:C,findBlankCharacter(){this.hasBlankCharacter=!1,this.hasBlankCharacter=C(this.inputReceiver)},async processRecipient(i){if(i)if(W(i))this.recipientAddress=i;else{const t=String(i).trim().toLowerCase().replace(this.$config.public.tldName,""),e={address:this.$config.public.punkTldAddress,abi:[{name:"getDomainHolder",type:"function",stateMutability:"view",inputs:[{name:"domain",type:"string"}],outputs:[{name:"",type:"address"}]}],functionName:"getDomainHolder",args:[t]};try{this.recipientAddress=await j(e)}catch(n){console.error("Error fetching domain holder:",n),this.recipientAddress=null}}},async selectInputToken(i){if(this.inputToken=i,this.inputTokenAmount=null,this.isConnected)try{this.inputTokenBalance=await this.getTokenBalance(i,this.address)}catch(t){console.error("Failed to fetch token balance:",t),this.inputTokenBalance="0";let e="Could not fetch token balance. Showing 0 balance.";t&&typeof t=="object"&&"message"in t&&typeof t.message=="string"&&(t.message.includes("ContractFunctionExecutionError")?e="Token contract call failed. This might mean the contract has restrictions or you have 0 balance.":t.message.includes("ContractFunctionRevertedError")&&(e="Token contract reverted. This usually means the user has 0 balance or the contract has restrictions.")),this.toast(e,{type:"info"})}},async send(){if(this.inputReceiver.includes(".")&&!this.inputReceiver.endsWith(this.$config.public.tldName))return this.toast.error("Invalid domain name. Only "+this.$config.public.tldName+" domains are supported.");if(this.waiting=!0,await this.processRecipient(this.inputReceiver),this.recipientAddress==B)return this.waiting=!1,this.toast.error("This domain name does not exist");this.inputToken.address==B?this.sendNativeTokens():this.sendErc20Tokens()},async sendErc20Tokens(){const i={address:this.inputToken.address,abi:D,functionName:"transfer",args:[this.recipientAddress,U(this.inputTokenAmount,this.inputToken.decimals)]};let t;try{const e=await V(i);t=this.toast({component:k,props:{text:"Please wait for your transaction to confirm. Click on this notification to see transaction in the block explorer."}},{type:"info",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+e,"_blank").focus()});const n=await w(e);n.status==="success"||n.status===1?(this.toast.dismiss(t),this.toast("You have successfully sent "+String(this.inputTokenAmount)+" "+this.inputToken.symbol+" to "+this.inputReceiver,{type:"success",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+e,"_blank").focus()}),this.subtractInputTokenBalance(),this.waiting=!1):(this.toast.dismiss(t),this.waiting=!1,this.toast("Transaction has failed.",{type:"error",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+e,"_blank").focus()}),console.log(n))}catch(e){console.error(e);try{let n=e.message.split("Details:")[1];n=n.split("Version: viem")[0],n=n.replace(/"/g,""),n=n.replace("execution reverted:","Error:"),console.log(n),this.toast(n,{type:"error"})}catch{this.toast("Transaction has failed.",{type:"error"})}this.waiting=!1}finally{this.toast.dismiss(t),this.waiting=!1}},async sendNativeTokens(){let i;try{const t=await L(this.recipientAddress,this.inputTokenAmount);i=this.toast({component:k,props:{text:"Please wait for your transaction to confirm. Click on this notification to see transaction in the block explorer."}},{type:"info",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+t,"_blank").focus()});const e=await w(t);e.status==="success"||e.status===1?(this.toast.dismiss(i),this.toast("You have successfully sent "+String(this.inputTokenAmount)+" "+this.inputToken.symbol+" to "+this.inputReceiver,{type:"success",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+t,"_blank").focus()}),this.subtractInputTokenBalance(),this.waiting=!1):(this.toast.dismiss(i),this.waiting=!1,this.toast("Transaction has failed.",{type:"error",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+t,"_blank").focus()}),console.log(e))}catch(t){console.error(t);try{let e=t.message.split("Details:")[1];e=e.split("Version: viem")[0],e=e.replace(/"/g,""),e=e.replace("execution reverted:","Error:"),console.log(e),this.toast(e,{type:"error"})}catch{this.toast("Transaction has failed.",{type:"error"})}this.waiting=!1}finally{this.toast.dismiss(i),this.waiting=!1}},setMaxInputTokenAmount(){this.inputTokenAmount=String(this.inputTokenBalance)},subtractInputTokenBalance(){this.inputTokenBalance=Number(this.inputTokenBalance)-Number(this.inputTokenAmount)}},setup(){const i=E(),{address:t,chainId:e,isConnected:n}=M({config:i}),o=F();return{address:t,chainId:e,isConnected:n,toast:o}},watch:{async isConnected(){this.address&&this.inputToken&&(this.inputTokenBalance=await this.getTokenBalance(this.inputToken,this.address))}}},K={class:"mb-3"},O={class:"input-group"},X={key:0,class:"input-group-text",id:"basic-addon3"},Z={key:0,class:"form-text",id:"basic-addon4"},G={class:"input-group mb-1 mt-3"},J={class:"btn btn-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},$={class:"dropdown-menu p-2"},tt=["onClick"],et={class:"cursor-pointer hover-color"},nt={class:"d-flex justify-content-center mt-4"},st={key:1,disabled:!0,class:"btn btn-outline-primary",type:"button"},it=["disabled"],ot={key:0,class:"spinner-border spinner-border-sm mx-1",role:"status","aria-hidden":"true"},at={key:3,disabled:!0,class:"btn btn-outline-primary",type:"button"};function rt(i,t,e,n,o,a){const h=T("ConnectWalletButton"),m=T("SwitchChainButton");return l(),c("div",null,[s("div",K,[s("div",O,[o.hasBlankCharacter?(l(),c("span",X,[...t[7]||(t[7]=[s("i",{class:"bi bi-exclamation-triangle-fill"},null,-1)])])):u("",!0),f(s("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>o.inputReceiver=r),type:"text",class:"form-control",id:"basic-url","aria-describedby":"basic-addon3 basic-addon4",placeholder:"Enter recipient's domain name or address",onKeyup:t[1]||(t[1]=(...r)=>a.findBlankCharacter&&a.findBlankCharacter(...r))},null,544),[[b,o.inputReceiver]])]),o.hasBlankCharacter?(l(),c("div",Z,[t[8]||(t[8]=s("i",{class:"bi bi-exclamation-triangle-fill"},null,-1)),g(" This domain name contains a blank character: "+p(encodeURIComponent(o.inputReceiver))+". Proceed with caution. ",1)])):u("",!0)]),s("div",G,[s("button",J,p(o.inputToken?.symbol),1),s("ul",$,[f(s("input",{class:"form-control mb-2",placeholder:"Filter tokens","onUpdate:modelValue":t[2]||(t[2]=r=>o.filterTextInput=r)},null,512),[[b,o.filterTextInput]]),(l(!0),c(S,null,H(a.filteredTokensInput,r=>(l(),c("li",{key:r.address,class:"cursor-pointer"},[s("span",{onClick:y=>a.selectInputToken(r),class:"dropdown-item"},p(r.symbol)+" ("+p(r.name)+")",9,tt)]))),128))]),f(s("input",{"onUpdate:modelValue":t[3]||(t[3]=r=>o.inputTokenAmount=r),type:"text",class:"form-control",placeholder:"0.00"},null,512),[[b,o.inputTokenAmount]]),s("button",{onClick:t[4]||(t[4]=(...r)=>a.setMaxInputTokenAmount&&a.setMaxInputTokenAmount(...r)),class:"btn btn-outline-secondary",type:"button",id:"button-addon2"},[...t[9]||(t[9]=[s("small",null,"MAX",-1)])])]),s("small",{onClick:t[5]||(t[5]=(...r)=>a.setMaxInputTokenAmount&&a.setMaxInputTokenAmount(...r))},[t[10]||(t[10]=s("em",null,"Balance: ",-1)),s("em",et,p(a.formatInputTokenBalance)+" "+p(o.inputToken?.symbol),1)]),s("div",nt,[n.isConnected?u("",!0):(l(),x(h,{key:0,customClass:"btn-outline-primary",btnText:"Connect wallet"})),n.isConnected&&!o.inputTokenAmount&&a.isSupportedChain?(l(),c("button",st," Send tokens ")):u("",!0),n.isConnected&&o.inputTokenAmount&&a.inputAmountLessThanBalance&&a.isSupportedChain?(l(),c("button",{key:2,disabled:o.waiting||!o.inputToken||!o.inputTokenAmount||!n.isConnected||!a.inputAmountLessThanBalance||!o.inputReceiver||!a.isSupportedChain,class:"btn btn-outline-primary",type:"button",onClick:t[6]||(t[6]=(...r)=>a.send&&a.send(...r))},[o.waiting?(l(),c("span",ot)):u("",!0),t[11]||(t[11]=g(" Send tokens ",-1))],8,it)):u("",!0),n.isConnected&&o.inputTokenAmount&&!a.inputAmountLessThanBalance&&a.isSupportedChain?(l(),c("button",at," Balance too low ")):u("",!0),n.isConnected&&!a.isSupportedChain?(l(),x(m,{key:4})):u("",!0)])])}const lt=A(z,[["render",rt]]),ct={name:"SendTokens",components:{SendTokensComponent:lt},computed:{getQueryRecipient(){return(this._.provides[_]||this.$route).query.to?(this._.provides[_]||this.$route).query.to:null}},setup(){return{tokens:Y}}},ut={class:"scroll-500"},pt={class:"card border"},dt={class:"card-body mb-3"},ht={class:"fs-3"},mt={class:"d-flex justify-content-center mt-5"},kt={class:"col-12 col-lg-8"};function ft(i,t,e,n,o,a){const h=P,m=q,r=Q,y=T("SendTokensComponent");return l(),c(S,null,[d(r,null,{default:v(()=>[d(h,null,{default:v(()=>[g("Send tokens | "+p(i.$config.public.projectMetadataTitle),1)]),_:1}),d(m,{property:"og:title",content:"Send tokens | "+i.$config.public.projectMetadataTitle},null,8,["content"])]),_:1}),s("div",ut,[s("div",pt,[s("div",dt,[s("p",ht,[s("i",{class:"bi bi-arrow-left-circle cursor-pointer",onClick:t[0]||(t[0]=bt=>i.$router.back())})]),t[1]||(t[1]=s("h3",{class:"mt-3"},"Send tokens",-1)),s("div",mt,[s("div",kt,[d(y,{tokens:n.tokens,recipient:a.getQueryRecipient},null,8,["tokens","recipient"])])])])])])],64)}const yt=A(ct,[["render",ft]]);export{yt as default};
