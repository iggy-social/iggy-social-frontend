import{_,S as P,C as D,j as S,s as L,m as B,i as N,W as E,r as g,c as d,o,a as i,A as v,g as r,b as m,t as c,p as W,f,v as F,d as p,P as M,B as $,D as x,E as w,G as j,I as V,J as T,K as H,n as q,y as z,q as A,L as I,w as C,e as O,T as R,M as J,H as G,F as K}from"#entry";import{I as Y}from"./C628wGYq.js";import{F as Q}from"./DunJuDhm.js";import{g as U}from"./DiPaW0Vf.js";const X={name:"ChangePfpModal",props:["componentId","domainName","storageType"],emits:["processFileUrl"],components:{ConnectWalletButton:D,FileUploadInput:Q,Image:Y,SwitchChainButton:P},data(){return{currentTab:"upload",imageLink:null,waitingSubmit:!1}},mounted(){this.fileUploadEnabled||(this.currentTab="paste")},computed:{domainNameWithoutTld(){return this.domainName.replace(this.$config.public.tldName,"")},fileUploadEnabled(){return this.$config.public.fileUploadEnabled},isSupportedChain(){return this.chainId===this.$config.public.supportedChainId}},methods:{handleCloseClick(){const e=document.getElementById("closeChangeImageModal"+this.componentId);e&&e.blur()},processUploadedFileUrl(e){this.imageLink=e,this.currentTab="paste"},async submitToBlockchain(){this.waitingSubmit=!0;let e;try{const t=await this.readData({address:this.$config.public.punkTldAddress,abi:[{inputs:[{name:"_domainName",type:"string"}],name:"getDomainData",outputs:[{name:"",type:"string"}],stateMutability:"view",type:"function"}],functionName:"getDomainData",args:[String(this.domainNameWithoutTld).toLowerCase()]});if(!t)throw new Error("Failed to read domain data");let n;try{n=JSON.parse(t)}catch{n={}}n.image=this.imageLink;const l=await this.writeData({address:this.$config.public.punkTldAddress,abi:[{inputs:[{name:"_domainName",type:"string"},{name:"_data",type:"string"}],name:"editData",outputs:[],stateMutability:"nonpayable",type:"function"}],functionName:"editData",args:[String(this.domainNameWithoutTld).toLowerCase(),JSON.stringify(n)]});e=this.toast({component:E,props:{text:"Please wait for your transaction to confirm. Click on this notification to see transaction in the block explorer."}},{type:"info",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+l,"_blank").focus()});const s=await this.waitForTxReceipt(l);s.status==="success"?(this.waitingSubmit=!1,this.toast.dismiss(e),this.toast("You have successfully changed your profile image!",{type:"success",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+l,"_blank").focus()}),this.$emit("processFileUrl",this.imageLink),document.getElementById("closeChangeImageModal"+this.componentId).click()):(this.waitingSubmit=!1,this.toast.dismiss(e),this.toast("Transaction has failed.",{type:"error",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+l,"_blank").focus()}),console.log(s))}catch(t){console.error(t);try{let n=t.message.split("Details:")[1];n=n.split("Version: viem")[0],n=n.replace(/"/g,""),n=n.replace("execution reverted:","Error:"),console.log(n),this.toast(n,{type:"error"})}catch{this.toast("Transaction has failed.",{type:"error"})}this.waitingSubmit=!1}finally{this.toast.dismiss(e),this.waitingSubmit=!1}this.waitingSubmit=!1}},setup(){const{readData:e,writeData:t,waitForTxReceipt:n}=S(),{fileUploadEnabled:l}=L(),{isActivated:s,chainId:a}=B(),h=N();return{readData:e,writeData:t,waitForTxReceipt:n,fileUploadEnabled:l,isActivated:s,chainId:a,toast:h}},watch:{fileUploadEnabled(){this.fileUploadEnabled?this.currentTab="upload":this.currentTab="paste"},imageLink(e,t){t&&(this.currentTab="paste")}}},Z=["id","aria-labelledby"],ee={class:"modal-dialog"},te={class:"modal-content"},ie={class:"modal-header"},se=["id"],ne=["id"],ae={class:"modal-body mb-4"},oe={class:"nav nav-tabs nav-fill"},le={class:"nav-item"},re=["disabled"],de={class:"nav-item"},ce={class:"tab-content mt-3"},ue={key:0},me={key:1},pe={key:0,class:"mb-3"},he=["disabled"],be={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function ge(e,t,n,l,s,a){const h=g("FileUploadInput"),u=g("Image"),k=g("ConnectWalletButton"),y=g("SwitchChainButton");return o(),d("div",{class:"modal fade",id:"changeImageModal"+n.componentId,"aria-labelledby":"changeImageModalLabel"+n.componentId},[i("div",ee,[i("div",te,[i("div",ie,[i("h1",{class:"modal-title fs-5",id:"changeImageModalLabel"+n.componentId},"Change your profile picture",8,se),i("button",{id:"closeChangeImageModal"+n.componentId,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:t[0]||(t[0]=(...b)=>a.handleCloseClick&&a.handleCloseClick(...b))},null,8,ne)]),i("div",ae,[i("ul",oe,[i("li",le,[i("button",{disabled:!l.fileUploadEnabled,class:v(["nav-link",s.currentTab==="upload"?"active":""]),onClick:t[1]||(t[1]=b=>s.currentTab="upload")}," Upload ",10,re)]),i("li",de,[i("button",{class:v(["nav-link",s.currentTab==="paste"?"active":""]),onClick:t[2]||(t[2]=b=>s.currentTab="paste")}," Paste Link ",2)])]),i("div",ce,[s.currentTab==="upload"?(o(),d("div",ue,[i("p",null,"Upload your new profile image "+c(n.domainName)+".",1),m(h,{btnCls:"btn btn-primary",maxFileSize:e.$config.public.fileUploadSizeLimit,storageType:n.storageType,onProcessUploadedFileUrl:a.processUploadedFileUrl},null,8,["maxFileSize","storageType","onProcessUploadedFileUrl"])])):r("",!0),s.currentTab==="paste"?(o(),d("div",me,[t[7]||(t[7]=i("p",null,"Submit the image link to blockchain",-1)),W(i("input",{"onUpdate:modelValue":t[3]||(t[3]=b=>s.imageLink=b),type:"text",class:"form-control mb-3",placeholder:"Enter http link to file"},null,512),[[F,s.imageLink]]),s.imageLink?(o(),d("div",pe,[m(u,{url:s.imageLink,cls:"img-thumbnail img-fluid",style:{"max-width":"100px"}},null,8,["url"]),t[5]||(t[5]=i("small",null,"If image didn't appear above, then something is wrong with the link you added (wait until the loading indicator completes).",-1))])):r("",!0),l.isActivated&&a.isSupportedChain?(o(),d("button",{key:1,class:"btn btn-primary",onClick:t[4]||(t[4]=(...b)=>a.submitToBlockchain&&a.submitToBlockchain(...b)),disabled:!s.imageLink||s.waitingSubmit},[s.waitingSubmit?(o(),d("span",be)):r("",!0),t[6]||(t[6]=p(" Submit to blockchain ",-1))],8,he)):r("",!0),l.isActivated?r("",!0):(o(),f(k,{key:2,class:"btn-outline-primary mt-2 mb-2",btnText:"Connect Wallet"})),l.isActivated&&!a.isSupportedChain?(o(),f(y,{key:3})):r("",!0)])):r("",!0)])])])])],8,Z)}const fe=_(X,[["render",ge]]),ke={name:"PunkProfile",props:["pAddress","pDomain"],data(){return{balanceAp:0,balanceChatTokenWei:BigInt(0),domain:this.pDomain,newEmail:null,newImageLink:null,uAddress:this.pAddress,uBalance:BigInt(0),waitingDataLoad:!1,waitingImageUpdate:!1}},components:{ChangePfpModal:fe,ProfileImage:M},mounted(){(!this.pAddress||!this.pDomain)&&this.fetchAddressAndDomain()},computed:{balanceChatToken(){return U(z(this.balanceChatTokenWei,18))},balanceEth(){return U(q(this.uBalance))},isCurrentUser(){return String(this.uAddress).toLowerCase()===String(this.address).toLowerCase()},domainWithoutExtension(){return this.domain?String(this.domain).replace(this.$config.public.tldName,""):null},shortAddress(){return this.address?this.shortenAddress(this.address):""}},methods:{changeCurrentTab(e){this.currentTab=e,localStorage.setItem("profileCurrentTab",e)},async fetchAddressAndDomain(){if(this.waitingDataLoad=!0,(this._.provides[w]||this.$route).query.id){const e=(this._.provides[w]||this.$route).query.id;e.includes(".")?this.domain=e:this.uAddress=e}else this.uAddress=this.address;if(!this.domain&&this.uAddress&&(this.domain=j(window,this.uAddress)),!this.domain&&this.uAddress){const e=await V(this.uAddress,window);e&&(this.domain=String(e).replace(this.$config.public.tldName,"")+this.$config.public.tldName,T(window,this.uAddress,this.domain))}if(this.domain&&!this.uAddress){const e=await H(String(this.domain).toLowerCase().split(".")[0]);e&&e!=="0x0000000000000000000000000000000000000000"&&(this.uAddress=e),this.domain=String(this.domain).replace(this.$config.public.tldName,"")+this.$config.public.tldName,T(window,this.uAddress,this.domain)}await this.fetchBalance()},async fetchBalance(){if(this.uAddress){if(this.uBalance=await this.getNativeCoinBalanceWei(this.uAddress),this.$config.public.chatTokenAddress){const e={address:this.$config.public.chatTokenAddress,abi:[{constant:!0,inputs:[{name:"owner",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"}],functionName:"balanceOf",args:[this.uAddress]},t=await this.readData(e);t&&(this.balanceChatTokenWei=t)}this.$config.public.activityPointsAddress&&this.$config.public.showFeatures.activityPoints&&(this.balanceAp=await x(this.uAddress))}},async insertImage(e){this.newImageLink=e,e&&$(window,this.domainWithoutExtension,{image:e},"img")}},setup(){const{address:e,domainName:t,shortenAddress:n}=B(),{getNativeCoinBalanceWei:l,readData:s}=S(),a=N();return{address:e,domainName:t,shortenAddress:n,getNativeCoinBalanceWei:l,readData:s,toast:a}},watch:{address(){this.fetchAddressAndDomain()}}},ye={class:"card border"},we={class:"card-body"},Ce={class:"fs-3"},_e={class:"row"},ve={class:"col-md-3 mt-3"},Te={class:"col-md-9 mt-3"},Ae={key:0,class:"mb-3"},Ie={key:1,class:"mb-3"},Ue={key:2,class:"mb-3"},Se={class:"mt-4 muted-text",style:{"font-size":"14px"}},Be={class:"me-4"},Ne={key:0,class:"me-4"},Pe={key:1,class:"me-4"},De={class:"me-4"},Le=["href"],Ee={key:3,class:"mt-2"},We={class:"dropdown mt-2"},Fe={class:"dropdown-menu"},Me=["data-bs-target"];function $e(e,t,n,l,s,a){const h=g("ProfileImage"),u=O,k=g("ChangePfpModal");return o(),d("div",null,[i("div",ye,[i("div",we,[i("p",Ce,[i("i",{class:"bi bi-arrow-left-circle cursor-pointer",onClick:t[0]||(t[0]=y=>e.$router.back())})]),i("div",_e,[i("div",ve,[(o(),f(h,{key:s.domain,class:"img-fluid img-thumbnail rounded-circle force-circle col-6 col-md-12",domain:s.domain,image:s.newImageLink},null,8,["domain","image"]))]),i("div",Te,[s.domain&&!a.isCurrentUser?(o(),d("h3",Ae,c(("getTextWithoutBlankCharacters"in e?e.getTextWithoutBlankCharacters:A(I))(s.domain)),1)):r("",!0),s.domain&&a.isCurrentUser?(o(),d("h3",Ie,c(("getTextWithoutBlankCharacters"in e?e.getTextWithoutBlankCharacters:A(I))(l.domainName)),1)):r("",!0),!s.domain&&l.address?(o(),d("h3",Ue,c(a.shortAddress),1)):r("",!0),i("div",Se,[i("p",Be,[t[1]||(t[1]=i("i",{class:"bi bi-wallet me-1"},null,-1)),p(" "+c(a.balanceEth)+" "+c(e.$config.public.tokenSymbol),1)]),e.$config.public.chatTokenAddress?(o(),d("p",Ne,[t[2]||(t[2]=i("i",{class:"bi bi-wallet me-1"},null,-1)),p(" "+c(a.balanceChatToken)+" "+c(e.$config.public.chatTokenSymbol),1)])):r("",!0),e.$config.public.activityPointsAddress&&e.$config.public.showFeatures.activityPoints?(o(),d("p",Pe,[t[3]||(t[3]=i("i",{class:"bi bi-wallet me-1"},null,-1)),p(" "+c(s.balanceAp)+" AP ",1)])):r("",!0),i("p",De,[t[4]||(t[4]=i("i",{class:"bi bi-box-arrow-up-right me-2"},null,-1)),i("a",{href:e.$config.public.blockExplorerBaseUrl+"/address/"+s.uAddress,target:"_blank",class:"body-color hover-color",style:{"text-decoration":"none"}},c(l.shortenAddress(s.uAddress)),9,Le)])]),a.isCurrentUser?(o(),d("div",Ee,[i("div",We,[t[7]||(t[7]=i("button",{class:"btn btn-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[i("i",{class:"bi bi-sliders"}),p(" Profile settings ")],-1)),i("div",Fe,[i("span",{class:"dropdown-item cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#changeImageModal"+e.$.uid},[...t[5]||(t[5]=[i("i",{class:"bi bi-person-circle"},null,-1),p(" Change your profile picture ",-1)])],8,Me),t[6]||(t[6]=i("span",{class:"dropdown-item cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#changeUsernameModal"},[i("i",{class:"bi bi-pencil-square"}),p(" Change your username ")],-1))])])])):r("",!0),s.domain&&!a.isCurrentUser&&e.$config.public.showFeatures.sendTokens?(o(),f(u,{key:4,class:"btn btn-primary mt-2",to:"/send-tokens/?to="+s.domain},{default:C(()=>[...t[8]||(t[8]=[i("i",{class:"bi bi-send"},null,-1),p(" Send a tip ",-1)])]),_:1},8,["to"])):r("",!0)])])]),a.isCurrentUser?(o(),f(k,{key:s.domain,domainName:s.domain,componentId:e.$.uid,storageType:"arweave",onProcessFileUrl:a.insertImage},null,8,["domainName","componentId","onProcessFileUrl"])):r("",!0)])])}const xe=_(ke,[["render",$e]]),je={name:"Profile",components:{PunkProfile:xe}};function Ve(e,t,n,l,s,a){const h=R,u=J,k=G,y=g("PunkProfile");return o(),d(K,null,[m(k,null,{default:C(()=>[m(h,null,{default:C(()=>[p("Profile | "+c(e.$config.public.projectMetadataTitle),1)]),_:1}),m(u,{name:"description",content:"Check out this profile on "+e.$config.public.projectName+"!"},null,8,["content"]),m(u,{property:"og:image",content:e.$config.public.projectUrl+e.$config.public.previewImageProfile},null,8,["content"]),m(u,{property:"og:description",content:"Check out this profile on "+e.$config.public.projectName+"!"},null,8,["content"]),m(u,{name:"twitter:image",content:e.$config.public.projectUrl+e.$config.public.previewImageProfile},null,8,["content"]),m(u,{name:"twitter:description",content:"Check out this profile on "+e.$config.public.projectName+"!"},null,8,["content"])]),_:1}),(o(),f(y,{key:(e._.provides[w]||e.$route).query.id,class:"mt-1"}))],64)}const Re=_(je,[["render",Ve]]);export{Re as default};
