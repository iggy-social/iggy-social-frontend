import{_ as v,S as W,I as E,x as N,y as P,A as F,i as B,W as A,j as D,l as M,m as $,r as b,c as d,o as a,a as s,G as I,g as r,b as m,t as c,p as x,f,v as j,d as p,P as V,z,J as H,B as O,K as q,L as C,N as J,O as R,Q as U,R as G,U as L,s as _,n as K,D as Q,q as w,V as S,w as T,e as Y,T as X,M as Z,H as ee,F as te}from"#entry";import{I as se}from"./BRYG_3z3.js";import{F as ie}from"./CudJIIoR.js";const ne={name:"ChangePfpModal",props:["componentId","domainName","storageType"],emits:["processFileUrl"],components:{ConnectWalletButton:E,FileUploadInput:ie,Image:se,SwitchChainButton:W},data(){return{currentTab:"upload",imageLink:null,waitingSubmit:!1}},mounted(){this.fileUploadEnabled||(this.currentTab="paste")},computed:{domainNameWithoutTld(){return this.domainName.replace(this.$config.public.tldName,"")},fileUploadEnabled(){return this.$config.public.fileUploadEnabled},isSupportedChain(){return this.chainId===this.$config.public.supportedChainId}},methods:{handleCloseClick(){const e=document.getElementById("closeChangeImageModal"+this.componentId);e&&e.blur()},processUploadedFileUrl(e){this.imageLink=e,this.currentTab="paste"},async submitToBlockchain(){const e=this.toast({component:A,props:{text:"Please confirm the transaction."}},{type:"info"});this.waitingSubmit=!0;let t;try{const l=await D({address:this.$config.public.punkTldAddress,abi:[{inputs:[{name:"_domainName",type:"string"}],name:"getDomainData",outputs:[{name:"",type:"string"}],stateMutability:"view",type:"function"}],functionName:"getDomainData",args:[String(this.domainNameWithoutTld).toLowerCase()]});let n={};if(l)try{n=JSON.parse(l)}catch(h){console.warn("Failed to parse domain data as JSON, using empty object:",h),n={}}else console.log("No existing domain data found, creating new domain data for:",this.domainNameWithoutTld);n.image=this.imageLink;const i=await M({address:this.$config.public.punkTldAddress,abi:[{inputs:[{name:"_domainName",type:"string"},{name:"_data",type:"string"}],name:"editData",outputs:[],stateMutability:"nonpayable",type:"function"}],functionName:"editData",args:[String(this.domainNameWithoutTld).toLowerCase(),JSON.stringify(n)]});this.toast.dismiss(e),t=this.toast({component:A,props:{text:"Please wait for your transaction to confirm. Click on this notification to see transaction in the block explorer."}},{type:"info",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+i,"_blank").focus()});const o=await $(i);o.status==="success"?(this.waitingSubmit=!1,this.toast.dismiss(t),this.toast("You have successfully changed your profile image!",{type:"success",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+i,"_blank").focus()}),this.$emit("processFileUrl",this.imageLink),document.getElementById("closeChangeImageModal"+this.componentId).click()):(this.waitingSubmit=!1,this.toast.dismiss(t),this.toast("Transaction has failed.",{type:"error",onClick:()=>window.open(this.$config.public.blockExplorerBaseUrl+"/tx/"+i,"_blank").focus()}),console.log(o))}catch(l){console.error(l);try{let n=l.message.split("Details:")[1];n=n.split("Version: viem")[0],n=n.replace(/"/g,""),n=n.replace("execution reverted:","Error:"),console.log(n),this.toast(n,{type:"error"})}catch{this.toast("Transaction has failed.",{type:"error"})}this.waitingSubmit=!1}finally{this.toast.dismiss(e),this.toast.dismiss(t),this.waitingSubmit=!1}this.waitingSubmit=!1}},setup(){const e=N(),{isConnected:t,chainId:l}=P({config:e}),{fileUploadEnabled:n}=F(),i=B();return{fileUploadEnabled:n,isConnected:t,chainId:l,toast:i}},watch:{fileUploadEnabled(){this.fileUploadEnabled?this.currentTab="upload":this.currentTab="paste"},imageLink(e,t){t&&(this.currentTab="paste")}}},oe=["id","aria-labelledby"],ae={class:"modal-dialog"},le={class:"modal-content"},re={class:"modal-header"},de=["id"],ce=["id"],ue={class:"modal-body mb-4"},me={class:"nav nav-tabs nav-fill"},pe={class:"nav-item"},he=["disabled"],ge={class:"nav-item"},be={class:"tab-content mt-3"},fe={key:0},ke={key:1},ye={key:0,class:"mb-3"},we=["disabled"],Ce={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function _e(e,t,l,n,i,o){const h=b("FileUploadInput"),u=b("Image"),k=b("ConnectWalletButton"),y=b("SwitchChainButton");return a(),d("div",{class:"modal fade",id:"changeImageModal"+l.componentId,"aria-labelledby":"changeImageModalLabel"+l.componentId},[s("div",ae,[s("div",le,[s("div",re,[s("h1",{class:"modal-title fs-5",id:"changeImageModalLabel"+l.componentId},"Change your profile picture",8,de),s("button",{id:"closeChangeImageModal"+l.componentId,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:t[0]||(t[0]=(...g)=>o.handleCloseClick&&o.handleCloseClick(...g))},null,8,ce)]),s("div",ue,[s("ul",me,[s("li",pe,[s("button",{disabled:!n.fileUploadEnabled,class:I(["nav-link",i.currentTab==="upload"?"active":""]),onClick:t[1]||(t[1]=g=>i.currentTab="upload")}," Upload ",10,he)]),s("li",ge,[s("button",{class:I(["nav-link",i.currentTab==="paste"?"active":""]),onClick:t[2]||(t[2]=g=>i.currentTab="paste")}," Paste Link ",2)])]),s("div",be,[i.currentTab==="upload"?(a(),d("div",fe,[s("p",null,"Upload your new profile image "+c(l.domainName)+".",1),m(h,{btnCls:"btn btn-primary",maxFileSize:e.$config.public.fileUploadSizeLimit,storageType:l.storageType,onProcessUploadedFileUrl:o.processUploadedFileUrl},null,8,["maxFileSize","storageType","onProcessUploadedFileUrl"])])):r("",!0),i.currentTab==="paste"?(a(),d("div",ke,[t[7]||(t[7]=s("p",null,"Submit the image link to blockchain",-1)),x(s("input",{"onUpdate:modelValue":t[3]||(t[3]=g=>i.imageLink=g),type:"text",class:"form-control mb-3",placeholder:"Enter http link to file"},null,512),[[j,i.imageLink]]),i.imageLink?(a(),d("div",ye,[m(u,{url:i.imageLink,cls:"img-thumbnail img-fluid",style:{"max-width":"100px"}},null,8,["url"]),t[5]||(t[5]=s("small",null,"If image didn't appear above, then something is wrong with the link you added (wait until the loading indicator completes).",-1))])):r("",!0),n.isConnected&&o.isSupportedChain?(a(),d("button",{key:1,class:"btn btn-primary",onClick:t[4]||(t[4]=(...g)=>o.submitToBlockchain&&o.submitToBlockchain(...g)),disabled:!i.imageLink||i.waitingSubmit},[i.waitingSubmit?(a(),d("span",Ce)):r("",!0),t[6]||(t[6]=p(" Submit to blockchain ",-1))],8,we)):r("",!0),n.isConnected?r("",!0):(a(),f(k,{key:2,class:"btn-outline-primary mt-2 mb-2",btnText:"Connect Wallet"})),n.isConnected&&!o.isSupportedChain?(a(),f(y,{key:3})):r("",!0)])):r("",!0)])])])])],8,oe)}const Te=v(ne,[["render",_e]]),ve={name:"PunkProfile",props:["pAddress","pDomain"],data(){return{balanceAp:0,balanceChatTokenWei:BigInt(0),domain:this.pDomain,newEmail:null,newImageLink:null,uAddress:this.pAddress,uBalance:BigInt(0),waitingDataLoad:!1,waitingImageUpdate:!1}},components:{ChangePfpModal:Te,ProfileImage:V},mounted(){(!this.pAddress||!this.pDomain)&&this.fetchAddressAndDomain()},computed:{balanceChatToken(){return _(Q(this.balanceChatTokenWei,18))},balanceEth(){return _(K(this.uBalance))},isCurrentUser(){return String(this.uAddress).toLowerCase()===String(this.address).toLowerCase()},domainWithoutExtension(){return this.domain?String(this.domain).replace(this.$config.public.tldName,""):null},shortAddress(){return this.address?L(this.address):""}},methods:{changeCurrentTab(e){this.currentTab=e,localStorage.setItem("profileCurrentTab",e)},async fetchAddressAndDomain(){if(this.waitingDataLoad=!0,(this._.provides[C]||this.$route).query.id){const e=(this._.provides[C]||this.$route).query.id;e.includes(".")?this.domain=e:this.uAddress=e}else this.uAddress=this.address;if(!this.domain&&this.uAddress&&(this.domain=J(window,this.uAddress)),!this.domain&&this.uAddress){const e=await R(this.uAddress,window);if(e){const t=e.split(".")[0]+this.$config.public.tldName;this.domain=t,U(window,this.uAddress,this.domain)}}if(this.domain&&!this.uAddress){const e=await G(String(this.domain).toLowerCase().split(".")[0]);e&&e!=="0x0000000000000000000000000000000000000000"&&(this.uAddress=e),this.domain=String(this.domain).split(".")[0]+this.$config.public.tldName,U(window,this.uAddress,this.domain)}await this.fetchBalance()},async fetchBalance(){if(this.uAddress){if(this.uBalance=await O(this.uAddress),this.$config.public.chatTokenAddress){const e={address:this.$config.public.chatTokenAddress,abi:[{constant:!0,inputs:[{name:"owner",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"}],functionName:"balanceOf",args:[this.uAddress]},t=await D(e);t&&(this.balanceChatTokenWei=t)}this.$config.public.activityPointsAddress&&this.$config.public.showFeatures.activityPoints&&(this.balanceAp=await q(this.uAddress))}},async insertImage(e){this.newImageLink=e,e&&H(window,this.domainWithoutExtension,{image:e},"img")}},setup(){const e=N(),{address:t}=P({config:e}),{domainName:l}=z(),n=B();return{address:t,domainName:l,toast:n}},watch:{address(){this.fetchAddressAndDomain()}}},Ae={class:"card border"},Ie={class:"card-body"},Ue={class:"fs-3"},Se={class:"row"},Ne={class:"col-md-3 mt-3"},Pe={class:"col-md-9 mt-3"},Be={key:0,class:"mb-3"},De={key:1,class:"mb-3"},Le={key:2,class:"mb-3"},We={class:"mt-4 muted-text",style:{"font-size":"14px"}},Ee={class:"me-4"},Fe={key:0,class:"me-4"},Me={key:1,class:"me-4"},$e={class:"me-4"},xe=["href"],je={key:3,class:"mt-2"},Ve={class:"dropdown mt-2"},ze={class:"dropdown-menu"},He=["data-bs-target"];function Oe(e,t,l,n,i,o){const h=b("ProfileImage"),u=Y,k=b("ChangePfpModal");return a(),d("div",null,[s("div",Ae,[s("div",Ie,[s("p",Ue,[s("i",{class:"bi bi-arrow-left-circle cursor-pointer",onClick:t[0]||(t[0]=y=>e.$router.back())})]),s("div",Se,[s("div",Ne,[(a(),f(h,{key:i.domain,class:"img-fluid img-thumbnail rounded-circle force-circle col-6 col-md-12",domain:i.domain,image:i.newImageLink},null,8,["domain","image"]))]),s("div",Pe,[i.domain&&!o.isCurrentUser?(a(),d("h3",Be,c(("getTextWithoutBlankCharacters"in e?e.getTextWithoutBlankCharacters:w(S))(i.domain)),1)):r("",!0),i.domain&&o.isCurrentUser?(a(),d("h3",De,c(("getTextWithoutBlankCharacters"in e?e.getTextWithoutBlankCharacters:w(S))(n.domainName)),1)):r("",!0),!i.domain&&n.address?(a(),d("h3",Le,c(o.shortAddress),1)):r("",!0),s("div",We,[s("p",Ee,[t[1]||(t[1]=s("i",{class:"bi bi-wallet me-1"},null,-1)),p(" "+c(o.balanceEth)+" "+c(e.$config.public.tokenSymbol),1)]),e.$config.public.chatTokenAddress?(a(),d("p",Fe,[t[2]||(t[2]=s("i",{class:"bi bi-wallet me-1"},null,-1)),p(" "+c(o.balanceChatToken)+" "+c(e.$config.public.chatTokenSymbol),1)])):r("",!0),e.$config.public.activityPointsAddress&&e.$config.public.showFeatures.activityPoints?(a(),d("p",Me,[t[3]||(t[3]=s("i",{class:"bi bi-wallet me-1"},null,-1)),p(" "+c(("getLessDecimals"in e?e.getLessDecimals:w(_))(i.balanceAp))+" AP ",1)])):r("",!0),s("p",$e,[t[4]||(t[4]=s("i",{class:"bi bi-box-arrow-up-right me-2"},null,-1)),s("a",{href:e.$config.public.blockExplorerBaseUrl+"/address/"+i.uAddress,target:"_blank",class:"body-color hover-color",style:{"text-decoration":"none"}},c(("shortenAddress"in e?e.shortenAddress:w(L))(i.uAddress)),9,xe)])]),o.isCurrentUser?(a(),d("div",je,[s("div",Ve,[t[7]||(t[7]=s("button",{class:"btn btn-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[s("i",{class:"bi bi-sliders"}),p(" Profile settings ")],-1)),s("div",ze,[s("span",{class:"dropdown-item cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#changeImageModal"+e.$.uid},[...t[5]||(t[5]=[s("i",{class:"bi bi-person-circle"},null,-1),p(" Change your profile picture ",-1)])],8,He),t[6]||(t[6]=s("span",{class:"dropdown-item cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#changeUsernameModal"},[s("i",{class:"bi bi-pencil-square"}),p(" Change your username ")],-1))])])])):r("",!0),i.domain&&!o.isCurrentUser&&e.$config.public.showFeatures.sendTokens?(a(),f(u,{key:4,class:"btn btn-primary mt-2",to:"/send-tokens/?to="+i.domain},{default:T(()=>[...t[8]||(t[8]=[s("i",{class:"bi bi-send"},null,-1),p(" Send a tip ",-1)])]),_:1},8,["to"])):r("",!0)])])]),o.isCurrentUser?(a(),f(k,{key:i.domain,domainName:i.domain,componentId:e.$.uid,storageType:"arweave",onProcessFileUrl:o.insertImage},null,8,["domainName","componentId","onProcessFileUrl"])):r("",!0)])])}const qe=v(ve,[["render",Oe]]),Je={name:"Profile",components:{PunkProfile:qe}};function Re(e,t,l,n,i,o){const h=X,u=Z,k=ee,y=b("PunkProfile");return a(),d(te,null,[m(k,null,{default:T(()=>[m(h,null,{default:T(()=>[p("Profile | "+c(e.$config.public.projectMetadataTitle),1)]),_:1}),m(u,{name:"description",content:"Check out this profile on "+e.$config.public.projectName+"!"},null,8,["content"]),m(u,{property:"og:image",content:e.$config.public.projectUrl+e.$config.public.previewImageProfile},null,8,["content"]),m(u,{property:"og:description",content:"Check out this profile on "+e.$config.public.projectName+"!"},null,8,["content"]),m(u,{name:"twitter:image",content:e.$config.public.projectUrl+e.$config.public.previewImageProfile},null,8,["content"]),m(u,{name:"twitter:description",content:"Check out this profile on "+e.$config.public.projectName+"!"},null,8,["content"])]),_:1}),(a(),f(y,{key:(e._.provides[C]||e.$route).query.id,class:"mt-1"}))],64)}const Ye=v(Je,[["render",Re]]);export{Ye as default};
